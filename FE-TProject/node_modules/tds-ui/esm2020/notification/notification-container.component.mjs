import { ChangeDetectionStrategy, Component, ViewEncapsulation } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { TDSMNContainerComponent } from 'tds-ui/message';
import { toCssPixel } from 'tds-ui/shared/utility';
import * as i0 from "@angular/core";
import * as i1 from "tds-ui/core/config";
import * as i2 from "@angular/common";
import * as i3 from "./notification.component";
function TDSNotificationContainerComponent_tds_notification_1_Template(rf, ctx) { if (rf & 1) {
    const _r6 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "tds-notification", 5);
    i0.ɵɵlistener("destroyed", function TDSNotificationContainerComponent_tds_notification_1_Template_tds_notification_destroyed_0_listener($event) { i0.ɵɵrestoreView(_r6); const ctx_r5 = i0.ɵɵnextContext(); return ctx_r5.remove($event.id, $event.userAction); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const instance_r4 = ctx.$implicit;
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵproperty("instance", instance_r4)("placement", ctx_r0.config.placement);
} }
function TDSNotificationContainerComponent_tds_notification_3_Template(rf, ctx) { if (rf & 1) {
    const _r9 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "tds-notification", 5);
    i0.ɵɵlistener("destroyed", function TDSNotificationContainerComponent_tds_notification_3_Template_tds_notification_destroyed_0_listener($event) { i0.ɵɵrestoreView(_r9); const ctx_r8 = i0.ɵɵnextContext(); return ctx_r8.remove($event.id, $event.userAction); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const instance_r7 = ctx.$implicit;
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵproperty("instance", instance_r7)("placement", ctx_r1.config.placement);
} }
function TDSNotificationContainerComponent_tds_notification_5_Template(rf, ctx) { if (rf & 1) {
    const _r12 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "tds-notification", 5);
    i0.ɵɵlistener("destroyed", function TDSNotificationContainerComponent_tds_notification_5_Template_tds_notification_destroyed_0_listener($event) { i0.ɵɵrestoreView(_r12); const ctx_r11 = i0.ɵɵnextContext(); return ctx_r11.remove($event.id, $event.userAction); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const instance_r10 = ctx.$implicit;
    const ctx_r2 = i0.ɵɵnextContext();
    i0.ɵɵproperty("instance", instance_r10)("placement", ctx_r2.config.placement);
} }
function TDSNotificationContainerComponent_tds_notification_7_Template(rf, ctx) { if (rf & 1) {
    const _r15 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "tds-notification", 5);
    i0.ɵɵlistener("destroyed", function TDSNotificationContainerComponent_tds_notification_7_Template_tds_notification_destroyed_0_listener($event) { i0.ɵɵrestoreView(_r15); const ctx_r14 = i0.ɵɵnextContext(); return ctx_r14.remove($event.id, $event.userAction); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const instance_r13 = ctx.$implicit;
    const ctx_r3 = i0.ɵɵnextContext();
    i0.ɵɵproperty("instance", instance_r13)("placement", ctx_r3.config.placement);
} }
const TDS_CONFIG_MODULE_NAME = 'notification';
const TDS_NOTIFICATION_DEFAULT_CONFIG = {
    top: '24px',
    bottom: '24px',
    placement: 'topRight',
    duration: 4500,
    maxStack: 7,
    pauseOnHover: true,
    animate: true,
    direction: 'ltr'
};
export class TDSNotificationContainerComponent extends TDSMNContainerComponent {
    constructor(cdr, tdsConfigService) {
        super(cdr, tdsConfigService);
        this.dir = 'ltr';
        this.instances = [];
        this.topLeftInstances = [];
        this.topRightInstances = [];
        this.bottomLeftInstances = [];
        this.bottomRightInstances = [];
        const config = TDS_NOTIFICATION_DEFAULT_CONFIG;
        this.dir = config?.direction || 'ltr';
    }
    create(notification) {
        const noti = this.onCreate(notification);
        const key = noti.options.key;
        const notificationWithSameKey = this.instances.find(msg => msg.options.key === notification.options.key);
        if (key && notificationWithSameKey) {
            this.replaceNotification(notificationWithSameKey, noti);
        }
        else {
            if (this.instances.length >= this.config.maxStack) {
                this.instances = this.instances.slice(1);
            }
            this.instances = [...this.instances, noti];
        }
        this.readyInstances();
        return noti;
    }
    onCreate(instance) {
        instance.options = this.mergeOptions(instance.options);
        instance.onClose = new Subject();
        instance.onClick = new Subject();
        return instance;
    }
    subscribeConfigChange() {
        this.tdsConfigService
            .getConfigChangeEventForComponent(TDS_CONFIG_MODULE_NAME)
            .pipe(takeUntil(this.destroy$))
            .subscribe(() => {
            this.updateConfig();
            const config = this.tdsConfigService.getConfigForComponent(TDS_CONFIG_MODULE_NAME);
            if (config) {
                const { direction } = config;
                this.dir = direction || this.dir;
            }
        });
    }
    updateConfig() {
        this.config = {
            ...TDS_NOTIFICATION_DEFAULT_CONFIG,
            ...this.config,
            ...this.tdsConfigService.getConfigForComponent(TDS_CONFIG_MODULE_NAME)
        };
        this.top = toCssPixel(this.config.top);
        this.bottom = toCssPixel(this.config.bottom);
        this.cdr.markForCheck();
    }
    replaceNotification(old, _new) {
        old.title = _new.title;
        old.content = _new.content;
        old.template = _new.template;
        old.type = _new.type;
        old.options = _new.options;
    }
    readyInstances() {
        this.topLeftInstances = this.instances.filter(m => m.options.placement === 'topLeft');
        this.topRightInstances = this.instances.filter(m => m.options.placement === 'topRight' || !m.options.placement);
        this.bottomLeftInstances = this.instances.filter(m => m.options.placement === 'bottomLeft');
        this.bottomRightInstances = this.instances.filter(m => m.options.placement === 'bottomRight');
        this.cdr.detectChanges();
    }
    mergeOptions(options) {
        const { duration, animate, pauseOnHover, placement } = this.config;
        return { duration, animate, pauseOnHover, placement: placement, ...options };
    }
}
TDSNotificationContainerComponent.ɵfac = function TDSNotificationContainerComponent_Factory(t) { return new (t || TDSNotificationContainerComponent)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.TDSConfigService)); };
TDSNotificationContainerComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSNotificationContainerComponent, selectors: [["tds-notification-container"]], exportAs: ["tdsNotificationContainer"], features: [i0.ɵɵInheritDefinitionFeature], decls: 8, vars: 28, consts: [[1, "tds-notification", "absolute", "tds-notification-topLeft"], [3, "instance", "placement", "destroyed", 4, "ngFor", "ngForOf"], [1, "tds-notification", "absolute", "tds-notification-topRight"], [1, "tds-notification", "absolute", "tds-notification-bottomLeft"], [1, "tds-notification", "absolute", "tds-notification-bottomRight"], [3, "instance", "placement", "destroyed"]], template: function TDSNotificationContainerComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵelementStart(0, "div", 0);
        i0.ɵɵtemplate(1, TDSNotificationContainerComponent_tds_notification_1_Template, 1, 2, "tds-notification", 1);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(2, "div", 2);
        i0.ɵɵtemplate(3, TDSNotificationContainerComponent_tds_notification_3_Template, 1, 2, "tds-notification", 1);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(4, "div", 3);
        i0.ɵɵtemplate(5, TDSNotificationContainerComponent_tds_notification_5_Template, 1, 2, "tds-notification", 1);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(6, "div", 4);
        i0.ɵɵtemplate(7, TDSNotificationContainerComponent_tds_notification_7_Template, 1, 2, "tds-notification", 1);
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵstyleProp("top", ctx.top)("left", "0px");
        i0.ɵɵclassProp("tds-notification-rtl", ctx.dir === "rtl");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngForOf", ctx.topLeftInstances);
        i0.ɵɵadvance(1);
        i0.ɵɵstyleProp("top", ctx.top)("right", "0px");
        i0.ɵɵclassProp("tds-notification-rtl", ctx.dir === "rtl");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngForOf", ctx.topRightInstances);
        i0.ɵɵadvance(1);
        i0.ɵɵstyleProp("bottom", ctx.bottom)("left", "0px");
        i0.ɵɵclassProp("tds-notification-rtl", ctx.dir === "rtl");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngForOf", ctx.bottomLeftInstances);
        i0.ɵɵadvance(1);
        i0.ɵɵstyleProp("bottom", ctx.bottom)("right", "0px");
        i0.ɵɵclassProp("tds-notification-rtl", ctx.dir === "rtl");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngForOf", ctx.bottomRightInstances);
    } }, directives: [i2.NgForOf, i3.TDSNotificationComponent], encapsulation: 2, changeDetection: 0 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSNotificationContainerComponent, [{
        type: Component,
        args: [{
                changeDetection: ChangeDetectionStrategy.OnPush,
                encapsulation: ViewEncapsulation.None,
                selector: 'tds-notification-container',
                exportAs: 'tdsNotificationContainer',
                preserveWhitespaces: false,
                template: `
    <div
      class="tds-notification absolute  tds-notification-topLeft"
      [class.tds-notification-rtl]="dir === 'rtl'"
      [style.top]="top"
      [style.left]="'0px'"
    >
      <tds-notification
        *ngFor="let instance of topLeftInstances"
        [instance]="instance"
        [placement]="config.placement"
        (destroyed)="remove($event.id, $event.userAction)"
      ></tds-notification>
    </div>
    <div
      class="tds-notification absolute  tds-notification-topRight"
      [class.tds-notification-rtl]="dir === 'rtl'"
      [style.top]="top"
      [style.right]="'0px'"
    >
      <tds-notification
        *ngFor="let instance of topRightInstances"
        [instance]="instance"
        [placement]="config.placement"
        (destroyed)="remove($event.id, $event.userAction)"
      ></tds-notification>
    </div>
    <div
      class="tds-notification absolute  tds-notification-bottomLeft"
      [class.tds-notification-rtl]="dir === 'rtl'"
      [style.bottom]="bottom"
      [style.left]="'0px'"
    >
      <tds-notification
        *ngFor="let instance of bottomLeftInstances"
        [instance]="instance"
        [placement]="config.placement"
        (destroyed)="remove($event.id, $event.userAction)"
      ></tds-notification>
    </div>
    <div
      class="tds-notification absolute  tds-notification-bottomRight"
      [class.tds-notification-rtl]="dir === 'rtl'"
      [style.bottom]="bottom"
      [style.right]="'0px'"
    >
      <tds-notification
        *ngFor="let instance of bottomRightInstances"
        [instance]="instance"
        [placement]="config.placement"
        (destroyed)="remove($event.id, $event.userAction)"
      ></tds-notification>
    </div>
  `
            }]
    }], function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.TDSConfigService }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLWNvbnRhaW5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy90ZHMtdWkvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1jb250YWluZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sRUFBRSx1QkFBdUIsRUFBcUIsU0FBUyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXpHLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7Ozs7OztJQTZCN0MsMkNBS0M7SUFEQyxtTkFBYSwyQ0FBb0MsSUFBQztJQUNuRCxpQkFBbUI7Ozs7SUFIbEIsc0NBQXFCLHNDQUFBOzs7O0lBV3ZCLDJDQUtDO0lBREMsbU5BQWEsMkNBQW9DLElBQUM7SUFDbkQsaUJBQW1COzs7O0lBSGxCLHNDQUFxQixzQ0FBQTs7OztJQVd2QiwyQ0FLQztJQURDLHFOQUFhLDRDQUFvQyxJQUFDO0lBQ25ELGlCQUFtQjs7OztJQUhsQix1Q0FBcUIsc0NBQUE7Ozs7SUFXdkIsMkNBS0M7SUFEQyxxTkFBYSw0Q0FBb0MsSUFBQztJQUNuRCxpQkFBbUI7Ozs7SUFIbEIsdUNBQXFCLHNDQUFBOztBQW5FN0IsTUFBTSxzQkFBc0IsR0FBRyxjQUFjLENBQUM7QUFFOUMsTUFBTSwrQkFBK0IsR0FBaUM7SUFDcEUsR0FBRyxFQUFFLE1BQU07SUFDWCxNQUFNLEVBQUUsTUFBTTtJQUNkLFNBQVMsRUFBRSxVQUFVO0lBQ3JCLFFBQVEsRUFBRSxJQUFJO0lBQ2QsUUFBUSxFQUFFLENBQUM7SUFDWCxZQUFZLEVBQUUsSUFB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QkFDL0MsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7Z0JBQ3JDLFFBQVEsRUFBRSw0QkFBNEI7Z0JBQ3RDLFFBQVEsRUFBRSwwQkFBMEI7Z0JBQ3BDLG1CQUFtQixFQUFFLEtBQUs7Z0JBQzFCLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FxRFQ7YUFDRiIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuaW1wb3J0IHsgRGlyZWN0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2JpZGknO1xyXG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBOb3RpZmljYXRpb25Db25maWcsIFREU0NvbmZpZ1NlcnZpY2UgfSBmcm9tICd0ZHMtdWkvY29yZS9jb25maWcnO1xyXG5pbXBvcnQgeyBURFNNTkNvbnRhaW5lckNvbXBvbmVudCB9IGZyb20gJ3Rkcy11aS9tZXNzYWdlJztcclxuaW1wb3J0IHsgdG9Dc3NQaXhlbCB9IGZyb20gJ3Rkcy11aS9zaGFyZWQvdXRpbGl0eSc7XHJcbmltcG9ydCB7IFREU05vdGlmaWNhdGlvbkRhdGEsIFREU05vdGlmaWNhdGlvbkRhdGFPcHRpb25zIH0gZnJvbSAnLi90eXBpbmdzJztcclxuXHJcbmNvbnN0IFREU19DT05GSUdfTU9EVUxFX05BTUUgPSAnbm90aWZpY2F0aW9uJztcclxuXHJcbmNvbnN0IFREU19OT1RJRklDQVRJT05fREVGQVVMVF9DT05GSUc6IFJlcXVpcmVkPE5vdGlmaWNhdGlvbkNvbmZpZz4gPSB7XHJcbiAgdG9wOiAnMjRweCcsXHJcbiAgYm90dG9tOiAnMjRweCcsXHJcbiAgcGxhY2VtZW50OiAndG9wUmlnaHQnLFxyXG4gIGR1cmF0aW9uOiA0NTAwLFxyXG4gIG1heFN0YWNrOiA3LFxyXG4gIHBhdXNlT25Ib3ZlcjogdHJ1ZSxcclxuICBhbmltYXRlOiB0cnVlLFxyXG4gIGRpcmVjdGlvbjogJ2x0cidcclxufTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgc2VsZWN0b3I6ICd0ZHMtbm90aWZpY2F0aW9uLWNvbnRhaW5lcicsXHJcbiAgZXhwb3J0QXM6ICd0ZHNOb3RpZmljYXRpb25Db250YWluZXInLFxyXG4gIHByZXNlcnZlV2hpdGVzcGFjZXM6IGZhbHNlLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2XHJcbiAgICAgIGNsYXNzPVwidGRzLW5vdGlmaWNhdGlvbiBhYnNvbHV0ZSAgdGRzLW5vdGlmaWNhdGlvbi10b3BMZWZ0XCJcclxuICAgICAgW2NsYXNzLnRkcy1ub3RpZmljYXRpb24tcnRsXT1cImRpciA9PT0gJ3J0bCdcIlxyXG4gICAgICBbc3R5bGUudG9wXT1cInRvcFwiXHJcbiAgICAgIFtzdHlsZS5sZWZ0XT1cIicwcHgnXCJcclxuICAgID5cclxuICAgICAgPHRkcy1ub3RpZmljYXRpb25cclxuICAgICAgICAqbmdGb3I9XCJsZXQgaW5zdGFuY2Ugb2YgdG9wTGVmdEluc3RhbmNlc1wiXHJcbiAgICAgICAgW2luc3RhbmNlXT1cImluc3RhbmNlXCJcclxuICAgICAgICBbcGxhY2VtZW50XT1cImNvbmZpZy5wbGFjZW1lbnRcIlxyXG4gICAgICAgIChkZXN0cm95ZWQpPVwicmVtb3ZlKCRldmVudC5pZCwgJGV2ZW50LnVzZXJBY3Rpb24pXCJcclxuICAgICAgPjwvdGRzLW5vdGlmaWNhdGlvbj5cclxuICAgIDwvZGl2PlxyXG4gICAgPGRpdlxyXG4gICAgICBjbGFzcz1cInRkcy1ub3RpZmljYXRpb24gYWJzb2x1dGUgIHRkcy1ub3RpZmljYXRpb24tdG9wUmlnaHRcIlxyXG4gICAgICBbY2xhc3MudGRzLW5vdGlmaWNhdGlvbi1ydGxdPVwiZGlyID09PSAncnRsJ1wiXHJcbiAgICAgIFtzdHlsZS50b3BdPVwidG9wXCJcclxuICAgICAgW3N0eWxlLnJpZ2h0XT1cIicwcHgnXCJcclxuICAgID5cclxuICAgICAgPHRkcy1ub3RpZmljYXRpb25cclxuICAgICAgICAqbmdGb3I9XCJsZXQgaW5zdGFuY2Ugb2YgdG9wUmlnaHRJbnN0YW5jZXNcIlxyXG4gICAgICAgIFtpbnN0YW5jZV09XCJpbnN0YW5jZVwiXHJcbiAgICAgICAgW3BsYWNlbWVudF09XCJjb25maWcucGxhY2VtZW50XCJcclxuICAgICAgICAoZGVzdHJveWVkKT1cInJlbW92ZSgkZXZlbnQuaWQsICRldmVudC51c2VyQWN0aW9uKVwiXHJcbiAgICAgID48L3Rkcy1ub3RpZmljYXRpb24+XHJcbiAgICA8L2Rpdj5cclxuICAgIDxkaXZcclxuICAgICAgY2xhc3M9XCJ0ZHMtbm90aWZpY2F0aW9uIGFic29sdXRlICB0ZHMtbm90aWZpY2F0aW9uLWJvdHRvbUxlZnRcIlxyXG4gICAgICBbY2xhc3MudGRzLW5vdGlmaWNhdGlvbi1ydGxdPVwiZGlyID09PSAncnRsJ1wiXHJcbiAgICAgIFtzdHlsZS5ib3R0b21dPVwiYm90dG9tXCJcclxuICAgICAgW3N0eWxlLmxlZnRdPVwiJzBweCdcIlxyXG4gICAgPlxyXG4gICAgICA8dGRzLW5vdGlmaWNhdGlvblxyXG4gICAgICAgICpuZ0Zvcj1cImxldCBpbnN0YW5jZSBvZiBib3R0b21MZWZ0SW5zdGFuY2VzXCJcclxuICAgICAgICBbaW5zdGFuY2VdPVwiaW5zdGFuY2VcIlxyXG4gICAgICAgIFtwbGFjZW1lbnRdPVwiY29uZmlnLnBsYWNlbWVudFwiXHJcbiAgICAgICAgKGRlc3Ryb3llZCk9XCJyZW1vdmUoJGV2ZW50LmlkLCAkZXZlbnQudXNlckFjdGlvbilcIlxyXG4gICAgICA+PC90ZHMtbm90aWZpY2F0aW9uPlxyXG4gICAgPC9kaXY+XHJcbiAgICA8ZGl2XHJcbiAgICAgIGNsYXNzPVwidGRzLW5vdGlmaWNhdGlvbiBhYnNvbHV0ZSAgdGRzLW5vdGlmaWNhdGlvbi1ib3R0b21SaWdodFwiXHJcbiAgICAgIFtjbGFzcy50ZHMtbm90aWZpY2F0aW9uLXJ0bF09XCJkaXIgPT09ICdydGwnXCJcclxuICAgICAgW3N0eWxlLmJvdHRvbV09XCJib3R0b21cIlxyXG4gICAgICBbc3R5bGUucmlnaHRdPVwiJzBweCdcIlxyXG4gICAgPlxyXG4gICAgICA8dGRzLW5vdGlmaWNhdGlvblxyXG4gICAgICAgICpuZ0Zvcj1cImxldCBpbnN0YW5jZSBvZiBib3R0b21SaWdodEluc3RhbmNlc1wiXHJcbiAgICAgICAgW2luc3RhbmNlXT1cImluc3RhbmNlXCJcclxuICAgICAgICBbcGxhY2VtZW50XT1cImNvbmZpZy5wbGFjZW1lbnRcIlxyXG4gICAgICAgIChkZXN0cm95ZWQpPVwicmVtb3ZlKCRldmVudC5pZCwgJGV2ZW50LnVzZXJBY3Rpb24pXCJcclxuICAgICAgPjwvdGRzLW5vdGlmaWNhdGlvbj5cclxuICAgIDwvZGl2PlxyXG4gIGBcclxufSlcclxuZXhwb3J0IGNsYXNzIFREU05vdGlmaWNhdGlvbkNvbnRhaW5lckNvbXBvbmVudCBleHRlbmRzIFREU01OQ29udGFpbmVyQ29tcG9uZW50IHtcclxuICBkaXI6IERpcmVjdGlvbiA9ICdsdHInO1xyXG4gIGJvdHRvbT86IHN0cmluZyB8IG51bGw7XHJcbiAgdG9wPzogc3RyaW5nIHwgbnVsbDtcclxuICBjb25maWchOiBSZXF1aXJlZDxOb3RpZmljYXRpb25Db25maWc+OyAvLyBpbml0aWFsaXplZCBieSBwYXJlbnQgY2xhc3MgY29uc3RydWN0b3JcclxuICBpbnN0YW5jZXM6IEFycmF5PFJlcXVpcmVkPFREU05vdGlmaWNhdGlvbkRhdGE+PiA9IFtdO1xyXG4gIHRvcExlZnRJbnN0YW5jZXM6IEFycmF5PFJlcXVpcmVkPFREU05vdGlmaWNhdGlvbkRhdGE+PiA9IFtdO1xyXG4gIHRvcFJpZ2h0SW5zdGFuY2VzOiBBcnJheTxSZXF1aXJlZDxURFNOb3RpZmljYXRpb25EYXRhPj4gPSBbXTtcclxuICBib3R0b21MZWZ0SW5zdGFuY2VzOiBBcnJheTxSZXF1aXJlZDxURFNOb3RpZmljYXRpb25EYXRhPj4gPSBbXTtcclxuICBib3R0b21SaWdodEluc3RhbmNlczogQXJyYXk8UmVxdWlyZWQ8VERTTm90aWZpY2F0aW9uRGF0YT4+ID0gW107XHJcblxyXG4gIGNvbnN0cnVjdG9yKGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsIHRkc0NvbmZpZ1NlcnZpY2U6IFREU0NvbmZpZ1NlcnZpY2UpIHtcclxuICAgIHN1cGVyKGNkcix0ZHNDb25maWdTZXJ2aWNlKTtcclxuICAgIGNvbnN0IGNvbmZpZyA9IFREU19OT1RJRklDQVRJT05fREVGQVVMVF9DT05GSUc7XHJcbiAgICB0aGlzLmRpciA9IGNvbmZpZz8uZGlyZWN0aW9uIHx8ICdsdHInO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlKG5vdGlmaWNhdGlvbjogVERTTm90aWZpY2F0aW9uRGF0YSk6IFJlcXVpcmVkPFREU05vdGlmaWNhdGlvbkRhdGE+IHtcclxuICAgIGNvbnN0IG5vdGkgPSB0aGlzLm9uQ3JlYXRlKG5vdGlmaWNhdGlvbik7XHJcbiAgICBjb25zdCBrZXkgPSBub3RpLm9wdGlvbnMua2V5O1xyXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uV2l0aFNhbWVLZXkgPSB0aGlzLmluc3RhbmNlcy5maW5kKFxyXG4gICAgICBtc2cgPT4gbXNnLm9wdGlvbnMua2V5ID09PSAobm90aWZpY2F0aW9uLm9wdGlvbnMgYXMgUmVxdWlyZWQ8VERTTm90aWZpY2F0aW9uRGF0YU9wdGlvbnM+KS5rZXlcclxuICAgICk7XHJcbiAgICBpZiAoa2V5ICYmIG5vdGlmaWNhdGlvbldpdGhTYW1lS2V5KSB7XHJcbiAgICAgIHRoaXMucmVwbGFjZU5vdGlmaWNhdGlvbihub3RpZmljYXRpb25XaXRoU2FtZUtleSwgbm90aSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAodGhpcy5pbnN0YW5jZXMubGVuZ3RoID49IHRoaXMuY29uZmlnLm1heFN0YWNrKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSB0aGlzLmluc3RhbmNlcy5zbGljZSgxKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmluc3RhbmNlcyA9IFsuLi50aGlzLmluc3RhbmNlcywgbm90aV07XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yZWFkeUluc3RhbmNlcygpO1xyXG5cclxuICAgIHJldHVybiBub3RpO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIG9uQ3JlYXRlKGluc3RhbmNlOiBURFNOb3RpZmljYXRpb25EYXRhKTogUmVxdWlyZWQ8VERTTm90aWZpY2F0aW9uRGF0YT4ge1xyXG4gICAgaW5zdGFuY2Uub3B0aW9ucyA9IHRoaXMubWVyZ2VPcHRpb25zKGluc3RhbmNlLm9wdGlvbnMpO1xyXG4gICAgaW5zdGFuY2Uub25DbG9zZSA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XHJcbiAgICBpbnN0YW5jZS5vbkNsaWNrID0gbmV3IFN1YmplY3Q8TW91c2VFdmVudD4oKTtcclxuICAgIHJldHVybiBpbnN0YW5jZSBhcyBSZXF1aXJlZDxURFNOb3RpZmljYXRpb25EYXRhPjtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBzdWJzY3JpYmVDb25maWdDaGFuZ2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLnRkc0NvbmZpZ1NlcnZpY2VcclxuICAgICAgLmdldENvbmZpZ0NoYW5nZUV2ZW50Rm9yQ29tcG9uZW50KFREU19DT05GSUdfTU9EVUxFX05BTUUpXHJcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcclxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICB0aGlzLnVwZGF0ZUNvbmZpZygpO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMudGRzQ29uZmlnU2VydmljZS5nZXRDb25maWdGb3JDb21wb25lbnQoVERTX0NPTkZJR19NT0RVTEVfTkFNRSk7XHJcbiAgICAgICAgaWYgKGNvbmZpZykge1xyXG4gICAgICAgICAgY29uc3QgeyBkaXJlY3Rpb24gfSA9IGNvbmZpZztcclxuICAgICAgICAgIHRoaXMuZGlyID0gZGlyZWN0aW9uIHx8IHRoaXMuZGlyO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgdXBkYXRlQ29uZmlnKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb25maWcgPSB7XHJcbiAgICAgIC4uLlREU19OT1RJRklDQVRJT05fREVGQVVMVF9DT05GSUcsXHJcbiAgICAgIC4uLnRoaXMuY29uZmlnLFxyXG4gICAgICAgLi4udGhpcy50ZHNDb25maWdTZXJ2aWNlLmdldENvbmZpZ0ZvckNvbXBvbmVudChURFNfQ09ORklHX01PRFVMRV9OQU1FKVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnRvcCA9IHRvQ3NzUGl4ZWwodGhpcy5jb25maWcudG9wISk7XHJcbiAgICB0aGlzLmJvdHRvbSA9IHRvQ3NzUGl4ZWwodGhpcy5jb25maWcuYm90dG9tISk7XHJcblxyXG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlcGxhY2VOb3RpZmljYXRpb24ob2xkOiBURFNOb3RpZmljYXRpb25EYXRhLCBfbmV3OiBURFNOb3RpZmljYXRpb25EYXRhKTogdm9pZCB7XHJcbiAgICBvbGQudGl0bGUgPSBfbmV3LnRpdGxlO1xyXG4gICAgb2xkLmNvbnRlbnQgPSBfbmV3LmNvbnRlbnQ7XHJcbiAgICBvbGQudGVtcGxhdGUgPSBfbmV3LnRlbXBsYXRlO1xyXG4gICAgb2xkLnR5cGUgPSBfbmV3LnR5cGU7XHJcbiAgICBvbGQub3B0aW9ucyA9IF9uZXcub3B0aW9ucztcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCByZWFkeUluc3RhbmNlcygpOiB2b2lkIHtcclxuICAgIHRoaXMudG9wTGVmdEluc3RhbmNlcyA9IHRoaXMuaW5zdGFuY2VzLmZpbHRlcihtID0+IG0ub3B0aW9ucy5wbGFjZW1lbnQgPT09ICd0b3BMZWZ0Jyk7XHJcbiAgICB0aGlzLnRvcFJpZ2h0SW5zdGFuY2VzID0gdGhpcy5pbnN0YW5jZXMuZmlsdGVyKG0gPT4gbS5vcHRpb25zLnBsYWNlbWVudCA9PT0gJ3RvcFJpZ2h0JyB8fCAhbS5vcHRpb25zLnBsYWNlbWVudCk7XHJcbiAgICB0aGlzLmJvdHRvbUxlZnRJbnN0YW5jZXMgPSB0aGlzLmluc3RhbmNlcy5maWx0ZXIobSA9PiBtLm9wdGlvbnMucGxhY2VtZW50ID09PSAnYm90dG9tTGVmdCcpO1xyXG4gICAgdGhpcy5ib3R0b21SaWdodEluc3RhbmNlcyA9IHRoaXMuaW5zdGFuY2VzLmZpbHRlcihtID0+IG0ub3B0aW9ucy5wbGFjZW1lbnQgPT09ICdib3R0b21SaWdodCcpO1xyXG5cclxuICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBtZXJnZU9wdGlvbnMob3B0aW9ucz86IFREU05vdGlmaWNhdGlvbkRhdGFPcHRpb25zKTogVERTTm90aWZpY2F0aW9uRGF0YU9wdGlvbnMge1xyXG4gICAgY29uc3QgeyBkdXJhdGlvbiwgYW5pbWF0ZSwgcGF1c2VPbkhvdmVyLCBwbGFjZW1lbnQgfSA9IHRoaXMuY29uZmlnO1xyXG4gICAgcmV0dXJuIHsgZHVyYXRpb24sIGFuaW1hdGUsIHBhdXNlT25Ib3ZlciwgcGxhY2VtZW50OiBwbGFjZW1lbnQsIC4uLm9wdGlvbnMgfTtcclxuICB9XHJcbn1cclxuIl19