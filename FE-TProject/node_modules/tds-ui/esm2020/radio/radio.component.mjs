import { __decorate } from "tslib";
import { ChangeDetectionStrategy, Component, forwardRef, Input, Optional, ViewChild, ViewEncapsulation } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
//import { ButtonSize } from 'tds-ui';
import { InputBoolean } from 'tds-ui/shared/utility';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/a11y";
import * as i2 from "@angular/cdk/bidi";
import * as i3 from "./radio.service";
import * as i4 from "./radio-button.directive";
import * as i5 from "@angular/common";
const _c0 = ["inputElement"];
const _c1 = ["tds-radio", ""];
function TDSRadioComponent_span_3_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "span", 4);
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵstyleProp("width", ctx_r1.widthHeight, "px")("height", ctx_r1.widthHeight, "px");
    i0.ɵɵproperty("ngClass", ctx_r1.contentClass);
} }
const _c2 = function (a0) { return { "relative p-0 m-0 inline-block outline-none": a0 }; };
const _c3 = ["*"];
export class TDSRadioComponent {
    constructor(elementRef, cdr, focusMonitor, directionality, tdsRadioService, tdsRadioButtonDirective) {
        this.elementRef = elementRef;
        this.cdr = cdr;
        this.focusMonitor = focusMonitor;
        this.directionality = directionality;
        this.tdsRadioService = tdsRadioService;
        this.tdsRadioButtonDirective = tdsRadioButtonDirective;
        this.isNgModel = false;
        this.destroy$ = new Subject();
        this.isChecked = false;
        this.name = null;
        this.isRadioButton = !!this.tdsRadioButtonDirective;
        this.onChange = () => { };
        this.onTouched = () => { };
        this.value = null;
        this.disabled = false;
        this.autoFocus = false;
        this.size = "md";
        this.dir = 'ltr';
        this.contentClass = {};
    }
    onHostClick(event) {
        /** prevent label click triggered twice. **/
        event.stopPropagation();
        event.preventDefault();
        if (!this.disabled && !this.isChecked) {
            if (this.tdsRadioService) {
                this.tdsRadioService.select(this.value);
            }
            if (this.isNgModel) {
                this.isChecked = true;
                this.buildNgClass();
                this.onChange(true);
            }
        }
    }
    focus() {
        this.focusMonitor.focusVia(this.inputElement, 'keyboard');
    }
    blur() {
        this.inputElement.nativeElement.blur();
    }
    setDisabledState(disabled) {
        this.disabled = disabled;
        this.buildNgClass();
        this.cdr.markForCheck();
    }
    writeValue(value) {
        this.isChecked = value;
        this.buildNgClass();
        this.cdr.markForCheck();
    }
    registerOnChange(fn) {
        this.isNgModel = true;
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    ngOnInit() {
        if (this.tdsRadioService) {
            this.tdsRadioService.name$.pipe(takeUntil(this.destroy$)).subscribe(name => {
                this.name = name;
                this.cdr.markForCheck();
            });
            this.tdsRadioService.disabled$.pipe(takeUntil(this.destroy$)).subscribe(disabled => {
                this.disabled = disabled;
                this.buildNgClass();
                this.cdr.markForCheck();
            });
            this.tdsRadioService.selected$.pipe(takeUntil(this.destroy$)).subscribe(value => {
                this.isChecked = this.value === value;
                this.buildNgClass();
                this.cdr.markForCheck();
            });
            this.tdsRadioService.size$.pipe(takeUntil(this.destroy$)).subscribe(size => {
                this.size = size;
                this.buildNgClass();
                this.cdr.markForCheck();
            });
        }
        this.focusMonitor
            .monitor(this.elementRef, true)
            .pipe(takeUntil(this.destroy$))
            .subscribe(focusOrigin => {
            if (!focusOrigin) {
                Promise.resolve().then(() => this.onTouched());
                if (this.tdsRadioService) {
                    this.tdsRadioService.touch();
                }
            }
        });
        this.directionality.change?.pipe(takeUntil(this.destroy$)).subscribe((direction) => {
            this.dir = direction;
            this.cdr.detectChanges();
        });
        this.dir = this.directionality.value;
    }
    ngAfterViewInit() {
        if (this.autoFocus) {
            this.focus();
        }
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
        this.focusMonitor.stopMonitoring(this.elementRef);
    }
    get widthHeight() {
        let result = 18;
        switch (this.size) {
            case 'sm':
                result = 16;
                break;
            case 'md':
                result = 18;
                break;
            case 'lg':
                result = 20;
                break;
            default:
                result = 18;
                break;
        }
        return result;
    }
    buildNgClass() {
        let cls = {
            'border-4 ': this.isChecked,
            'border-primary-1 ': this.isChecked && !this.disabled,
            'border-neutral-2-200 dark:border-d-neutral-2-200': !this.isChecked || this.disabled,
            'border dark:bg-d-neutral-3-50': !this.isChecked,
            'bg-neutral-3-100': !this.isChecked && this.disabled,
            'bg-white group-hover:border-primary-1 ': !this.disabled,
        };
        this.contentClass = cls;
    }
}
TDSRadioComponent.ɵfac = function TDSRadioComponent_Factory(t) { return new (t || TDSRadioComponent)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.FocusMonitor), i0.ɵɵdirectiveInject(i2.Directionality, 8), i0.ɵɵdirectiveInject(i3.TDSRadioService, 8), i0.ɵɵdirectiveInject(i4.TDSRadioButtonDirective, 8)); };
TDSRadioComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSRadioComponent, selectors: [["", "tds-radio", ""], ["", "tds-radio-button", ""]], viewQuery: function TDSRadioComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(_c0, 5);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.inputElement = _t.first);
    } }, hostAttrs: [1, "relative", "inline-flex", "box-border", "p-0", "mr-2", "items-center", "text-neutral-1-900", "dark:text-d-neutral-1-900", "text-body-2", "font-regular"], hostVars: 22, hostBindings: function TDSRadioComponent_HostBindings(rf, ctx) { if (rf & 1) {
        i0.ɵɵlistener("click", function TDSRadioComponent_click_HostBindingHandler($event) { return ctx.onHostClick($event); });
    } if (rf & 2) {
        i0.ɵɵclassProp("tds-radio-wrapper", !ctx.isRadioButton)("tds-radio-button-wrapper", ctx.isRadioButton)("tds-radio-wrapper-checked", ctx.isChecked && !ctx.isRadioButton)("tds-radio-button-wrapper-checked", ctx.isChecked && ctx.isRadioButton)("tds-radio-wrapper-disabled", ctx.disabled && !ctx.isRadioButton)("tds-radio-button-wrapper-disabled", ctx.disabled && ctx.isRadioButton)("tds-radio-wrapper-rtl", !ctx.isRadioButton && ctx.dir === "rtl")("tds-radio-button-wrapper-rtl", ctx.isRadioButton && ctx.dir === "rtl")("cursor-pointer", !ctx.disabled)("cursor-not-allowed", ctx.disabled)("group", !ctx.disabled);
    } }, inputs: { value: "value", disabled: "disabled", autoFocus: "autoFocus", size: "size" }, exportAs: ["tdsRadio"], features: [i0.ɵɵProvidersFeature([
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => TDSRadioComponent),
                multi: true
            }
        ])], attrs: _c1, ngContentSelectors: _c3, decls: 6, vars: 28, consts: [[3, "ngClass"], ["type", "radio", 1, "absolute", "inset-0", "opacity-0", "z-10", 3, "disabled", "checked"], ["inputElement", ""], ["class", "relative top-0 left-0 block tds-radio-inner rounded-full mr-2", 3, "ngClass", "width", "height", 4, "ngIf"], [1, "relative", "top-0", "left-0", "block", "tds-radio-inner", "rounded-full", "mr-2", 3, "ngClass"]], template: function TDSRadioComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵprojectionDef();
        i0.ɵɵelementStart(0, "span", 0);
        i0.ɵɵelement(1, "input", 1, 2);
        i0.ɵɵtemplate(3, TDSRadioComponent_span_3_Template, 1, 5, "span", 3);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(4, "span");
        i0.ɵɵprojection(5);
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵclassProp("tds-radio", !ctx.isRadioButton)("tds-radio-checked", ctx.isChecked && !ctx.isRadioButton)("tds-radio-disabled", ctx.disabled && !ctx.isRadioButton)("tds-radio-button", ctx.isRadioButton)("tds-radio-button-checked", ctx.isChecked && ctx.isRadioButton)("tds-radio-button-disabled", ctx.disabled && ctx.isRadioButton);
        i0.ɵɵproperty("ngClass", i0.ɵɵpureFunction1(26, _c2, !ctx.isRadioButton));
        i0.ɵɵadvance(1);
        i0.ɵɵclassProp("tds-radio-input", !ctx.isRadioButton)("tds-radio-button-input", ctx.isRadioButton)("cursor-pointer", !ctx.disabled)("cursor-not-allowed", ctx.disabled);
        i0.ɵɵproperty("disabled", ctx.disabled)("checked", ctx.isChecked);
        i0.ɵɵattribute("autofocus", ctx.autoFocus ? "autofocus" : null)("name", ctx.name);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("ngIf", !ctx.isRadioButton);
    } }, directives: [i5.NgClass, TDSRadioComponent, i4.TDSRadioButtonDirective, i5.NgIf], encapsulation: 2, changeDetection: 0 });
__decorate([
    InputBoolean()
], TDSRadioComponent.prototype, "disabled", void 0);
__decorate([
    InputBoolean()
], TDSRadioComponent.prototype, "autoFocus", void 0);
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSRadioComponent, [{
        type: Component,
        args: [{
                selector: '[tds-radio],[tds-radio-button]',
                exportAs: 'tdsRadio',
                preserveWhitespaces: false,
                template: `
    <span
    [ngClass]="{'relative p-0 m-0 inline-block outline-none':!isRadioButton}"
      [class.tds-radio]="!isRadioButton"
      [class.tds-radio-checked]="isChecked && !isRadioButton"
      [class.tds-radio-disabled]="disabled && !isRadioButton"
      [class.tds-radio-button]="isRadioButton"
      [class.tds-radio-button-checked]="isChecked && isRadioButton"
      [class.tds-radio-button-disabled]="disabled && isRadioButton"
    >
      <input
        #inputElement
        type="radio"
        [attr.autofocus]="autoFocus ? 'autofocus' : null"
        [class.tds-radio-input]="!isRadioButton"
        [class.tds-radio-button-input]="isRadioButton"
        [disabled]="disabled"
        [checked]="isChecked"
        [attr.name]="name"
        class="absolute inset-0 opacity-0 z-10"
       [class.cursor-pointer]="!this.disabled"
       [class.cursor-not-allowed]="this.disabled"
      />
      <span 
      *ngIf="!isRadioButton"
      [ngClass]="contentClass"
      class="relative top-0 left-0 block tds-radio-inner rounded-full mr-2"
      [style.width.px]="widthHeight"
      [style.height.px]="widthHeight"
      ></span>
      <!-- <span
      *ngIf="isRadioButton"      
      class="relative top-0 left-0 block tds-radio-button-inner  w-4 h-4 rounded-full mr-2"
      [ngClass]="{'border-4 border-primary-1':isChecked && !isRadioButton,
      'border border-neutral-2-200 dark:border-d-neutral-2-200':!isChecked && !isRadioButton}"
      ></span> -->
    </span>
    <span><ng-content></ng-content></span>
  `,
                encapsulation: ViewEncapsulation.None,
                changeDetection: ChangeDetectionStrategy.OnPush,
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef(() => TDSRadioComponent),
                        multi: true
                    }
                ],
                host: {
                    '[class.tds-radio-wrapper]': '!isRadioButton',
                    '[class.tds-radio-button-wrapper]': 'isRadioButton',
                    '[class.tds-radio-wrapper-checked]': 'isChecked && !isRadioButton',
                    '[class.tds-radio-button-wrapper-checked]': 'isChecked && isRadioButton',
                    '[class.tds-radio-wrapper-disabled]': 'disabled && !isRadioButton',
                    '[class.tds-radio-button-wrapper-disabled]': 'disabled && isRadioButton',
                    '[class.tds-radio-wrapper-rtl]': `!isRadioButton && dir === 'rtl'`,
                    '[class.tds-radio-button-wrapper-rtl]': `isRadioButton && dir === 'rtl'`,
                    'class': "relative inline-flex box-border p-0 mr-2 items-center text-neutral-1-900 dark:text-d-neutral-1-900 text-body-2 font-regular",
                    '[class.cursor-pointer]': '!disabled',
                    '[class.cursor-not-allowed]': 'disabled',
                    '[class.group]': '!disabled',
                    '(click)': 'onHostClick($event)'
                }
            }]
    }], function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }, { type: i1.FocusMonitor }, { type: i2.Directionality, decorators: [{
                type: Optional
            }] }, { type: i3.TDSRadioService, decorators: [{
                type: Optional
            }] }, { type: i4.TDSRadioButtonDirective, decorators: [{
                type: Optional
            }] }]; }, { inputElement: [{
            type: ViewChild,
            args: ['inputElement', { static: false }]
        }], value: [{
            type: Input
        }], disabled: [{
            type: Input
        }], autoFocus: [{
            type: Input
        }], size: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFkaW8uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvdGRzLXVpL3JhZGlvL3JhZGlvLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBS0EsT0FBTyxFQUVMLHVCQUF1QixFQUV2QixTQUFTLEVBRVQsVUFBVSxFQUNWLEtBQUssRUFHTCxRQUFRLEVBQ1IsU0FBUyxFQUNULGlCQUFpQixFQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0Msc0NBQXNDO0FBQ3RDLE9BQU8sRUFBRSxZQUFZLEVBQTJDLE1BQU0sdUJBQXVCLENBQUM7Ozs7Ozs7Ozs7SUFrQ3hGLDBCQU1ROzs7SUFGUixpREFBOEIsb0NBQUE7SUFGOUIsNkNBQXdCOzs7O0FBdUM5QixNQUFNLE9BQU8saUJBQWlCO0lBMEM1QixZQUNVLFVBQXNCLEVBQ3RCLEdBQXNCLEVBQ3RCLFlBQTBCLEVBQ2QsY0FBOEIsRUFDOUIsZUFBZ0MsRUFDaEMsdUJBQWdEO1FBTDVELGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDZCxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBeUI7UUE1QzlELGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDbEIsYUFBUSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFDdkMsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixTQUFJLEdBQWtCLElBQUksQ0FBQztRQUMzQixrQkFBYSxHQUFH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QUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBc0NUO2dCQUNELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2dCQUNyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtnQkFDL0MsU0FBUyxFQUFFO29CQUNUO3dCQUNFLE9BQU8sRUFBRSxpQkFBaUI7d0JBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLGtCQUFrQixDQUFDO3dCQUNoRCxLQUFLLEVBQUUsSUFBSTtxQkFDWjtpQkFDRjtnQkFDRCxJQUFJLEVBQUU7b0JBQ0osMkJBQTJCLEVBQUUsZ0JBQWdCO29CQUM3QyxrQ0FBa0MsRUFBRSxlQUFlO29CQUNuRCxtQ0FBbUMsRUFBRSw2QkFBNkI7b0JBQ2xFLDBDQUEwQyxFQUFFLDRCQUE0QjtvQkFDeEUsb0NBQW9DLEVBQUUsNEJBQTRCO29CQUNsRSwyQ0FBMkMsRUFBRSwyQkFBMkI7b0JBQ3hFLCtCQUErQixFQUFFLGlDQUFpQztvQkFDbEUsc0NBQXNDLEVBQUUsZ0NBQWdDO29CQUN4RSxPQUFPLEVBQUUsNkhBQTZIO29CQUN0SSx3QkFBd0IsRUFBQyxXQUFXO29CQUNwQyw0QkFBNEIsRUFBQyxVQUFVO29CQUN2QyxlQUFlLEVBQUMsV0FBVztvQkFDM0IsU0FBUyxFQUFFLHFCQUFxQjtpQkFDakM7YUFDRjs7c0JBK0NJLFFBQVE7O3NCQUNSLFFBQVE7O3NCQUNSLFFBQVE7d0JBckNtQyxZQUFZO2tCQUF6RCxTQUFTO21CQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7WUFDbkMsS0FBSztrQkFBYixLQUFLO1lBQ21CLFFBQVE7a0JBQWhDLEtBQUs7WUFDbUIsU0FBUztrQkFBakMsS0FBSztZQUNHLElBQUk7a0JBQVosS0FBSyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuaW1wb3J0IHsgRm9jdXNNb25pdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xyXG5pbXBvcnQgeyBEaXJlY3Rpb24sIERpcmVjdGlvbmFsaXR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2JpZGknO1xyXG5pbXBvcnQgeyBCb29sZWFuSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xyXG5pbXBvcnQge1xyXG4gIEFmdGVyVmlld0luaXQsXHJcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXHJcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgQ29tcG9uZW50LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgZm9yd2FyZFJlZixcclxuICBJbnB1dCxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LFxyXG4gIE9wdGlvbmFsLFxyXG4gIFZpZXdDaGlsZCxcclxuICBWaWV3RW5jYXBzdWxhdGlvblxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG4vL2ltcG9ydCB7IEJ1dHRvblNpemUgfSBmcm9tICd0ZHMtdWknO1xyXG5pbXBvcnQgeyBJbnB1dEJvb2xlYW4sIE9uQ2hhbmdlVHlwZSwgT25Ub3VjaGVkVHlwZSwgVERTU2FmZUFueSB9IGZyb20gJ3Rkcy11aS9zaGFyZWQvdXRpbGl0eSc7XHJcbmltcG9ydCB7IEJ1dHRvblNpemUsIE5nQ2xhc3NJbnRlcmZhY2UgfSBmcm9tIFwidGRzLXVpL2NvcmUvY29uZmlnXCI7XHJcblxyXG5cclxuaW1wb3J0IHsgVERTUmFkaW9CdXR0b25EaXJlY3RpdmUgfSBmcm9tICcuL3JhZGlvLWJ1dHRvbi5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBURFNSYWRpb1NlcnZpY2UgfSBmcm9tICcuL3JhZGlvLnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdbdGRzLXJhZGlvXSxbdGRzLXJhZGlvLWJ1dHRvbl0nLFxyXG4gIGV4cG9ydEFzOiAndGRzUmFkaW8nLFxyXG4gIHByZXNlcnZlV2hpdGVzcGFjZXM6IGZhbHNlLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICA8c3BhblxyXG4gICAgW25nQ2xhc3NdPVwieydyZWxhdGl2ZSBwLTAgbS0wIGlubGluZS1ibG9jayBvdXRsaW5lLW5vbmUnOiFpc1JhZGlvQnV0dG9ufVwiXHJcbiAgICAgIFtjbGFzcy50ZHMtcmFkaW9dPVwiIWlzUmFkaW9CdXR0b25cIlxyXG4gICAgICBbY2xhc3MudGRzLXJhZGlvLWNoZWNrZWRdPVwiaXNDaGVja2VkICYmICFpc1JhZGlvQnV0dG9uXCJcclxuICAgICAgW2NsYXNzLnRkcy1yYWRpby1kaXNhYmxlZF09XCJkaXNhYmxlZCAmJiAhaXNSYWRpb0J1dHRvblwiXHJcbiAgICAgIFtjbGFzcy50ZHMtcmFkaW8tYnV0dG9uXT1cImlzUmFkaW9CdXR0b25cIlxyXG4gICAgICBbY2xhc3MudGRzLXJhZGlvLWJ1dHRvbi1jaGVja2VkXT1cImlzQ2hlY2tlZCAmJiBpc1JhZGlvQnV0dG9uXCJcclxuICAgICAgW2NsYXNzLnRkcy1yYWRpby1idXR0b24tZGlzYWJsZWRdPVwiZGlzYWJsZWQgJiYgaXNSYWRpb0J1dHRvblwiXHJcbiAgICA+XHJcbiAgICAgIDxpbnB1dFxyXG4gICAgICAgICNpbnB1dEVsZW1lbnRcclxuICAgICAgICB0eXBlPVwicmFkaW9cIlxyXG4gICAgICAgIFthdHRyLmF1dG9mb2N1c109XCJhdXRvRm9jdXMgPyAnYXV0b2ZvY3VzJyA6IG51bGxcIlxyXG4gICAgICAgIFtjbGFzcy50ZHMtcmFkaW8taW5wdXRdPVwiIWlzUmFkaW9CdXR0b25cIlxyXG4gICAgICAgIFtjbGFzcy50ZHMtcmFkaW8tYnV0dG9uLWlucHV0XT1cImlzUmFkaW9CdXR0b25cIlxyXG4gICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXHJcbiAgICAgICAgW2NoZWNrZWRdPVwiaXNDaGVja2VkXCJcclxuICAgICAgICBbYXR0ci5uYW1lXT1cIm5hbWVcIlxyXG4gICAgICAgIGNsYXNzPVwiYWJzb2x1dGUgaW5zZXQtMCBvcGFjaXR5LTAgei0xMFwiXHJcbiAgICAgICBbY2xhc3MuY3Vyc29yLXBvaW50ZXJdPVwiIXRoaXMuZGlzYWJsZWRcIlxyXG4gICAgICAgW2NsYXNzLmN1cnNvci1ub3QtYWxsb3dlZF09XCJ0aGlzLmRpc2FibGVkXCJcclxuICAgICAgLz5cclxuICAgICAgPHNwYW4gXHJcbiAgICAgICpuZ0lmPVwiIWlzUmFkaW9CdXR0b25cIlxyXG4gICAgICBbbmdDbGFzc109XCJjb250ZW50Q2xhc3NcIlxyXG4gICAgICBjbGFzcz1cInJlbGF0aXZlIHRvcC0wIGxlZnQtMCBibG9jayB0ZHMtcmFkaW8taW5uZXIgcm91bmRlZC1mdWxsIG1yLTJcIlxyXG4gICAgICBbc3R5bGUud2lkdGgucHhdPVwid2lkdGhIZWlnaHRcIlxyXG4gICAgICBbc3R5bGUuaGVpZ2h0LnB4XT1cIndpZHRoSGVpZ2h0XCJcclxuICAgICAgPjwvc3Bhbj5cclxuICAgICAgPCEtLSA8c3BhblxyXG4gICAgICAqbmdJZj1cImlzUmFkaW9CdXR0b25cIiAgICAgIFxyXG4gICAgICBjbGFzcz1cInJlbGF0aXZlIHRvcC0wIGxlZnQtMCBibG9jayB0ZHMtcmFkaW8tYnV0dG9uLWlubmVyICB3LTQgaC00IHJvdW5kZWQtZnVsbCBtci0yXCJcclxuICAgICAgW25nQ2xhc3NdPVwieydib3JkZXItNCBib3JkZXItcHJpbWFyeS0xJzppc0NoZWNrZWQgJiYgIWlzUmFkaW9CdXR0b24sXHJcbiAgICAgICdib3JkZXIgYm9yZGVyLW5ldXRyYWwtMi0yMDAgZGFyazpib3JkZXItZC1uZXV0cmFsLTItMjAwJzohaXNDaGVja2VkICYmICFpc1JhZGlvQnV0dG9ufVwiXHJcbiAgICAgID48L3NwYW4+IC0tPlxyXG4gICAgPC9zcGFuPlxyXG4gICAgPHNwYW4+PG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50Pjwvc3Bhbj5cclxuICBgLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICB7XHJcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBURFNSYWRpb0NvbXBvbmVudCksXHJcbiAgICAgIG11bHRpOiB0cnVlXHJcbiAgICB9XHJcbiAgXSxcclxuICBob3N0OiB7XHJcbiAgICAnW2NsYXNzLnRkcy1yYWRpby13cmFwcGVyXSc6ICchaXNSYWRpb0J1dHRvbicsXHJcbiAgICAnW2NsYXNzLnRkcy1yYWRpby1idXR0b24td3JhcHBlcl0nOiAnaXNSYWRpb0J1dHRvbicsXHJcbiAgICAnW2NsYXNzLnRkcy1yYWRpby13cmFwcGVyLWNoZWNrZWRdJzogJ2lzQ2hlY2tlZCAmJiAhaXNSYWRpb0J1dHRvbicsXHJcbiAgICAnW2NsYXNzLnRkcy1yYWRpby1idXR0b24td3JhcHBlci1jaGVja2VkXSc6ICdpc0NoZWNrZWQgJiYgaXNSYWRpb0J1dHRvbicsXHJcbiAgICAnW2NsYXNzLnRkcy1yYWRpby13cmFwcGVyLWRpc2FibGVkXSc6ICdkaXNhYmxlZCAmJiAhaXNSYWRpb0J1dHRvbicsXHJcbiAgICAnW2NsYXNzLnRkcy1yYWRpby1idXR0b24td3JhcHBlci1kaXNhYmxlZF0nOiAnZGlzYWJsZWQgJiYgaXNSYWRpb0J1dHRvbicsXHJcbiAgICAnW2NsYXNzLnRkcy1yYWRpby13cmFwcGVyLXJ0bF0nOiBgIWlzUmFkaW9CdXR0b24gJiYgZGlyID09PSAncnRsJ2AsXHJcbiAgICAnW2NsYXNzLnRkcy1yYWRpby1idXR0b24td3JhcHBlci1ydGxdJzogYGlzUmFkaW9CdXR0b24gJiYgZGlyID09PSAncnRsJ2AsXHJcbiAgICAnY2xhc3MnOiBcInJlbGF0aXZlIGlubGluZS1mbGV4IGJveC1ib3JkZXIgcC0wIG1yLTIgaXRlbXMtY2VudGVyIHRleHQtbmV1dHJhbC0xLTkwMCBkYXJrOnRleHQtZC1uZXV0cmFsLTEtOTAwIHRleHQtYm9keS0yIGZvbnQtcmVndWxhclwiLFxyXG4gICAgJ1tjbGFzcy5jdXJzb3ItcG9pbnRlcl0nOichZGlzYWJsZWQnLCBcclxuICAgICdbY2xhc3MuY3Vyc29yLW5vdC1hbGxvd2VkXSc6J2Rpc2FibGVkJyxcclxuICAgICdbY2xhc3MuZ3JvdXBdJzonIWRpc2FibGVkJywgXHJcbiAgICAnKGNsaWNrKSc6ICdvbkhvc3RDbGljaygkZXZlbnQpJ1xyXG4gIH1cclxufSlcclxuZXhwb3J0IGNsYXNzIFREU1JhZGlvQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgT25Jbml0IHtcclxuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfZGlzYWJsZWQ6IEJvb2xlYW5JbnB1dDtcclxuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfYXV0b0ZvY3VzOiBCb29sZWFuSW5wdXQ7XHJcblxyXG4gIHByaXZhdGUgaXNOZ01vZGVsID0gZmFsc2U7XHJcbiAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcbiAgaXNDaGVja2VkID0gZmFsc2U7XHJcbiAgbmFtZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgaXNSYWRpb0J1dHRvbiA9ICEhdGhpcy50ZHNSYWRpb0J1dHRvbkRpcmVjdGl2ZTtcclxuICBvbkNoYW5nZTogT25DaGFuZ2VUeXBlID0gKCkgPT4geyB9O1xyXG4gIG9uVG91Y2hlZDogT25Ub3VjaGVkVHlwZSA9ICgpID0+IHsgfTtcclxuICBAVmlld0NoaWxkKCdpbnB1dEVsZW1lbnQnLCB7IHN0YXRpYzogZmFsc2UgfSkgaW5wdXRFbGVtZW50PzogRWxlbWVudFJlZjtcclxuICBASW5wdXQoKSB2YWx1ZTogVERTU2FmZUFueSB8IG51bGwgPSBudWxsO1xyXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSBkaXNhYmxlZCA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSBhdXRvRm9jdXMgPSBmYWxzZTtcclxuICBASW5wdXQoKSBzaXplOiBCdXR0b25TaXplID0gXCJtZFwiO1xyXG4gIGRpcjogRGlyZWN0aW9uID0gJ2x0cic7XHJcbiAgY29udGVudENsYXNzOiBOZ0NsYXNzSW50ZXJmYWNlID0ge307XHJcbiAgb25Ib3N0Q2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkIHtcclxuICAgIC8qKiBwcmV2ZW50IGxhYmVsIGNsaWNrIHRyaWdnZXJlZCB0d2ljZS4gKiovXHJcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQgJiYgIXRoaXMuaXNDaGVja2VkKSB7XHJcbiAgICAgIGlmICh0aGlzLnRkc1JhZGlvU2VydmljZSkge1xyXG4gICAgICAgIHRoaXMudGRzUmFkaW9TZXJ2aWNlLnNlbGVjdCh0aGlzLnZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5pc05nTW9kZWwpIHtcclxuICAgICAgICB0aGlzLmlzQ2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5idWlsZE5nQ2xhc3MoKTtcclxuICAgICAgICB0aGlzLm9uQ2hhbmdlKHRydWUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmb2N1cygpOiB2b2lkIHtcclxuICAgIHRoaXMuZm9jdXNNb25pdG9yLmZvY3VzVmlhKHRoaXMuaW5wdXRFbGVtZW50ISwgJ2tleWJvYXJkJyk7XHJcbiAgfVxyXG5cclxuICBibHVyKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pbnB1dEVsZW1lbnQhLm5hdGl2ZUVsZW1lbnQuYmx1cigpO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBwcml2YXRlIGZvY3VzTW9uaXRvcjogRm9jdXNNb25pdG9yLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBkaXJlY3Rpb25hbGl0eTogRGlyZWN0aW9uYWxpdHksXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIHRkc1JhZGlvU2VydmljZTogVERTUmFkaW9TZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSB0ZHNSYWRpb0J1dHRvbkRpcmVjdGl2ZTogVERTUmFkaW9CdXR0b25EaXJlY3RpdmVcclxuICApIHsgfVxyXG5cclxuICBzZXREaXNhYmxlZFN0YXRlKGRpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc2FibGVkID0gZGlzYWJsZWQ7XHJcbiAgICB0aGlzLmJ1aWxkTmdDbGFzcygpXHJcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcclxuICB9XHJcblxyXG4gIHdyaXRlVmFsdWUodmFsdWU6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIHRoaXMuaXNDaGVja2VkID0gdmFsdWU7XHJcbiAgICB0aGlzLmJ1aWxkTmdDbGFzcygpXHJcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IE9uQ2hhbmdlVHlwZSk6IHZvaWQge1xyXG4gICAgdGhpcy5pc05nTW9kZWwgPSB0cnVlO1xyXG4gICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IE9uVG91Y2hlZFR5cGUpOiB2b2lkIHtcclxuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLnRkc1JhZGlvU2VydmljZSkge1xyXG4gICAgICB0aGlzLnRkc1JhZGlvU2VydmljZS5uYW1lJC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKG5hbWUgPT4ge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLnRkc1JhZGlvU2VydmljZS5kaXNhYmxlZCQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShkaXNhYmxlZCA9PiB7XHJcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGRpc2FibGVkO1xyXG4gICAgICAgIHRoaXMuYnVpbGROZ0NsYXNzKClcclxuICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMudGRzUmFkaW9TZXJ2aWNlLnNlbGVjdGVkJC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICB0aGlzLmlzQ2hlY2tlZCA9IHRoaXMudmFsdWUgPT09IHZhbHVlO1xyXG4gICAgICAgIHRoaXMuYnVpbGROZ0NsYXNzKClcclxuICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMudGRzUmFkaW9TZXJ2aWNlLnNpemUkLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoc2l6ZSA9PiB7XHJcbiAgICAgICAgdGhpcy5zaXplID0gc2l6ZTtcclxuICAgICAgICB0aGlzLmJ1aWxkTmdDbGFzcygpXHJcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5mb2N1c01vbml0b3JcclxuICAgICAgLm1vbml0b3IodGhpcy5lbGVtZW50UmVmLCB0cnVlKVxyXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXHJcbiAgICAgIC5zdWJzY3JpYmUoZm9jdXNPcmlnaW4gPT4ge1xyXG4gICAgICAgIGlmICghZm9jdXNPcmlnaW4pIHtcclxuICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCkgPT4gdGhpcy5vblRvdWNoZWQoKSk7XHJcbiAgICAgICAgICBpZiAodGhpcy50ZHNSYWRpb1NlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy50ZHNSYWRpb1NlcnZpY2UudG91Y2goKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMuZGlyZWN0aW9uYWxpdHkuY2hhbmdlPy5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChkaXJlY3Rpb246IERpcmVjdGlvbikgPT4ge1xyXG4gICAgICB0aGlzLmRpciA9IGRpcmVjdGlvbjtcclxuICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5kaXIgPSB0aGlzLmRpcmVjdGlvbmFsaXR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuYXV0b0ZvY3VzKSB7XHJcbiAgICAgIHRoaXMuZm9jdXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XHJcbiAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLmZvY3VzTW9uaXRvci5zdG9wTW9uaXRvcmluZyh0aGlzLmVsZW1lbnRSZWYpO1xyXG4gIH1cclxuICBnZXQgd2lkdGhIZWlnaHQoKSB7XHJcbiAgICBsZXQgcmVzdWx0ID0gMTg7XHJcbiAgICBzd2l0Y2ggKHRoaXMuc2l6ZSkge1xyXG4gICAgICBjYXNlICdzbSc6XHJcbiAgICAgICAgcmVzdWx0ID0gMTZcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbWQnOlxyXG4gICAgICAgIHJlc3VsdCA9IDE4XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xnJzpcclxuICAgICAgICByZXN1bHQgPSAyMFxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJlc3VsdCA9IDE4XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuICBidWlsZE5nQ2xhc3MoKSB7XHJcbiAgICBsZXQgY2xzID0ge1xyXG4gICAgICAnYm9yZGVyLTQgJzogdGhpcy5pc0NoZWNrZWQsXHJcbiAgICAgICdib3JkZXItcHJpbWFyeS0xICc6dGhpcy5pc0NoZWNrZWQgJiYgIXRoaXMuZGlzYWJsZWQsXHJcbiAgICAgICdib3JkZXItbmV1dHJhbC0yLTIwMCBkYXJrOmJvcmRlci1kLW5ldXRyYWwtMi0yMDAnOiF0aGlzLmlzQ2hlY2tlZCB8fCB0aGlzLmRpc2FibGVkLFxyXG4gICAgICAnYm9yZGVyIGRhcms6YmctZC1uZXV0cmFsLTMtNTAnOiAhdGhpcy5pc0NoZWNrZWQsXHJcbiAgICAgICdiZy1uZXV0cmFsLTMtMTAwJzogIXRoaXMuaXNDaGVja2VkICYmIHRoaXMuZGlzYWJsZWQsXHJcbiAgICAgICdiZy13aGl0ZSBncm91cC1ob3Zlcjpib3JkZXItcHJpbWFyeS0xICc6ICF0aGlzLmRpc2FibGVkLFxyXG4gICAgfVxyXG4gICAgdGhpcy5jb250ZW50Q2xhc3MgPSBjbHM7XHJcbiAgfVxyXG59XHJcbiJdfQ==