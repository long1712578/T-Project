import { __decorate } from "tslib";
import { ChangeDetectionStrategy, Component, Input, Optional, ViewEncapsulation } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { WithConfig } from 'tds-ui/core/config';
import { InputBoolean } from 'tds-ui/shared/utility';
import * as i0 from "@angular/core";
import * as i1 from "tds-ui/core/config";
import * as i2 from "@angular/cdk/bidi";
const _c0 = ["*"];
const TDS_CONFIG_MODULE_NAME = 'collapse';
export class TDSCollapseComponent {
    constructor(tdsConfigService, cdr, elementRef, directionality) {
        this.tdsConfigService = tdsConfigService;
        this.cdr = cdr;
        this.elementRef = elementRef;
        this.directionality = directionality;
        this._tdsModuleName = TDS_CONFIG_MODULE_NAME;
        this.accordion = false;
        this.bordered = true;
        this.ghost = false;
        this.expandIconPosition = 'left';
        this.dir = 'ltr';
        this.listOfTDSCollapsePanelComponent = [];
        this.destroy$ = new Subject();
        // TODO: move to host after View Engine deprecation
        this.elementRef.nativeElement.classList.add('tds-collapse');
        this.tdsConfigService
            .getConfigChangeEventForComponent(TDS_CONFIG_MODULE_NAME)
            .pipe(takeUntil(this.destroy$))
            .subscribe(() => {
            this.cdr.markForCheck();
        });
    }
    ngOnInit() {
        this.directionality.change?.pipe(takeUntil(this.destroy$)).subscribe((direction) => {
            this.dir = direction;
            this.cdr.detectChanges();
        });
        this.dir = this.directionality.value;
    }
    addPanel(value) {
        this.listOfTDSCollapsePanelComponent.push(value);
    }
    removePanel(value) {
        this.listOfTDSCollapsePanelComponent.splice(this.listOfTDSCollapsePanelComponent.indexOf(value), 1);
    }
    click(collapse) {
        if (this.accordion && !collapse.active) {
            this.listOfTDSCollapsePanelComponent
                .filter(item => item !== collapse)
                .forEach(item => {
                if (item.active) {
                    item.active = false;
                    item.activeChange.emit(item.active);
                    item.markForCheck();
                }
            });
        }
        collapse.active = !collapse.active;
        collapse.activeChange.emit(collapse.active);
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
}
TDSCollapseComponent.ɵfac = function TDSCollapseComponent_Factory(t) { return new (t || TDSCollapseComponent)(i0.ɵɵdirectiveInject(i1.TDSConfigService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i2.Directionality, 8)); };
TDSCollapseComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSCollapseComponent, selectors: [["tds-collapse"]], hostAttrs: [1, "block", "box-border", "m-0", "p-0", "rounded"], hostVars: 18, hostBindings: function TDSCollapseComponent_HostBindings(rf, ctx) { if (rf & 2) {
        i0.ɵɵclassProp("tds-collapse-icon-position-left", ctx.expandIconPosition === "left")("tds-collapse-icon-position-right", ctx.expandIconPosition === "right")("tds-collapse-ghost", ctx.ghost)("tds-collapse-borderless", !ctx.bordered)("tds-collapse-rtl", ctx.dir === "rtl")("border", ctx.bordered)("border-neutral-2-200", ctx.bordered)("dark:border-d-neutral-2-200", ctx.bordered)("border-b-0", ctx.bordered);
    } }, inputs: { accordion: "accordion", bordered: "bordered", ghost: "ghost", expandIconPosition: "expandIconPosition" }, exportAs: ["tdsCollapse"], ngContentSelectors: _c0, decls: 1, vars: 0, template: function TDSCollapseComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵprojectionDef();
        i0.ɵɵprojection(0);
    } }, encapsulation: 2, changeDetection: 0 });
__decorate([
    WithConfig(),
    InputBoolean()
], TDSCollapseComponent.prototype, "accordion", void 0);
__decorate([
    WithConfig(),
    InputBoolean()
], TDSCollapseComponent.prototype, "bordered", void 0);
__decorate([
    WithConfig(),
    InputBoolean()
], TDSCollapseComponent.prototype, "ghost", void 0);
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSCollapseComponent, [{
        type: Component,
        args: [{
                selector: 'tds-collapse',
                exportAs: 'tdsCollapse',
                changeDetection: ChangeDetectionStrategy.OnPush,
                encapsulation: ViewEncapsulation.None,
                template: `
    <ng-content></ng-content>
  `,
                host: {
                    "class": "block box-border m-0 p-0 rounded",
                    '[class.tds-collapse-icon-position-left]': `expandIconPosition === 'left'`,
                    '[class.tds-collapse-icon-position-right]': `expandIconPosition === 'right'`,
                    '[class.tds-collapse-ghost]': `ghost`,
                    '[class.tds-collapse-borderless]': '!bordered',
                    '[class.tds-collapse-rtl]': "dir === 'rtl'",
                    '[class.border]': 'bordered',
                    '[class.border-neutral-2-200]': 'bordered',
                    '[class.dark:border-d-neutral-2-200]': 'bordered',
                    '[class.border-b-0]': 'bordered',
                }
            }]
    }], function () { return [{ type: i1.TDSConfigService }, { type: i0.ChangeDetectorRef }, { type: i0.ElementRef }, { type: i2.Directionality, decorators: [{
                type: Optional
            }] }]; }, { accordion: [{
            type: Input
        }], bordered: [{
            type: Input
        }], ghost: [{
            type: Input
        }], expandIconPosition: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGFwc2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvdGRzLXVpL2NvbGxhcHNlL2NvbGxhcHNlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBSUEsT0FBTyxFQUNMLHVCQUF1QixFQUV2QixTQUFTLEVBRVQsS0FBSyxFQUdMLFFBQVEsRUFDUixpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFrQyxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNoRixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7Ozs7O0FBSXJELE1BQU0sc0JBQXNCLEdBQWlCLFVBQVUsQ0FBQztBQXVCeEQsTUFBTSxPQUFPLG9CQUFvQjtJQWUvQixZQUNTLGdCQUFrQyxFQUNqQyxHQUFzQixFQUN0QixVQUFzQixFQUNWLGNBQThCO1FBSDNDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDakMsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUNWLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQWxCM0MsbUJBQWMsR0FBaUIsc0JBQXNCLENBQUM7UUFLeEIsY0FBUyxHQUFZLEtBQUssQ0FBQztRQUMzQixhQUFRLEdBQVksSUFBSSxDQUFDO1FBQ3pCLFVBQUssR0FBWSxLQUFLLENBQUM7UUFDckQsdUJBQWtCLEdBQXFCLE1BQU0sQ0FBQztRQUV2RCxRQUFHLEdBQWMsS0FBSyxDQUFDO1FBRWYsb0NBQStCLEdBQWdDLEVBQUUsQ0FBQztRQUNsRSxhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQU9yQyxtREFBbUQ7UUFDbkQsSUFBSSxDQUFDLFVB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O29CQUM1RSw0QkFBNEIsRUFBRSxPQUFPO29CQUNyQyxpQ0FBaUMsRUFBRSxXQUFXO29CQUM5QywwQkFBMEIsRUFBRSxlQUFlO29CQUMzQyxnQkFBZ0IsRUFBRSxVQUFVO29CQUM1Qiw4QkFBOEIsRUFBRSxVQUFVO29CQUMxQyxxQ0FBcUMsRUFBRSxVQUFVO29CQUNqRCxvQkFBb0IsRUFBRSxVQUFVO2lCQUNqQzthQUNGOztzQkFvQkksUUFBUTt3QkFiNEIsU0FBUztrQkFBL0MsS0FBSztZQUNpQyxRQUFRO2tCQUE5QyxLQUFLO1lBQ2lDLEtBQUs7a0JBQTNDLEtBQUs7WUFDRyxrQkFBa0I7a0JBQTFCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuXHJcbmltcG9ydCB7IERpcmVjdGlvbiwgRGlyZWN0aW9uYWxpdHkgfSBmcm9tICdAYW5ndWxhci9jZGsvYmlkaSc7XHJcbmltcG9ydCB7IEJvb2xlYW5JbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XHJcbmltcG9ydCB7XHJcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXHJcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgQ29tcG9uZW50LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgSW5wdXQsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxuICBPcHRpb25hbCxcclxuICBWaWV3RW5jYXBzdWxhdGlvblxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgVERTQ29uZmlnS2V5LCBURFNDb25maWdTZXJ2aWNlLCBXaXRoQ29uZmlnIH0gZnJvbSAndGRzLXVpL2NvcmUvY29uZmlnJztcclxuaW1wb3J0IHsgSW5wdXRCb29sZWFuIH0gZnJvbSAndGRzLXVpL3NoYXJlZC91dGlsaXR5JztcclxuXHJcbmltcG9ydCB7IFREU0NvbGxhcHNlUGFuZWxDb21wb25lbnQgfSBmcm9tICcuL2NvbGxhcHNlLXBhbmVsLmNvbXBvbmVudCc7XHJcblxyXG5jb25zdCBURFNfQ09ORklHX01PRFVMRV9OQU1FOiBURFNDb25maWdLZXkgPSAnY29sbGFwc2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd0ZHMtY29sbGFwc2UnLFxyXG4gIGV4cG9ydEFzOiAndGRzQ29sbGFwc2UnLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgdGVtcGxhdGU6IGBcclxuICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cclxuICBgLFxyXG4gIGhvc3Q6IHtcclxuICAgIFwiY2xhc3NcIjpcImJsb2NrIGJveC1ib3JkZXIgbS0wIHAtMCByb3VuZGVkXCIsXHJcbiAgICAnW2NsYXNzLnRkcy1jb2xsYXBzZS1pY29uLXBvc2l0aW9uLWxlZnRdJzogYGV4cGFuZEljb25Qb3NpdGlvbiA9PT0gJ2xlZnQnYCxcclxuICAgICdbY2xhc3MudGRzLWNvbGxhcHNlLWljb24tcG9zaXRpb24tcmlnaHRdJzogYGV4cGFuZEljb25Qb3NpdGlvbiA9PT0gJ3JpZ2h0J2AsXHJcbiAgICAnW2NsYXNzLnRkcy1jb2xsYXBzZS1naG9zdF0nOiBgZ2hvc3RgLFxyXG4gICAgJ1tjbGFzcy50ZHMtY29sbGFwc2UtYm9yZGVybGVzc10nOiAnIWJvcmRlcmVkJyxcclxuICAgICdbY2xhc3MudGRzLWNvbGxhcHNlLXJ0bF0nOiBcImRpciA9PT0gJ3J0bCdcIixcclxuICAgICdbY2xhc3MuYm9yZGVyXSc6ICdib3JkZXJlZCcsXHJcbiAgICAnW2NsYXNzLmJvcmRlci1uZXV0cmFsLTItMjAwXSc6ICdib3JkZXJlZCcsXHJcbiAgICAnW2NsYXNzLmRhcms6Ym9yZGVyLWQtbmV1dHJhbC0yLTIwMF0nOiAnYm9yZGVyZWQnLFxyXG4gICAgJ1tjbGFzcy5ib3JkZXItYi0wXSc6ICdib3JkZXJlZCcsXHJcbiAgfVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVERTQ29sbGFwc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XHJcbiAgcmVhZG9ubHkgX3Rkc01vZHVsZU5hbWU6IFREU0NvbmZpZ0tleSA9IFREU19DT05GSUdfTU9EVUxFX05BTUU7XHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX2FjY29yZGlvbjogQm9vbGVhbklucHV0O1xyXG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV9ib3JkZXJlZDogQm9vbGVhbklucHV0O1xyXG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV9naG9zdDogQm9vbGVhbklucHV0O1xyXG5cclxuICBASW5wdXQoKSBAV2l0aENvbmZpZygpIEBJbnB1dEJvb2xlYW4oKSBhY2NvcmRpb246IGJvb2xlYW4gPSBmYWxzZTtcclxuICBASW5wdXQoKSBAV2l0aENvbmZpZygpIEBJbnB1dEJvb2xlYW4oKSBib3JkZXJlZDogYm9vbGVhbiA9IHRydWU7XHJcbiAgQElucHV0KCkgQFdpdGhDb25maWcoKSBASW5wdXRCb29sZWFuKCkgZ2hvc3Q6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBASW5wdXQoKSBleHBhbmRJY29uUG9zaXRpb246ICdsZWZ0JyB8ICdyaWdodCcgPSAnbGVmdCc7XHJcbiBcclxuICBkaXI6IERpcmVjdGlvbiA9ICdsdHInO1xyXG5cclxuICBwcml2YXRlIGxpc3RPZlREU0NvbGxhcHNlUGFuZWxDb21wb25lbnQ6IFREU0NvbGxhcHNlUGFuZWxDb21wb25lbnRbXSA9IFtdO1xyXG4gIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIHRkc0NvbmZpZ1NlcnZpY2U6IFREU0NvbmZpZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGRpcmVjdGlvbmFsaXR5OiBEaXJlY3Rpb25hbGl0eVxyXG4gICkge1xyXG4gICAgLy8gVE9ETzogbW92ZSB0byBob3N0IGFmdGVyIFZpZXcgRW5naW5lIGRlcHJlY2F0aW9uXHJcbiAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCd0ZHMtY29sbGFwc2UnKTtcclxuXHJcbiAgICB0aGlzLnRkc0NvbmZpZ1NlcnZpY2VcclxuICAgICAgLmdldENvbmZpZ0NoYW5nZUV2ZW50Rm9yQ29tcG9uZW50KFREU19DT05GSUdfTU9EVUxFX05BTUUpXHJcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcclxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpcmVjdGlvbmFsaXR5LmNoYW5nZT8ucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgoZGlyZWN0aW9uOiBEaXJlY3Rpb24pID0+IHtcclxuICAgICAgdGhpcy5kaXIgPSBkaXJlY3Rpb247XHJcbiAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuZGlyID0gdGhpcy5kaXJlY3Rpb25hbGl0eS52YWx1ZTtcclxuICB9XHJcblxyXG4gIGFkZFBhbmVsKHZhbHVlOiBURFNDb2xsYXBzZVBhbmVsQ29tcG9uZW50KTogdm9pZCB7XHJcbiAgICB0aGlzLmxpc3RPZlREU0NvbGxhcHNlUGFuZWxDb21wb25lbnQucHVzaCh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVQYW5lbCh2YWx1ZTogVERTQ29sbGFwc2VQYW5lbENvbXBvbmVudCk6IHZvaWQge1xyXG4gICAgdGhpcy5saXN0T2ZURFNDb2xsYXBzZVBhbmVsQ29tcG9uZW50LnNwbGljZSh0aGlzLmxpc3RPZlREU0NvbGxhcHNlUGFuZWxDb21wb25lbnQuaW5kZXhPZih2YWx1ZSksIDEpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2soY29sbGFwc2U6IFREU0NvbGxhcHNlUGFuZWxDb21wb25lbnQpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmFjY29yZGlvbiAmJiAhY29sbGFwc2UuYWN0aXZlKSB7XHJcbiAgICAgIHRoaXMubGlzdE9mVERTQ29sbGFwc2VQYW5lbENvbXBvbmVudFxyXG4gICAgICAgIC5maWx0ZXIoaXRlbSA9PiBpdGVtICE9PSBjb2xsYXBzZSlcclxuICAgICAgICAuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgIGlmIChpdGVtLmFjdGl2ZSkge1xyXG4gICAgICAgICAgICBpdGVtLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpdGVtLmFjdGl2ZUNoYW5nZS5lbWl0KGl0ZW0uYWN0aXZlKTtcclxuICAgICAgICAgICAgaXRlbS5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGNvbGxhcHNlLmFjdGl2ZSA9ICFjb2xsYXBzZS5hY3RpdmU7XHJcbiAgICBjb2xsYXBzZS5hY3RpdmVDaGFuZ2UuZW1pdChjb2xsYXBzZS5hY3RpdmUpO1xyXG4gIH1cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xyXG4gIH1cclxufVxyXG4iXX0=