import { __decorate } from "tslib";
import { ChangeDetectionStrategy, Component, EventEmitter, Input, Optional, Output, ViewEncapsulation } from '@angular/core';
import { ReplaySubject, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { WithConfig } from "tds-ui/core/config";
import { gridResponsiveMap, TDSBreakpointEnum } from 'tds-ui/core/services';
import { InputBoolean, InputNumber } from 'tds-ui/shared/utility';
import * as i0 from "@angular/core";
import * as i1 from "tds-ui/i18n";
import * as i2 from "tds-ui/core/services";
import * as i3 from "tds-ui/core/config";
import * as i4 from "@angular/cdk/bidi";
import * as i5 from "@angular/common";
import * as i6 from "./pagination-simple.component";
import * as i7 from "./pagination-default.component";
function TDSPaginationComponent_ng_container_0_ng_container_1_ng_template_1_Template(rf, ctx) { }
function TDSPaginationComponent_ng_container_0_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵtemplate(1, TDSPaginationComponent_ng_container_0_ng_container_1_ng_template_1_Template, 0, 0, "ng-template", 6);
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    i0.ɵɵnextContext(2);
    const _r1 = i0.ɵɵreference(2);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngTemplateOutlet", _r1.template);
} }
function TDSPaginationComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵtemplate(1, TDSPaginationComponent_ng_container_0_ng_container_1_Template, 2, 1, "ng-container", 5);
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r0 = i0.ɵɵnextContext();
    const _r2 = i0.ɵɵreference(4);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngIf", ctx_r0.simple)("ngIfElse", _r2.template);
} }
const TDS_CONFIG_MODULE_NAME = 'pagination';
export class TDSPaginationComponent {
    constructor(i18n, cdr, breakpointService, tdsConfigService, directionality, elementRef) {
        this.i18n = i18n;
        this.cdr = cdr;
        this.breakpointService = breakpointService;
        this.tdsConfigService = tdsConfigService;
        this.directionality = directionality;
        this.elementRef = elementRef;
        this._tdsModuleName = TDS_CONFIG_MODULE_NAME;
        this.pageSizeChange = new EventEmitter();
        this.pageIndexChange = new EventEmitter();
        this.showTotal = null;
        this.itemRender = null;
        this.size = 'sm';
        this.pageSizeOptions = [10, 20, 30, 40];
        this.showSizeChanger = false;
        this.showQuickJumper = false;
        this.simple = false;
        this.disabled = false;
        this.responsive = false;
        this.hideOnSinglePage = false;
        this.total = 0;
        this.pageIndex = 1;
        this.pageSize = 10;
        this.showRefresh = false;
        this.bordered = true;
        this.clickRefresh = new EventEmitter();
        this.showPagination = true;
        this._size = "sm";
        this.dir = 'ltr';
        this.destroy$ = new Subject();
        this.total$ = new ReplaySubject(1);
        // TODO: move to host after View Engine deprecation
        this.elementRef.nativeElement.classList.add('tds-pagination');
    }
    validatePageIndex(value, lastIndex) {
        if (value > lastIndex) {
            return lastIndex;
        }
        else if (value < 1) {
            return 1;
        }
        else {
            return value;
        }
    }
    onPageIndexChange(index) {
        const lastIndex = this.getLastIndex(this.total, this.pageSize);
        const validIndex = this.validatePageIndex(index, lastIndex);
        if (validIndex !== this.pageIndex && !this.disabled) {
            this.pageIndex = validIndex;
            this.pageIndexChange.emit(this.pageIndex);
        }
    }
    onPageSizeChange(size) {
        this.pageSize = size;
        this.pageSizeChange.emit(size);
        const lastIndex = this.getLastIndex(this.total, this.pageSize);
        if (this.pageIndex > lastIndex) {
            this.onPageIndexChange(lastIndex);
        }
    }
    onTotalChange(total) {
        const lastIndex = this.getLastIndex(total, this.pageSize);
        if (this.pageIndex > lastIndex) {
            Promise.resolve().then(() => {
                this.onPageIndexChange(lastIndex);
                this.cdr.markForCheck();
            });
        }
    }
    getLastIndex(total, pageSize) {
        return Math.ceil(total / pageSize);
    }
    ngOnInit() {
        this.i18n.localeChange.pipe(takeUntil(this.destroy$)).subscribe(() => {
            this.locale = this.i18n.getLocaleData('Pagination');
            this.cdr.markForCheck();
        });
        this.total$.pipe(takeUntil(this.destroy$)).subscribe(total => {
            this.onTotalChange(total);
        });
        this.breakpointService
            .subscribe(gridResponsiveMap)
            .pipe(takeUntil(this.destroy$))
            .subscribe(bp => {
            if (this.responsive) {
                this._size = bp === TDSBreakpointEnum.xs ? 'sm' : 'md';
                this.cdr.markForCheck();
            }
        });
        this.directionality.change?.pipe(takeUntil(this.destroy$)).subscribe((direction) => {
            this.dir = direction;
            this.cdr.detectChanges();
        });
        this.dir = this.directionality.value;
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    ngOnChanges(changes) {
        const { hideOnSinglePage, total, pageSize, size } = changes;
        if (total) {
            this.total$.next(this.total);
        }
        if (hideOnSinglePage || total || pageSize) {
            this.showPagination =
                (this.hideOnSinglePage && this.total > this.pageSize) || (this.total > 0 && !this.hideOnSinglePage);
        }
        if (size) {
            this._size = size.currentValue;
        }
    }
    onClickRefresh(e) {
        this.clickRefresh.emit(e);
    }
}
TDSPaginationComponent.ɵfac = function TDSPaginationComponent_Factory(t) { return new (t || TDSPaginationComponent)(i0.ɵɵdirectiveInject(i1.TDSI18nService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i2.TDSBreakpointService), i0.ɵɵdirectiveInject(i3.TDSConfigService), i0.ɵɵdirectiveInject(i4.Directionality, 8), i0.ɵɵdirectiveInject(i0.ElementRef)); };
TDSPaginationComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSPaginationComponent, selectors: [["tds-pagination"]], hostVars: 8, hostBindings: function TDSPaginationComponent_HostBindings(rf, ctx) { if (rf & 2) {
        i0.ɵɵclassProp("tds-pagination-simple", ctx.simple)("tds-pagination-disabled", ctx.disabled)("mini", !ctx.simple && ctx._size === "small")("tds-pagination-rtl", ctx.dir === "rtl");
    } }, inputs: { showTotal: "showTotal", itemRender: "itemRender", size: "size", pageSizeOptions: "pageSizeOptions", showSizeChanger: "showSizeChanger", showQuickJumper: "showQuickJumper", simple: "simple", disabled: "disabled", responsive: "responsive", hideOnSinglePage: "hideOnSinglePage", total: "total", pageIndex: "pageIndex", pageSize: "pageSize", showRefresh: "showRefresh", bordered: "bordered" }, outputs: { pageSizeChange: "pageSizeChange", pageIndexChange: "pageIndexChange", clickRefresh: "clickRefresh" }, exportAs: ["tdsPagination"], features: [i0.ɵɵNgOnChangesFeature], decls: 5, vars: 21, consts: [[4, "ngIf"], [3, "disabled", "itemRender", "locale", "pageSize", "total", "pageIndex", "size", "pageIndexChange"], ["simplePagination", ""], [3, "size", "itemRender", "showTotal", "showRefresh", "disabled", "locale", "showSizeChanger", "showQuickJumper", "total", "pageIndex", "pageSize", "pageSizeOptions", "bordered", "pageIndexChange", "pageSizeChange", "clickRefresh"], ["defaultPagination", ""], [4, "ngIf", "ngIfElse"], [3, "ngTemplateOutlet"]], template: function TDSPaginationComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵtemplate(0, TDSPaginationComponent_ng_container_0_Template, 2, 2, "ng-container", 0);
        i0.ɵɵelementStart(1, "tds-pagination-simple", 1, 2);
        i0.ɵɵlistener("pageIndexChange", function TDSPaginationComponent_Template_tds_pagination_simple_pageIndexChange_1_listener($event) { return ctx.onPageIndexChange($event); });
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(3, "tds-pagination-default", 3, 4);
        i0.ɵɵlistener("pageIndexChange", function TDSPaginationComponent_Template_tds_pagination_default_pageIndexChange_3_listener($event) { return ctx.onPageIndexChange($event); })("pageSizeChange", function TDSPaginationComponent_Template_tds_pagination_default_pageSizeChange_3_listener($event) { return ctx.onPageSizeChange($event); })("clickRefresh", function TDSPaginationComponent_Template_tds_pagination_default_clickRefresh_3_listener($event) { return ctx.onClickRefresh($event); });
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵproperty("ngIf", ctx.showPagination);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("disabled", ctx.disabled)("itemRender", ctx.itemRender)("locale", ctx.locale)("pageSize", ctx.pageSize)("total", ctx.total)("pageIndex", ctx.pageIndex)("size", ctx._size);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("size", ctx._size)("itemRender", ctx.itemRender)("showTotal", ctx.showTotal)("showRefresh", ctx.showRefresh)("disabled", ctx.disabled)("locale", ctx.locale)("showSizeChanger", ctx.showSizeChanger)("showQuickJumper", ctx.showQuickJumper)("total", ctx.total)("pageIndex", ctx.pageIndex)("pageSize", ctx.pageSize)("pageSizeOptions", ctx.pageSizeOptions)("bordered", ctx.bordered);
    } }, directives: [i5.NgIf, i5.NgTemplateOutlet, i6.TDSPaginationSimpleComponent, i7.TDSPaginationDefaultComponent], encapsulation: 2, changeDetection: 0 });
__decorate([
    WithConfig()
], TDSPaginationComponent.prototype, "size", void 0);
__decorate([
    WithConfig()
], TDSPaginationComponent.prototype, "pageSizeOptions", void 0);
__decorate([
    WithConfig(),
    InputBoolean()
], TDSPaginationComponent.prototype, "showSizeChanger", void 0);
__decorate([
    WithConfig(),
    InputBoolean()
], TDSPaginationComponent.prototype, "showQuickJumper", void 0);
__decorate([
    WithConfig(),
    InputBoolean()
], TDSPaginationComponent.prototype, "simple", void 0);
__decorate([
    InputBoolean()
], TDSPaginationComponent.prototype, "disabled", void 0);
__decorate([
    InputBoolean()
], TDSPaginationComponent.prototype, "responsive", void 0);
__decorate([
    InputBoolean()
], TDSPaginationComponent.prototype, "hideOnSinglePage", void 0);
__decorate([
    InputNumber()
], TDSPaginationComponent.prototype, "total", void 0);
__decorate([
    InputNumber()
], TDSPaginationComponent.prototype, "pageIndex", void 0);
__decorate([
    InputNumber()
], TDSPaginationComponent.prototype, "pageSize", void 0);
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSPaginationComponent, [{
        type: Component,
        args: [{
                selector: 'tds-pagination',
                exportAs: 'tdsPagination',
                preserveWhitespaces: false,
                encapsulation: ViewEncapsulation.None,
                changeDetection: ChangeDetectionStrategy.OnPush,
                template: `
    <ng-container *ngIf="showPagination">
      <ng-container *ngIf="simple; else defaultPagination.template">
        <ng-template [ngTemplateOutlet]="simplePagination.template"></ng-template>
      </ng-container>
    </ng-container>
    <tds-pagination-simple
      #simplePagination
      [disabled]="disabled"
      [itemRender]="itemRender"
      [locale]="locale"
      [pageSize]="pageSize"
      [total]="total"
      [pageIndex]="pageIndex"
      [size]="_size"
      (pageIndexChange)="onPageIndexChange($event)"
    ></tds-pagination-simple>
    <tds-pagination-default
      #defaultPagination
      [size]="_size"
      [itemRender]="itemRender"
      [showTotal]="showTotal"
      [showRefresh]="showRefresh"
      [disabled]="disabled"
      [locale]="locale"
      [showSizeChanger]="showSizeChanger"
      [showQuickJumper]="showQuickJumper"
      [total]="total"
      [pageIndex]="pageIndex"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [bordered]="bordered"
      (pageIndexChange)="onPageIndexChange($event)"
      (pageSizeChange)="onPageSizeChange($event)"
      (clickRefresh)="onClickRefresh($event)"
    ></tds-pagination-default>
  `,
                host: {
                    '[class.tds-pagination-simple]': 'simple',
                    '[class.tds-pagination-disabled]': 'disabled',
                    '[class.mini]': `!simple && _size === 'small'`,
                    '[class.tds-pagination-rtl]': `dir === 'rtl'`
                }
            }]
    }], function () { return [{ type: i1.TDSI18nService }, { type: i0.ChangeDetectorRef }, { type: i2.TDSBreakpointService }, { type: i3.TDSConfigService }, { type: i4.Directionality, decorators: [{
                type: Optional
            }] }, { type: i0.ElementRef }]; }, { pageSizeChange: [{
            type: Output
        }], pageIndexChange: [{
            type: Output
        }], showTotal: [{
            type: Input
        }], itemRender: [{
            type: Input
        }], size: [{
            type: Input
        }], pageSizeOptions: [{
            type: Input
        }], showSizeChanger: [{
            type: Input
        }], showQuickJumper: [{
            type: Input
        }], simple: [{
            type: Input
        }], disabled: [{
            type: Input
        }], responsive: [{
            type: Input
        }], hideOnSinglePage: [{
            type: Input
        }], total: [{
            type: Input
        }], pageIndex: [{
            type: Input
        }], pageSize: [{
            type: Input
        }], showRefresh: [{
            type: Input
        }], bordered: [{
            type: Input
        }], clickRefresh: [{
            type: Output
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy90ZHMtdWkvcGFnaW5hdGlvbi9wYWdpbmF0aW9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBSUEsT0FBTyxFQUNMLHVCQUF1QixFQUV2QixTQUFTLEVBRVQsWUFBWSxFQUNaLEtBQUssRUFJTCxRQUFRLEVBQ1IsTUFBTSxFQUdOLGlCQUFpQixFQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsYUFBYSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM5QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUE4QyxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM1RixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsaUJBQWlCLEVBQXdCLE1BQU0sc0JBQXNCLENBQUM7QUFFbEcsT0FBTyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7Ozs7Ozs7Ozs7SUFlNUQsNkJBQThEO0lBQzVELHFIQUEwRTtJQUM1RSwwQkFBZTs7OztJQURBLGVBQThDO0lBQTlDLCtDQUE4Qzs7O0lBRi9ELDZCQUFxQztJQUNuQyx3R0FFZTtJQUNqQiwwQkFBZTs7OztJQUhFLGVBQWM7SUFBZCxvQ0FBYywwQkFBQTs7QUFWbkMsTUFBTSxzQkFBc0IsR0FBaUIsWUFBWSxDQUFDO0FBb0QxRCxNQUFNLE9BQU8sc0JBQXNCO0lBaUZqQyxZQUNVLElBQW9CLEVBQ3BCLEdBQXNCLEVBQ3RCLGlCQUF1QyxFQUNyQyxnQkFBa0MsRUFDeEIsY0FBOEIsRUFDMUMsVUFBc0I7UUFMdEIsU0FBSSxHQUFKLElBQUksQ0FBZ0I7UUFDcEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFzQjtRQUNyQyxxQkFBZ0Is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LEVBQUU7eURBQWU7QUFDZDtJQUFkLFdBQVcsRUFBRTt3REFBZTt1RkEzQjNCLHNCQUFzQjtjQWxEbEMsU0FBUztlQUFDO2dCQUNULFFBQVEsRUFBRSxnQkFBZ0I7Z0JBQzFCLFFBQVEsRUFBRSxlQUFlO2dCQUN6QixtQkFBbUIsRUFBRSxLQUFLO2dCQUMxQixhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtnQkFDckMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07Z0JBQy9DLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBb0NUO2dCQUNELElBQUksRUFBRTtvQkFDSiwrQkFBK0IsRUFBRSxRQUFRO29CQUN6QyxpQ0FBaUMsRUFBRSxVQUFVO29CQUM3QyxjQUFjLEVBQUUsOEJBQThCO29CQUM5Qyw0QkFBNEIsRUFBRSxlQUFlO2lCQUM5QzthQUNGOztzQkF1RkksUUFBUTtpREF6RVEsY0FBYztrQkFBaEMsTUFBTTtZQUNZLGVBQWU7a0JBQWpDLE1BQU07WUFDRSxTQUFTO2tCQUFqQixLQUFLO1lBQ0csVUFBVTtrQkFBbEIsS0FBSztZQUNpQixJQUFJO2tCQUExQixLQUFLO1lBQ2lCLGVBQWU7a0JBQXJDLEtBQUs7WUFDaUMsZUFBZTtrQkFBckQsS0FBSztZQUNpQyxlQUFlO2tCQUFyRCxLQUFLO1lBQ2lDLE1BQU07a0JBQTVDLEtBQUs7WUFDbUIsUUFBUTtrQkFBaEMsS0FBSztZQUNtQixVQUFVO2tCQUFsQyxLQUFLO1lBQ21CLGdCQUFnQjtrQkFBeEMsS0FBSztZQUNrQixLQUFLO2tCQUE1QixLQUFLO1lBQ2tCLFNBQVM7a0JBQWhDLEtBQUs7WUFDa0IsUUFBUTtrQkFBL0IsS0FBSztZQUNHLFdBQVc7a0JBQW5CLEtBQUs7WUFDRyxRQUFRO2tCQUFoQixLQUFLO1lBQ2EsWUFBWTtrQkFBOUIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuaW1wb3J0IHsgRGlyZWN0aW9uLCBEaXJlY3Rpb25hbGl0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9iaWRpJztcclxuaW1wb3J0IHsgQm9vbGVhbklucHV0LCBOdW1iZXJJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XHJcbmltcG9ydCB7XHJcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXHJcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgQ29tcG9uZW50LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIElucHV0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LFxyXG4gIE9wdGlvbmFsLFxyXG4gIE91dHB1dCxcclxuICBTaW1wbGVDaGFuZ2VzLFxyXG4gIFRlbXBsYXRlUmVmLFxyXG4gIFZpZXdFbmNhcHN1bGF0aW9uXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFJlcGxheVN1YmplY3QsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBCdXR0b25TaXplLCBURFNDb25maWdLZXksIFREU0NvbmZpZ1NlcnZpY2UsIFdpdGhDb25maWcgfSBmcm9tIFwidGRzLXVpL2NvcmUvY29uZmlnXCI7XHJcbmltcG9ydCB7IGdyaWRSZXNwb25zaXZlTWFwLCBURFNCcmVha3BvaW50RW51bSwgVERTQnJlYWtwb2ludFNlcnZpY2UgfSBmcm9tICd0ZHMtdWkvY29yZS9zZXJ2aWNlcyc7XHJcbmltcG9ydCB7IFREU0kxOG5TZXJ2aWNlLCBURFNQYWdpbmF0aW9uSTE4bkludGVyZmFjZSB9IGZyb20gJ3Rkcy11aS9pMThuJztcclxuaW1wb3J0IHsgSW5wdXRCb29sZWFuLCBJbnB1dE51bWJlciB9IGZyb20gJ3Rkcy11aS9zaGFyZWQvdXRpbGl0eSc7XHJcblxyXG5cclxuaW1wb3J0IHsgUGFnaW5hdGlvbkl0ZW1SZW5kZXJDb250ZXh0IH0gZnJvbSAnLi9wYWdpbmF0aW9uLnR5cGVzJztcclxuXHJcbmNvbnN0IFREU19DT05GSUdfTU9EVUxFX05BTUU6IFREU0NvbmZpZ0tleSA9ICdwYWdpbmF0aW9uJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAndGRzLXBhZ2luYXRpb24nLFxyXG4gIGV4cG9ydEFzOiAndGRzUGFnaW5hdGlvbicsXHJcbiAgcHJlc2VydmVXaGl0ZXNwYWNlczogZmFsc2UsXHJcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcclxuICB0ZW1wbGF0ZTogYFxyXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInNob3dQYWdpbmF0aW9uXCI+XHJcbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJzaW1wbGU7IGVsc2UgZGVmYXVsdFBhZ2luYXRpb24udGVtcGxhdGVcIj5cclxuICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwic2ltcGxlUGFnaW5hdGlvbi50ZW1wbGF0ZVwiPjwvbmctdGVtcGxhdGU+XHJcbiAgICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgPC9uZy1jb250YWluZXI+XHJcbiAgICA8dGRzLXBhZ2luYXRpb24tc2ltcGxlXHJcbiAgICAgICNzaW1wbGVQYWdpbmF0aW9uXHJcbiAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXHJcbiAgICAgIFtpdGVtUmVuZGVyXT1cIml0ZW1SZW5kZXJcIlxyXG4gICAgICBbbG9jYWxlXT1cImxvY2FsZVwiXHJcbiAgICAgIFtwYWdlU2l6ZV09XCJwYWdlU2l6ZVwiXHJcbiAgICAgIFt0b3RhbF09XCJ0b3RhbFwiXHJcbiAgICAgIFtwYWdlSW5kZXhdPVwicGFnZUluZGV4XCJcclxuICAgICAgW3NpemVdPVwiX3NpemVcIlxyXG4gICAgICAocGFnZUluZGV4Q2hhbmdlKT1cIm9uUGFnZUluZGV4Q2hhbmdlKCRldmVudClcIlxyXG4gICAgPjwvdGRzLXBhZ2luYXRpb24tc2ltcGxlPlxyXG4gICAgPHRkcy1wYWdpbmF0aW9uLWRlZmF1bHRcclxuICAgICAgI2RlZmF1bHRQYWdpbmF0aW9uXHJcbiAgICAgIFtzaXplXT1cIl9zaXplXCJcclxuICAgICAgW2l0ZW1SZW5kZXJdPVwiaXRlbVJlbmRlclwiXHJcbiAgICAgIFtzaG93VG90YWxdPVwic2hvd1RvdGFsXCJcclxuICAgICAgW3Nob3dSZWZyZXNoXT1cInNob3dSZWZyZXNoXCJcclxuICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCJcclxuICAgICAgW2xvY2FsZV09XCJsb2NhbGVcIlxyXG4gICAgICBbc2hvd1NpemVDaGFuZ2VyXT1cInNob3dTaXplQ2hhbmdlclwiXHJcbiAgICAgIFtzaG93UXVpY2tKdW1wZXJdPVwic2hvd1F1aWNrSnVtcGVyXCJcclxuICAgICAgW3RvdGFsXT1cInRvdGFsXCJcclxuICAgICAgW3BhZ2VJbmRleF09XCJwYWdlSW5kZXhcIlxyXG4gICAgICBbcGFnZVNpemVdPVwicGFnZVNpemVcIlxyXG4gICAgICBbcGFnZVNpemVPcHRpb25zXT1cInBhZ2VTaXplT3B0aW9uc1wiXHJcbiAgICAgIFtib3JkZXJlZF09XCJib3JkZXJlZFwiXHJcbiAgICAgIChwYWdlSW5kZXhDaGFuZ2UpPVwib25QYWdlSW5kZXhDaGFuZ2UoJGV2ZW50KVwiXHJcbiAgICAgIChwYWdlU2l6ZUNoYW5nZSk9XCJvblBhZ2VTaXplQ2hhbmdlKCRldmVudClcIlxyXG4gICAgICAoY2xpY2tSZWZyZXNoKT1cIm9uQ2xpY2tSZWZyZXNoKCRldmVudClcIlxyXG4gICAgPjwvdGRzLXBhZ2luYXRpb24tZGVmYXVsdD5cclxuICBgLFxyXG4gIGhvc3Q6IHtcclxuICAgICdbY2xhc3MudGRzLXBhZ2luYXRpb24tc2ltcGxlXSc6ICdzaW1wbGUnLFxyXG4gICAgJ1tjbGFzcy50ZHMtcGFnaW5hdGlvbi1kaXNhYmxlZF0nOiAnZGlzYWJsZWQnLFxyXG4gICAgJ1tjbGFzcy5taW5pXSc6IGAhc2ltcGxlICYmIF9zaXplID09PSAnc21hbGwnYCxcclxuICAgICdbY2xhc3MudGRzLXBhZ2luYXRpb24tcnRsXSc6IGBkaXIgPT09ICdydGwnYFxyXG4gIH1cclxufSlcclxuZXhwb3J0IGNsYXNzIFREU1BhZ2luYXRpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcclxuICByZWFkb25seSBfdGRzTW9kdWxlTmFtZTogVERTQ29uZmlnS2V5ID0gVERTX0NPTkZJR19NT0RVTEVfTkFNRTtcclxuXHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX2Rpc2FibGVkOiBCb29sZWFuSW5wdXQ7XHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX3Nob3dTaXplQ2hhbmdlcjogQm9vbGVhbklucHV0O1xyXG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV9oaWRlT25TaW5nbGVQYWdlOiBCb29sZWFuSW5wdXQ7XHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX3Nob3dRdWlja0p1bXBlcjogQm9vbGVhbklucHV0O1xyXG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV9zaW1wbGU6IEJvb2xlYW5JbnB1dDtcclxuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfcmVzcG9uc2l2ZTogQm9vbGVhbklucHV0O1xyXG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV90b3RhbDogTnVtYmVySW5wdXQ7XHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX3BhZ2VJbmRleDogTnVtYmVySW5wdXQ7XHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX3BhZ2VTaXplOiBOdW1iZXJJbnB1dDtcclxuXHJcbiAgQE91dHB1dCgpIHJlYWRvbmx5IHBhZ2VTaXplQ2hhbmdlOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgcmVhZG9ubHkgcGFnZUluZGV4Q2hhbmdlOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBASW5wdXQoKSBzaG93VG90YWw6IFRlbXBsYXRlUmVmPHsgJGltcGxpY2l0OiBudW1iZXI7IHJhbmdlOiBbbnVtYmVyLCBudW1iZXJdIH0+IHwgbnVsbCA9IG51bGw7XHJcbiAgQElucHV0KCkgaXRlbVJlbmRlcjogVGVtcGxhdGVSZWY8UGFnaW5hdGlvbkl0ZW1SZW5kZXJDb250ZXh0PiB8IG51bGwgPSBudWxsO1xyXG4gIEBJbnB1dCgpIEBXaXRoQ29uZmlnKCkgc2l6ZTogQnV0dG9uU2l6ZSA9ICdzbSc7XHJcbiAgQElucHV0KCkgQFdpdGhDb25maWcoKSBwYWdlU2l6ZU9wdGlvbnM6IG51bWJlcltdID0gWzEwLCAyMCwgMzAsIDQwXTtcclxuICBASW5wdXQoKSBAV2l0aENvbmZpZygpIEBJbnB1dEJvb2xlYW4oKSBzaG93U2l6ZUNoYW5nZXIgPSBmYWxzZTtcclxuICBASW5wdXQoKSBAV2l0aENvbmZpZygpIEBJbnB1dEJvb2xlYW4oKSBzaG93UXVpY2tKdW1wZXIgPSBmYWxzZTtcclxuICBASW5wdXQoKSBAV2l0aENvbmZpZygpIEBJbnB1dEJvb2xlYW4oKSBzaW1wbGUgPSBmYWxzZTtcclxuICBASW5wdXQoKSBASW5wdXRCb29sZWFuKCkgZGlzYWJsZWQgPSBmYWxzZTtcclxuICBASW5wdXQoKSBASW5wdXRCb29sZWFuKCkgcmVzcG9uc2l2ZSA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSBoaWRlT25TaW5nbGVQYWdlID0gZmFsc2U7XHJcbiAgQElucHV0KCkgQElucHV0TnVtYmVyKCkgdG90YWwgPSAwO1xyXG4gIEBJbnB1dCgpIEBJbnB1dE51bWJlcigpIHBhZ2VJbmRleCA9IDE7XHJcbiAgQElucHV0KCkgQElucHV0TnVtYmVyKCkgcGFnZVNpemUgPSAxMDtcclxuICBASW5wdXQoKSBzaG93UmVmcmVzaCA6Ym9vbGVhbiA9ZmFsc2U7XHJcbiAgQElucHV0KCkgYm9yZGVyZWQgOmJvb2xlYW4gPXRydWU7XHJcbiAgQE91dHB1dCgpIHJlYWRvbmx5IGNsaWNrUmVmcmVzaDogRXZlbnRFbWl0dGVyPE1vdXNlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIHNob3dQYWdpbmF0aW9uID0gdHJ1ZTtcclxuICBsb2NhbGUhOiBURFNQYWdpbmF0aW9uSTE4bkludGVyZmFjZTtcclxuICBfc2l6ZTogQnV0dG9uU2l6ZSA9IFwic21cIjtcclxuICBkaXI6IERpcmVjdGlvbiA9ICdsdHInO1xyXG5cclxuICBwcml2YXRlIGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuICBwcml2YXRlIHRvdGFsJCA9IG5ldyBSZXBsYXlTdWJqZWN0PG51bWJlcj4oMSk7XHJcblxyXG4gIHZhbGlkYXRlUGFnZUluZGV4KHZhbHVlOiBudW1iZXIsIGxhc3RJbmRleDogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIGlmICh2YWx1ZSA+IGxhc3RJbmRleCkge1xyXG4gICAgICByZXR1cm4gbGFzdEluZGV4O1xyXG4gICAgfSBlbHNlIGlmICh2YWx1ZSA8IDEpIHtcclxuICAgICAgcmV0dXJuIDE7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvblBhZ2VJbmRleENoYW5nZShpbmRleDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBjb25zdCBsYXN0SW5kZXggPSB0aGlzLmdldExhc3RJbmRleCh0aGlzLnRvdGFsLCB0aGlzLnBhZ2VTaXplKTtcclxuICAgIGNvbnN0IHZhbGlkSW5kZXggPSB0aGlzLnZhbGlkYXRlUGFnZUluZGV4KGluZGV4LCBsYXN0SW5kZXgpO1xyXG4gICAgaWYgKHZhbGlkSW5kZXggIT09IHRoaXMucGFnZUluZGV4ICYmICF0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgIHRoaXMucGFnZUluZGV4ID0gdmFsaWRJbmRleDtcclxuICAgICAgdGhpcy5wYWdlSW5kZXhDaGFuZ2UuZW1pdCh0aGlzLnBhZ2VJbmRleCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvblBhZ2VTaXplQ2hhbmdlKHNpemU6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5wYWdlU2l6ZSA9IHNpemU7XHJcbiAgICB0aGlzLnBhZ2VTaXplQ2hhbmdlLmVtaXQoc2l6ZSk7XHJcbiAgICBjb25zdCBsYXN0SW5kZXggPSB0aGlzLmdldExhc3RJbmRleCh0aGlzLnRvdGFsLCB0aGlzLnBhZ2VTaXplKTtcclxuICAgIGlmICh0aGlzLnBhZ2VJbmRleCA+IGxhc3RJbmRleCkge1xyXG4gICAgICB0aGlzLm9uUGFnZUluZGV4Q2hhbmdlKGxhc3RJbmRleCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvblRvdGFsQ2hhbmdlKHRvdGFsOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGNvbnN0IGxhc3RJbmRleCA9IHRoaXMuZ2V0TGFzdEluZGV4KHRvdGFsLCB0aGlzLnBhZ2VTaXplKTtcclxuICAgIGlmICh0aGlzLnBhZ2VJbmRleCA+IGxhc3RJbmRleCkge1xyXG4gICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHtcclxuICAgICAgICB0aGlzLm9uUGFnZUluZGV4Q2hhbmdlKGxhc3RJbmRleCk7XHJcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0TGFzdEluZGV4KHRvdGFsOiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIE1hdGguY2VpbCh0b3RhbCAvIHBhZ2VTaXplKTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBpMThuOiBURFNJMThuU2VydmljZSxcclxuICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIHByaXZhdGUgYnJlYWtwb2ludFNlcnZpY2U6IFREU0JyZWFrcG9pbnRTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIHRkc0NvbmZpZ1NlcnZpY2U6IFREU0NvbmZpZ1NlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGRpcmVjdGlvbmFsaXR5OiBEaXJlY3Rpb25hbGl0eSxcclxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZlxyXG4gICkge1xyXG4gICAgLy8gVE9ETzogbW92ZSB0byBob3N0IGFmdGVyIFZpZXcgRW5naW5lIGRlcHJlY2F0aW9uXHJcbiAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCd0ZHMtcGFnaW5hdGlvbicpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmkxOG4ubG9jYWxlQ2hhbmdlLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICB0aGlzLmxvY2FsZSA9IHRoaXMuaTE4bi5nZXRMb2NhbGVEYXRhKCdQYWdpbmF0aW9uJyk7XHJcbiAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy50b3RhbCQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSh0b3RhbCA9PiB7XHJcbiAgICAgIHRoaXMub25Ub3RhbENoYW5nZSh0b3RhbCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmJyZWFrcG9pbnRTZXJ2aWNlXHJcbiAgICAgIC5zdWJzY3JpYmUoZ3JpZFJlc3BvbnNpdmVNYXApXHJcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcclxuICAgICAgLnN1YnNjcmliZShicCA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVzcG9uc2l2ZSkge1xyXG4gICAgICAgICAgdGhpcy5fc2l6ZSA9IGJwID09PSBURFNCcmVha3BvaW50RW51bS54cyA/ICdzbScgOiAnbWQnO1xyXG4gICAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICB0aGlzLmRpcmVjdGlvbmFsaXR5LmNoYW5nZT8ucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgoZGlyZWN0aW9uOiBEaXJlY3Rpb24pID0+IHtcclxuICAgICAgdGhpcy5kaXIgPSBkaXJlY3Rpb247XHJcbiAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuZGlyID0gdGhpcy5kaXJlY3Rpb25hbGl0eS52YWx1ZTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XHJcbiAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICBjb25zdCB7IGhpZGVPblNpbmdsZVBhZ2UsIHRvdGFsLCBwYWdlU2l6ZSwgc2l6ZSB9ID0gY2hhbmdlcztcclxuICAgIGlmICh0b3RhbCkge1xyXG4gICAgICB0aGlzLnRvdGFsJC5uZXh0KHRoaXMudG90YWwpO1xyXG4gICAgfVxyXG4gICAgaWYgKGhpZGVPblNpbmdsZVBhZ2UgfHwgdG90YWwgfHwgcGFnZVNpemUpIHtcclxuICAgICAgdGhpcy5zaG93UGFnaW5hdGlvbiA9XHJcbiAgICAgICAgKHRoaXMuaGlkZU9uU2luZ2xlUGFnZSAmJiB0aGlzLnRvdGFsID4gdGhpcy5wYWdlU2l6ZSkgfHwgKHRoaXMudG90YWwgPiAwICYmICF0aGlzLmhpZGVPblNpbmdsZVBhZ2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzaXplKSB7XHJcbiAgICAgIHRoaXMuX3NpemUgPSBzaXplLmN1cnJlbnRWYWx1ZTtcclxuICAgIH1cclxuICB9XHJcbiAgb25DbGlja1JlZnJlc2goZTpNb3VzZUV2ZW50KVxyXG4gIHtcclxuICAgIHRoaXMuY2xpY2tSZWZyZXNoLmVtaXQoZSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==