// randomColor by David Merfield under the CC0 license
// https://github.com/davidmerfield/randomColor/
import { TinyColor } from './tinycolor';
export function random(options = {}) {
    // Check if we need to generate multiple colors
    if (options.count !== undefined &&
        options.count !== null) {
        const totalColors = options.count;
        const colors = [];
        options.count = undefined;
        while (totalColors > colors.length) {
            // Since we're generating multiple colors,
            // incremement the seed. Otherwise we'd just
            // generate the same color each time...
            options.count = null;
            if (options.seed) {
                options.seed += 1;
            }
            colors.push(random(options));
        }
        options.count = totalColors;
        return colors;
    }
    // First we pick a hue (H)
    const h = pickHue(options.hue, options.seed);
    // Then use H to determine saturation (S)
    const s = pickSaturation(h, options);
    // Then use S and H to determine brightness (B).
    const v = pickBrightness(h, s, options);
    const res = { h, s, v };
    if (options.alpha !== undefined) {
        res.a = options.alpha;
    }
    // Then we return the HSB color in the desired format
    return new TinyColor(res);
}
function pickHue(hue, seed) {
    const hueRange = getHueRange(hue);
    let res = randomWithin(hueRange, seed);
    // Instead of storing red as two seperate ranges,
    // we group them, using negative numbers
    if (res < 0) {
        res = 360 + res;
    }
    return res;
}
function pickSaturation(hue, options) {
    if (options.hue === 'monochrome') {
        return 0;
    }
    if (options.luminosity === 'random') {
        return randomWithin([0, 100], options.seed);
    }
    const { saturationRange } = getColorInfo(hue);
    let sMin = saturationRange[0];
    let sMax = saturationRange[1];
    switch (options.luminosity) {
        case 'bright':
            sMin = 55;
            break;
        case 'dark':
            sMin = sMax - 10;
            break;
        case 'light':
            sMax = 55;
            break;
        default:
            break;
    }
    return randomWithin([sMin, sMax], options.seed);
}
function pickBrightness(H, S, options) {
    let bMin = getMinimumBrightness(H, S);
    let bMax = 100;
    switch (options.luminosity) {
        case 'dark':
            bMax = bMin + 20;
            break;
        case 'light':
            bMin = (bMax + bMin) / 2;
            break;
        case 'random':
            bMin = 0;
            bMax = 100;
            break;
        default:
            break;
    }
    return randomWithin([bMin, bMax], options.seed);
}
function getMinimumBrightness(H, S) {
    const { lowerBounds } = getColorInfo(H);
    for (let i = 0; i < lowerBounds.length - 1; i++) {
        const s1 = lowerBounds[i][0];
        const v1 = lowerBounds[i][1];
        const s2 = lowerBounds[i + 1][0];
        const v2 = lowerBounds[i + 1][1];
        if (S >= s1 && S <= s2) {
            const m = (v2 - v1) / (s2 - s1);
            const b = v1 - m * s1;
            return m * S + b;
        }
    }
    return 0;
}
function getHueRange(colorInput) {
    const num = parseInt(colorInput, 10);
    if (!Number.isNaN(num) && num < 360 && num > 0) {
        return [num, num];
    }
    if (typeof colorInput === 'string') {
        const namedColor = bounds.find(n => n.name === colorInput);
        if (namedColor) {
            const color = defineColor(namedColor);
            if (color.hueRange) {
                return color.hueRange;
            }
        }
        const parsed = new TinyColor(colorInput);
        if (parsed.isValid) {
            const hue = parsed.toHsv().h;
            return [hue, hue];
        }
    }
    return [0, 360];
}
function getColorInfo(hue) {
    // Maps red colors to make picking hue easier
    if (hue >= 334 && hue <= 360) {
        hue -= 360;
    }
    for (const bound of bounds) {
        const color = defineColor(bound);
        if (color.hueRange && hue >= color.hueRange[0] && hue <= color.hueRange[1]) {
            return color;
        }
    }
    throw Error('Color not found');
}
function randomWithin(range, seed) {
    if (seed === undefined) {
        return Math.floor(range[0] + Math.random() * (range[1] + 1 - range[0]));
    }
    // Seeded random algorithm from http://indiegamr.com/generate-repeatable-random-numbers-in-js/
    const max = range[1] || 1;
    const min = range[0] || 0;
    seed = (seed * 9301 + 49297) % 233280;
    const rnd = seed / 233280.0;
    return Math.floor(min + rnd * (max - min));
}
function defineColor(bound) {
    const sMin = bound.lowerBounds[0][0];
    const sMax = bound.lowerBounds[bound.lowerBounds.length - 1][0];
    const bMin = bound.lowerBounds[bound.lowerBounds.length - 1][1];
    const bMax = bound.lowerBounds[0][1];
    return {
        name: bound.name,
        hueRange: bound.hueRange,
        lowerBounds: bound.lowerBounds,
        saturationRange: [sMin, sMax],
        brightnessRange: [bMin, bMax],
    };
}
/**
 * @hidden
 */
export const bounds = [
    {
        name: 'monochrome',
        hueRange: null,
        lowerBounds: [
            [0, 0],
            [100, 0],
        ],
    },
    {
        name: 'red',
        hueRange: [-26, 18],
        lowerBounds: [
            [20, 100],
            [30, 92],
            [40, 89],
            [50, 85],
            [60, 78],
            [70, 70],
            [80, 60],
            [90, 55],
            [100, 50],
        ],
    },
    {
        name: 'orange',
        hueRange: [19, 46],
        lowerBounds: [
            [20, 100],
            [30, 93],
            [40, 88],
            [50, 86],
            [60, 85],
            [70, 70],
            [100, 70],
        ],
    },
    {
        name: 'yellow',
        hueRange: [47, 62],
        lowerBounds: [
            [25, 100],
            [40, 94],
            [50, 89],
            [60, 86],
            [70, 84],
            [80, 82],
            [90, 80],
            [100, 75],
        ],
    },
    {
        name: 'green',
        hueRange: [63, 178],
        lowerBounds: [
            [30, 100],
            [40, 90],
            [50, 85],
            [60, 81],
            [70, 74],
            [80, 64],
            [90, 50],
            [100, 40],
        ],
    },
    {
        name: 'blue',
        hueRange: [179, 257],
        lowerBounds: [
            [20, 100],
            [30, 86],
            [40, 80],
            [50, 74],
            [60, 60],
            [70, 52],
            [80, 44],
            [90, 39],
            [100, 35],
        ],
    },
    {
        name: 'purple',
        hueRange: [258, 282],
        lowerBounds: [
            [20, 100],
            [30, 87],
            [40, 79],
            [50, 70],
            [60, 65],
            [70, 59],
            [80, 52],
            [90, 45],
            [100, 42],
        ],
    },
    {
        name: 'pink',
        hueRange: [283, 334],
        lowerBounds: [
            [20, 100],
            [30, 90],
            [40, 86],
            [60, 84],
            [80, 80],
            [90, 75],
            [100, 73],
        ],
    },
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvdGRzLXVpL3Rpbnljb2xvci9yYW5kb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBQ3RELGdEQUFnRDtBQUNoRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBMEJ4QyxNQUFNLFVBQVUsTUFBTSxDQUFDLFVBQThDLEVBQUU7SUFDckUsK0NBQStDO0lBQy9DLElBQ0csT0FBOEIsQ0FBQyxLQUFLLEtBQUssU0FBUztRQUNsRCxPQUE4QixDQUFDLEtBQUssS0FBSyxJQUFJLEVBQzlDO1FBQ0EsTUFBTSxXQUFXLEdBQVksT0FBOEIsQ0FBQyxLQUFNLENBQUM7UUFDbkUsTUFBTSxNQUFNLEdBQWdCLEVBQUUsQ0FBQztRQUU5QixPQUE4QixDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7UUFFbEQsT0FBTyxXQUFXLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRTtZQUNsQywwQ0FBMEM7WUFDMUMsNENBQTRDO1lBQzVDLHVDQUF1QztZQUN0QyxPQUE4QixDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDN0MsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFO2dCQUNoQixPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQzthQUNuQjtZQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQXdCLENBQUMsQ0FBQyxDQUFDO1NBQy9DO1FBRUEsT0FBOEIsQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDO1FBQ3BELE9BQU8sTUFBTSxDQUFDO0tBQ2Y7SUFFRCwwQkFBMEI7SUFDMUIsTUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTdDLHlDQUF5QztJQUN6QyxNQUFNLENBQUMsR0FBRyxjQUFjLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FB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QUFDLEVBQUUsRUFBRSxHQUFHLENBQUM7WUFDVCxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDUixDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDUixDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDUixDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDUixDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDUixDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDUixDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDUixDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUM7U0FDVjtLQUNGO0lBQ0Q7UUFDRSxJQUFJLEVBQUUsUUFBUTtRQUNkLFFBQVEsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7UUFDcEIsV0FBVyxFQUFFO1lBQ1gsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDO1lBQ1QsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO1NBQ1Y7S0FDRjtJQUNEO1FBQ0UsSUFBSSxFQUFFLE1BQU07UUFDWixRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1FBQ3BCLFdBQVcsRUFBRTtZQUNYLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQztZQUNULENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztZQUNSLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztZQUNSLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztZQUNSLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztZQUNSLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztZQUNSLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQztTQUNWO0tBQ0Y7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gcmFuZG9tQ29sb3IgYnkgRGF2aWQgTWVyZmllbGQgdW5kZXIgdGhlIENDMCBsaWNlbnNlXHJcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9kYXZpZG1lcmZpZWxkL3JhbmRvbUNvbG9yL1xyXG5pbXBvcnQgeyBUaW55Q29sb3IgfSBmcm9tICcuL3Rpbnljb2xvcic7XHJcbmltcG9ydCB7IEhTVkEgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBSYW5kb21PcHRpb25zIHtcclxuICBzZWVkPzogbnVtYmVyO1xyXG4gIGh1ZT86XHJcbiAgICB8IG51bWJlclxyXG4gICAgfCBzdHJpbmdcclxuICAgIHwgJ3JlZCdcclxuICAgIHwgJ29yYW5nZSdcclxuICAgIHwgJ3llbGxvdydcclxuICAgIHwgJ2dyZWVuJ1xyXG4gICAgfCAnYmx1ZSdcclxuICAgIHwgJ3B1cnBsZSdcclxuICAgIHwgJ3BpbmsnXHJcbiAgICB8ICdtb25vY2hyb21lJztcclxuICBsdW1pbm9zaXR5PzogJ3JhbmRvbScgfCAnYnJpZ2h0JyB8ICdkYXJrJyB8ICdsaWdodCc7XHJcbiAgYWxwaGE/OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmFuZG9tQ291bnRPcHRpb25zIGV4dGVuZHMgUmFuZG9tT3B0aW9ucyB7XHJcbiAgY291bnQ/OiBudW1iZXIgfCBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tKG9wdGlvbnM/OiBSYW5kb21PcHRpb25zKTogVGlueUNvbG9yO1xyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tKG9wdGlvbnM/OiBSYW5kb21Db3VudE9wdGlvbnMpOiBUaW55Q29sb3JbXTtcclxuZXhwb3J0IGZ1bmN0aW9uIHJhbmRvbShvcHRpb25zOiBSYW5kb21PcHRpb25zIHwgUmFuZG9tQ291bnRPcHRpb25zID0ge30pOiBUaW55Q29sb3IgfCBUaW55Q29sb3JbXSB7XHJcbiAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byBnZW5lcmF0ZSBtdWx0aXBsZSBjb2xvcnNcclxuICBpZiAoXHJcbiAgICAob3B0aW9ucyBhcyBSYW5kb21Db3VudE9wdGlvbnMpLmNvdW50ICE9PSB1bmRlZmluZWQgJiZcclxuICAgIChvcHRpb25zIGFzIFJhbmRvbUNvdW50T3B0aW9ucykuY291bnQgIT09IG51bGxcclxuICApIHtcclxuICAgIGNvbnN0IHRvdGFsQ29sb3JzOiBudW1iZXIgPSAob3B0aW9ucyBhcyBSYW5kb21Db3VudE9wdGlvbnMpLmNvdW50ITtcclxuICAgIGNvbnN0IGNvbG9yczogVGlueUNvbG9yW10gPSBbXTtcclxuXHJcbiAgICAob3B0aW9ucyBhcyBSYW5kb21Db3VudE9wdGlvbnMpLmNvdW50ID0gdW5kZWZpbmVkO1xyXG5cclxuICAgIHdoaWxlICh0b3RhbENvbG9ycyA+IGNvbG9ycy5sZW5ndGgpIHtcclxuICAgICAgLy8gU2luY2Ugd2UncmUgZ2VuZXJhdGluZyBtdWx0aXBsZSBjb2xvcnMsXHJcbiAgICAgIC8vIGluY3JlbWVtZW50IHRoZSBzZWVkLiBPdGhlcndpc2Ugd2UnZCBqdXN0XHJcbiAgICAgIC8vIGdlbmVyYXRlIHRoZSBzYW1lIGNvbG9yIGVhY2ggdGltZS4uLlxyXG4gICAgICAob3B0aW9ucyBhcyBSYW5kb21Db3VudE9wdGlvbnMpLmNvdW50ID0gbnVsbDtcclxuICAgICAgaWYgKG9wdGlvbnMuc2VlZCkge1xyXG4gICAgICAgIG9wdGlvbnMuc2VlZCArPSAxO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb2xvcnMucHVzaChyYW5kb20ob3B0aW9ucyBhcyBSYW5kb21PcHRpb25zKSk7XHJcbiAgICB9XHJcblxyXG4gICAgKG9wdGlvbnMgYXMgUmFuZG9tQ291bnRPcHRpb25zKS5jb3VudCA9IHRvdGFsQ29sb3JzO1xyXG4gICAgcmV0dXJuIGNvbG9ycztcclxuICB9XHJcblxyXG4gIC8vIEZpcnN0IHdlIHBpY2sgYSBodWUgKEgpXHJcbiAgY29uc3QgaCA9IHBpY2tIdWUob3B0aW9ucy5odWUsIG9wdGlvbnMuc2VlZCk7XHJcblxyXG4gIC8vIFRoZW4gdXNlIEggdG8gZGV0ZXJtaW5lIHNhdHVyYXRpb24gKFMpXHJcbiAgY29uc3QgcyA9IHBpY2tTYXR1cmF0aW9uKGgsIG9wdGlvbnMpO1xyXG5cclxuICAvLyBUaGVuIHVzZSBTIGFuZCBIIHRvIGRldGVybWluZSBicmlnaHRuZXNzIChCKS5cclxuICBjb25zdCB2ID0gcGlja0JyaWdodG5lc3MoaCwgcywgb3B0aW9ucyk7XHJcbiAgY29uc3QgcmVzOiBQYXJ0aWFsPEhTVkE+ID0geyBoLCBzLCB2IH07XHJcbiAgaWYgKG9wdGlvbnMuYWxwaGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgcmVzLmEgPSBvcHRpb25zLmFscGhhO1xyXG4gIH1cclxuXHJcbiAgLy8gVGhlbiB3ZSByZXR1cm4gdGhlIEhTQiBjb2xvciBpbiB0aGUgZGVzaXJlZCBmb3JtYXRcclxuICByZXR1cm4gbmV3IFRpbnlDb2xvcihyZXMgYXMgSFNWQSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBpY2tIdWUoaHVlOiBudW1iZXIgfCBzdHJpbmcgfCB1bmRlZmluZWQsIHNlZWQ/OiBudW1iZXIpOiBudW1iZXIge1xyXG4gIGNvbnN0IGh1ZVJhbmdlID0gZ2V0SHVlUmFuZ2UoaHVlKTtcclxuICBsZXQgcmVzID0gcmFuZG9tV2l0aGluKGh1ZVJhbmdlLCBzZWVkKTtcclxuXHJcbiAgLy8gSW5zdGVhZCBvZiBzdG9yaW5nIHJlZCBhcyB0d28gc2VwZXJhdGUgcmFuZ2VzLFxyXG4gIC8vIHdlIGdyb3VwIHRoZW0sIHVzaW5nIG5lZ2F0aXZlIG51bWJlcnNcclxuICBpZiAocmVzIDwgMCkge1xyXG4gICAgcmVzID0gMzYwICsgcmVzO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuZnVuY3Rpb24gcGlja1NhdHVyYXRpb24oaHVlOiBudW1iZXIsIG9wdGlvbnM6IFJhbmRvbU9wdGlvbnMpOiBudW1iZXIge1xyXG4gIGlmIChvcHRpb25zLmh1ZSA9PT0gJ21vbm9jaHJvbWUnKSB7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcblxyXG4gIGlmIChvcHRpb25zLmx1bWlub3NpdHkgPT09ICdyYW5kb20nKSB7XHJcbiAgICByZXR1cm4gcmFuZG9tV2l0aGluKFswLCAxMDBdLCBvcHRpb25zLnNlZWQpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgeyBzYXR1cmF0aW9uUmFuZ2UgfSA9IGdldENvbG9ySW5mbyhodWUpO1xyXG5cclxuICBsZXQgc01pbiA9IHNhdHVyYXRpb25SYW5nZVswXTtcclxuICBsZXQgc01heCA9IHNhdHVyYXRpb25SYW5nZVsxXTtcclxuXHJcbiAgc3dpdGNoIChvcHRpb25zLmx1bWlub3NpdHkpIHtcclxuICAgIGNhc2UgJ2JyaWdodCc6XHJcbiAgICAgIHNNaW4gPSA1NTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdkYXJrJzpcclxuICAgICAgc01pbiA9IHNNYXggLSAxMDtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdsaWdodCc6XHJcbiAgICAgIHNNYXggPSA1NTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICBicmVhaztcclxuICB9XHJcblxyXG4gIHJldHVybiByYW5kb21XaXRoaW4oW3NNaW4sIHNNYXhdLCBvcHRpb25zLnNlZWQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwaWNrQnJpZ2h0bmVzcyhIOiBudW1iZXIsIFM6IG51bWJlciwgb3B0aW9uczogUmFuZG9tT3B0aW9ucyk6IG51bWJlciB7XHJcbiAgbGV0IGJNaW4gPSBnZXRNaW5pbXVtQnJpZ2h0bmVzcyhILCBTKTtcclxuICBsZXQgYk1heCA9IDEwMDtcclxuXHJcbiAgc3dpdGNoIChvcHRpb25zLmx1bWlub3NpdHkpIHtcclxuICAgIGNhc2UgJ2RhcmsnOlxyXG4gICAgICBiTWF4ID0gYk1pbiArIDIwO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ2xpZ2h0JzpcclxuICAgICAgYk1pbiA9IChiTWF4ICsgYk1pbikgLyAyO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3JhbmRvbSc6XHJcbiAgICAgIGJNaW4gPSAwO1xyXG4gICAgICBiTWF4ID0gMTAwO1xyXG4gICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIGJyZWFrO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJhbmRvbVdpdGhpbihbYk1pbiwgYk1heF0sIG9wdGlvbnMuc2VlZCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldE1pbmltdW1CcmlnaHRuZXNzKEg6IG51bWJlciwgUzogbnVtYmVyKTogbnVtYmVyIHtcclxuICBjb25zdCB7IGxvd2VyQm91bmRzIH0gPSBnZXRDb2xvckluZm8oSCk7XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbG93ZXJCb3VuZHMubGVuZ3RoIC0gMTsgaSsrKSB7XHJcbiAgICBjb25zdCBzMSA9IGxvd2VyQm91bmRzW2ldWzBdO1xyXG4gICAgY29uc3QgdjEgPSBsb3dlckJvdW5kc1tpXVsxXTtcclxuXHJcbiAgICBjb25zdCBzMiA9IGxvd2VyQm91bmRzW2kgKyAxXVswXTtcclxuICAgIGNvbnN0IHYyID0gbG93ZXJCb3VuZHNbaSArIDFdWzFdO1xyXG5cclxuICAgIGlmIChTID49IHMxICYmIFMgPD0gczIpIHtcclxuICAgICAgY29uc3QgbSA9ICh2MiAtIHYxKSAvIChzMiAtIHMxKTtcclxuICAgICAgY29uc3QgYiA9IHYxIC0gbSAqIHMxO1xyXG5cclxuICAgICAgcmV0dXJuIG0gKiBTICsgYjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiAwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRIdWVSYW5nZShjb2xvcklucHV0PzogbnVtYmVyIHwgc3RyaW5nKTogW251bWJlciwgbnVtYmVyXSB7XHJcbiAgY29uc3QgbnVtID0gcGFyc2VJbnQoY29sb3JJbnB1dCBhcyBzdHJpbmcsIDEwKTtcclxuICBpZiAoIU51bWJlci5pc05hTihudW0pICYmIG51bSA8IDM2MCAmJiBudW0gPiAwKSB7XHJcbiAgICByZXR1cm4gW251bSwgbnVtXTtcclxuICB9XHJcblxyXG4gIGlmICh0eXBlb2YgY29sb3JJbnB1dCA9PT0gJ3N0cmluZycpIHtcclxuICAgIGNvbnN0IG5hbWVkQ29sb3IgPSBib3VuZHMuZmluZChuID0+IG4ubmFtZSA9PT0gY29sb3JJbnB1dCk7XHJcbiAgICBpZiAobmFtZWRDb2xvcikge1xyXG4gICAgICBjb25zdCBjb2xvciA9IGRlZmluZUNvbG9yKG5hbWVkQ29sb3IpO1xyXG4gICAgICBpZiAoY29sb3IuaHVlUmFuZ2UpIHtcclxuICAgICAgICByZXR1cm4gY29sb3IuaHVlUmFuZ2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXJzZWQgPSBuZXcgVGlueUNvbG9yKGNvbG9ySW5wdXQpO1xyXG4gICAgaWYgKHBhcnNlZC5pc1ZhbGlkKSB7XHJcbiAgICAgIGNvbnN0IGh1ZSA9IHBhcnNlZC50b0hzdigpLmg7XHJcbiAgICAgIHJldHVybiBbaHVlLCBodWVdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIFswLCAzNjBdO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRDb2xvckluZm8oaHVlOiBudW1iZXIpOiB7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGh1ZVJhbmdlOiBbbnVtYmVyLCBudW1iZXJdIHwgbnVsbDtcclxuICBsb3dlckJvdW5kczogQXJyYXk8W251bWJlciwgbnVtYmVyXT47XHJcbiAgc2F0dXJhdGlvblJhbmdlOiBudW1iZXJbXTtcclxuICBicmlnaHRuZXNzUmFuZ2U6IG51bWJlcltdO1xyXG59IHtcclxuICAvLyBNYXBzIHJlZCBjb2xvcnMgdG8gbWFrZSBwaWNraW5nIGh1ZSBlYXNpZXJcclxuICBpZiAoaHVlID49IDMzNCAmJiBodWUgPD0gMzYwKSB7XHJcbiAgICBodWUgLT0gMzYwO1xyXG4gIH1cclxuXHJcbiAgZm9yIChjb25zdCBib3VuZCBvZiBib3VuZHMpIHtcclxuICAgIGNvbnN0IGNvbG9yID0gZGVmaW5lQ29sb3IoYm91bmQpO1xyXG4gICAgaWYgKGNvbG9yLmh1ZVJhbmdlICYmIGh1ZSA+PSBjb2xvci5odWVSYW5nZVswXSAmJiBodWUgPD0gY29sb3IuaHVlUmFuZ2VbMV0pIHtcclxuICAgICAgcmV0dXJuIGNvbG9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdGhyb3cgRXJyb3IoJ0NvbG9yIG5vdCBmb3VuZCcpO1xyXG59XHJcblxyXG5mdW5jdGlvbiByYW5kb21XaXRoaW4ocmFuZ2U6IFtudW1iZXIsIG51bWJlcl0sIHNlZWQ/OiBudW1iZXIpOiBudW1iZXIge1xyXG4gIGlmIChzZWVkID09PSB1bmRlZmluZWQpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKHJhbmdlWzBdICsgTWF0aC5yYW5kb20oKSAqIChyYW5nZVsxXSArIDEgLSByYW5nZVswXSkpO1xyXG4gIH1cclxuXHJcbiAgLy8gU2VlZGVkIHJhbmRvbSBhbGdvcml0aG0gZnJvbSBodHRwOi8vaW5kaWVnYW1yLmNvbS9nZW5lcmF0ZS1yZXBlYXRhYmxlLXJhbmRvbS1udW1iZXJzLWluLWpzL1xyXG4gIGNvbnN0IG1heCA9IHJhbmdlWzFdIHx8IDE7XHJcbiAgY29uc3QgbWluID0gcmFuZ2VbMF0gfHwgMDtcclxuICBzZWVkID0gKHNlZWQgKiA5MzAxICsgNDkyOTcpICUgMjMzMjgwO1xyXG4gIGNvbnN0IHJuZCA9IHNlZWQgLyAyMzMyODAuMDtcclxuICByZXR1cm4gTWF0aC5mbG9vcihtaW4gKyBybmQgKiAobWF4IC0gbWluKSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlZmluZUNvbG9yKGJvdW5kOiBDb2xvckJvdW5kKToge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBodWVSYW5nZTogW251bWJlciwgbnVtYmVyXSB8IG51bGw7XHJcbiAgbG93ZXJCb3VuZHM6IEFycmF5PFtudW1iZXIsIG51bWJlcl0+O1xyXG4gIHNhdHVyYXRpb25SYW5nZTogbnVtYmVyW107XHJcbiAgYnJpZ2h0bmVzc1JhbmdlOiBudW1iZXJbXTtcclxufSB7XHJcbiAgY29uc3Qgc01pbiA9IGJvdW5kLmxvd2VyQm91bmRzWzBdWzBdO1xyXG4gIGNvbnN0IHNNYXggPSBib3VuZC5sb3dlckJvdW5kc1tib3VuZC5sb3dlckJvdW5kcy5sZW5ndGggLSAxXVswXTtcclxuICBjb25zdCBiTWluID0gYm91bmQubG93ZXJCb3VuZHNbYm91bmQubG93ZXJCb3VuZHMubGVuZ3RoIC0gMV1bMV07XHJcbiAgY29uc3QgYk1heCA9IGJvdW5kLmxvd2VyQm91bmRzWzBdWzFdO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgbmFtZTogYm91bmQubmFtZSxcclxuICAgIGh1ZVJhbmdlOiBib3VuZC5odWVSYW5nZSxcclxuICAgIGxvd2VyQm91bmRzOiBib3VuZC5sb3dlckJvdW5kcyxcclxuICAgIHNhdHVyYXRpb25SYW5nZTogW3NNaW4sIHNNYXhdLFxyXG4gICAgYnJpZ2h0bmVzc1JhbmdlOiBbYk1pbiwgYk1heF0sXHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ29sb3JCb3VuZCB7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGh1ZVJhbmdlOiBbbnVtYmVyLCBudW1iZXJdIHwgbnVsbDtcclxuICBsb3dlckJvdW5kczogQXJyYXk8W251bWJlciwgbnVtYmVyXT47XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgYm91bmRzOiBDb2xvckJvdW5kW10gPSBbXHJcbiAge1xyXG4gICAgbmFtZTogJ21vbm9jaHJvbWUnLFxyXG4gICAgaHVlUmFuZ2U6IG51bGwsXHJcbiAgICBsb3dlckJvdW5kczogW1xyXG4gICAgICBbMCwgMF0sXHJcbiAgICAgIFsxMDAsIDBdLFxyXG4gICAgXSxcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6ICdyZWQnLFxyXG4gICAgaHVlUmFuZ2U6IFstMjYsIDE4XSxcclxuICAgIGxvd2VyQm91bmRzOiBbXHJcbiAgICAgIFsyMCwgMTAwXSxcclxuICAgICAgWzMwLCA5Ml0sXHJcbiAgICAgIFs0MCwgODldLFxyXG4gICAgICBbNTAsIDg1XSxcclxuICAgICAgWzYwLCA3OF0sXHJcbiAgICAgIFs3MCwgNzBdLFxyXG4gICAgICBbODAsIDYwXSxcclxuICAgICAgWzkwLCA1NV0sXHJcbiAgICAgIFsxMDAsIDUwXSxcclxuICAgIF0sXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiAnb3JhbmdlJyxcclxuICAgIGh1ZVJhbmdlOiBbMTksIDQ2XSxcclxuICAgIGxvd2VyQm91bmRzOiBbXHJcbiAgICAgIFsyMCwgMTAwXSxcclxuICAgICAgWzMwLCA5M10sXHJcbiAgICAgIFs0MCwgODhdLFxyXG4gICAgICBbNTAsIDg2XSxcclxuICAgICAgWzYwLCA4NV0sXHJcbiAgICAgIFs3MCwgNzBdLFxyXG4gICAgICBbMTAwLCA3MF0sXHJcbiAgICBdLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogJ3llbGxvdycsXHJcbiAgICBodWVSYW5nZTogWzQ3LCA2Ml0sXHJcbiAgICBsb3dlckJvdW5kczogW1xyXG4gICAgICBbMjUsIDEwMF0sXHJcbiAgICAgIFs0MCwgOTRdLFxyXG4gICAgICBbNTAsIDg5XSxcclxuICAgICAgWzYwLCA4Nl0sXHJcbiAgICAgIFs3MCwgODRdLFxyXG4gICAgICBbODAsIDgyXSxcclxuICAgICAgWzkwLCA4MF0sXHJcbiAgICAgIFsxMDAsIDc1XSxcclxuICAgIF0sXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiAnZ3JlZW4nLFxyXG4gICAgaHVlUmFuZ2U6IFs2MywgMTc4XSxcclxuICAgIGxvd2VyQm91bmRzOiBbXHJcbiAgICAgIFszMCwgMTAwXSxcclxuICAgICAgWzQwLCA5MF0sXHJcbiAgICAgIFs1MCwgODVdLFxyXG4gICAgICBbNjAsIDgxXSxcclxuICAgICAgWzcwLCA3NF0sXHJcbiAgICAgIFs4MCwgNjRdLFxyXG4gICAgICBbOTAsIDUwXSxcclxuICAgICAgWzEwMCwgNDBdLFxyXG4gICAgXSxcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6ICdibHVlJyxcclxuICAgIGh1ZVJhbmdlOiBbMTc5LCAyNTddLFxyXG4gICAgbG93ZXJCb3VuZHM6IFtcclxuICAgICAgWzIwLCAxMDBdLFxyXG4gICAgICBbMzAsIDg2XSxcclxuICAgICAgWzQwLCA4MF0sXHJcbiAgICAgIFs1MCwgNzRdLFxyXG4gICAgICBbNjAsIDYwXSxcclxuICAgICAgWzcwLCA1Ml0sXHJcbiAgICAgIFs4MCwgNDRdLFxyXG4gICAgICBbOTAsIDM5XSxcclxuICAgICAgWzEwMCwgMzVdLFxyXG4gICAgXSxcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6ICdwdXJwbGUnLFxyXG4gICAgaHVlUmFuZ2U6IFsyNTgsIDI4Ml0sXHJcbiAgICBsb3dlckJvdW5kczogW1xyXG4gICAgICBbMjAsIDEwMF0sXHJcbiAgICAgIFszMCwgODddLFxyXG4gICAgICBbNDAsIDc5XSxcclxuICAgICAgWzUwLCA3MF0sXHJcbiAgICAgIFs2MCwgNjVdLFxyXG4gICAgICBbNzAsIDU5XSxcclxuICAgICAgWzgwLCA1Ml0sXHJcbiAgICAgIFs5MCwgNDVdLFxyXG4gICAgICBbMTAwLCA0Ml0sXHJcbiAgICBdLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogJ3BpbmsnLFxyXG4gICAgaHVlUmFuZ2U6IFsyODMsIDMzNF0sXHJcbiAgICBsb3dlckJvdW5kczogW1xyXG4gICAgICBbMjAsIDEwMF0sXHJcbiAgICAgIFszMCwgOTBdLFxyXG4gICAgICBbNDAsIDg2XSxcclxuICAgICAgWzYwLCA4NF0sXHJcbiAgICAgIFs4MCwgODBdLFxyXG4gICAgICBbOTAsIDc1XSxcclxuICAgICAgWzEwMCwgNzNdLFxyXG4gICAgXSxcclxuICB9LFxyXG5dO1xyXG4iXX0=