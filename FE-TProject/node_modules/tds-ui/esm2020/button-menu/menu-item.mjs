import { ChangeDetectionStrategy, Component, ViewEncapsulation, Inject, Optional, Input, HostListener, } from '@angular/core';
import { Subject } from 'rxjs';
import { DOCUMENT } from '@angular/common';
import { TDSBUTTON_MENU_PANEL } from './menu-panel';
import { mixinDisabled } from 'tds-ui/shared/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/a11y";
const _c0 = ["tds-button-menu-item", ""];
const _c1 = ["*"];
// Boilerplate for applying mixins to TDSButtonMenuItem.
/** @docs-private */
class TDSButtonMenuItemBase {
}
const _TDSButtonMenuItemMixinBase = mixinDisabled(TDSButtonMenuItemBase);
/**
 * Single item inside of a `tbutton-menu`. Provides the menu item styling and accessibility treatment.
 */
export class TDSButtonMenuItem extends _TDSButtonMenuItemMixinBase {
    constructor(_cdr, _elementRef, _document, _focusMonitor, _parentMenu) {
        // @breaking-change 8.0.0 make `_focusMonitor` and `document` required params.
        super();
        this._cdr = _cdr;
        this._elementRef = _elementRef;
        this._focusMonitor = _focusMonitor;
        this._parentMenu = _parentMenu;
        this.size = 'md';
        /** ARIA role for the menu item. */
        this.role = 'menuitem';
        /** Stream that emits when the menu item is hovered. */
        this._hovered = new Subject();
        /** Stream that emits when the menu item is focused. */
        this._focused = new Subject();
        /** Whether the menu item is highlighted. */
        this._highlighted = false;
        /** Whether the menu item acts as a trigger for a sub-menu. */
        this._triggersSubmenu = false;
        if (_parentMenu && _parentMenu.addItem) {
            _parentMenu.addItem(this);
        }
    }
    ngOnChanges(changes) {
        const { size } = changes;
        if (size) {
            this._cdr.markForCheck();
        }
    }
    /** Focuses the menu item. */
    focus(origin, options) {
        if (this._focusMonitor && origin) {
            this._focusMonitor.focusVia(this._getHostElement(), origin, options);
        }
        else {
            this._getHostElement().focus(options);
        }
        this._focused.next(this);
    }
    ngAfterViewInit() {
        if (this._focusMonitor) {
            // Start monitoring the element so it gets the appropriate focused classes. We want
            // to show the focus style for menu items only when the focus was not caused by a
            // mouse or touch interaction.
            this._focusMonitor.monitor(this._elementRef, false);
        }
    }
    ngOnDestroy() {
        if (this._focusMonitor) {
            this._focusMonitor.stopMonitoring(this._elementRef);
        }
        if (this._parentMenu && this._parentMenu.removeItem) {
            this._parentMenu.removeItem(this);
        }
        this._hovered.complete();
        this._focused.complete();
    }
    /** Used to set the `tabindex`. */
    _getTabIndex() {
        return this.disabled ? '-1' : '0';
    }
    /** Returns the host DOM element. */
    _getHostElement() {
        return this._elementRef.nativeElement;
    }
    /** Prevents the default element actions if it is disabled. */
    // We have to use a `HostListener` here in order to support both Ivy and ViewEngine.
    // In Ivy the `host` bindings will be merged when this class is extended, whereas in
    // ViewEngine they're overwritten.
    // TODO(crisbeto): we move this back into `host` once Ivy is turned on by default.
    // tslint:disable-next-line:no-host-decorator-in-concrete
    _checkDisabled(event) {
        if (this.disabled) {
            event.preventDefault();
            event.stopPropagation();
        }
    }
    /** Emits to the hover stream. */
    // We have to use a `HostListener` here in order to support both Ivy and ViewEngine.
    // In Ivy the `host` bindings will be merged when this class is extended, whereas in
    // ViewEngine they're overwritten.
    // TODO(crisbeto): we move this back into `host` once Ivy is turned on by default.
    // tslint:disable-next-line:no-host-decorator-in-concrete
    _handleMouseEnter() {
        this._hovered.next(this);
    }
    /** Gets the label to be used when determining whether the option should be focused. */
    getLabel() {
        const clone = this._elementRef.nativeElement.cloneNode(true);
        const icons = clone.querySelectorAll('tds-icon, .tds-icons');
        // Strip away icons so they don't show up in the text.
        for (let i = 0; i < icons.length; i++) {
            const icon = icons[i];
            icon.parentNode?.removeChild(icon);
        }
        return clone.textContent?.trim() || '';
    }
    p_updateClsSize() {
        this.ngcls = {};
    }
}
TDSButtonMenuItem.ɵfac = function TDSButtonMenuItem_Factory(t) { return new (t || TDSButtonMenuItem)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(DOCUMENT), i0.ɵɵdirectiveInject(i1.FocusMonitor), i0.ɵɵdirectiveInject(TDSBUTTON_MENU_PANEL, 8)); };
TDSButtonMenuItem.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSButtonMenuItem, selectors: [["", "tds-button-menu-item", ""]], hostAttrs: [1, "flex", "flex-col", "justify-center", "w-full", "text-body-2", "font-regular", "hover:bg-neutral-3-50", "focus:outline-none", "px-3", "dark:hover:bg-d-neutral-3-300"], hostVars: 18, hostBindings: function TDSButtonMenuItem_HostBindings(rf, ctx) { if (rf & 1) {
        i0.ɵɵlistener("click", function TDSButtonMenuItem_click_HostBindingHandler($event) { return ctx._checkDisabled($event); })("mouseenter", function TDSButtonMenuItem_mouseenter_HostBindingHandler() { return ctx._handleMouseEnter(); });
    } if (rf & 2) {
        i0.ɵɵattribute("role", ctx.role)("tabindex", ctx._getTabIndex())("aria-disabled", ctx.disabled.toString())("disabled", ctx.disabled || null);
        i0.ɵɵclassProp("tds-button-menu-item", true)("tds-button-menu-item-highlighted", ctx._highlighted)("tds-button-menu-item-submenu-trigger", ctx._triggersSubmenu)("px-3", true)("py-2", ctx.size == "md")("py-1", ctx.size == "sm")("py-3", ctx.size == "lg");
    } }, inputs: { disabled: "disabled", disableRipple: "disableRipple", size: "size", role: "role" }, exportAs: ["TDSButtonMenuItem"], features: [i0.ɵɵInheritDefinitionFeature, i0.ɵɵNgOnChangesFeature], attrs: _c0, ngContentSelectors: _c1, decls: 1, vars: 0, template: function TDSButtonMenuItem_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵprojectionDef();
        i0.ɵɵprojection(0);
    } }, encapsulation: 2, changeDetection: 0 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSButtonMenuItem, [{
        type: Component,
        args: [{ selector: '[tds-button-menu-item]', exportAs: 'TDSButtonMenuItem', inputs: ['disabled', 'disableRipple'], host: {
                    '[attr.role]': 'role',
                    '[class.tds-button-menu-item]': 'true',
                    '[class.tds-button-menu-item-highlighted]': '_highlighted',
                    '[class.tds-button-menu-item-submenu-trigger]': '_triggersSubmenu',
                    '[attr.tabindex]': '_getTabIndex()',
                    '[attr.aria-disabled]': 'disabled.toString()',
                    '[attr.disabled]': 'disabled || null',
                    'class': 'flex  flex-col justify-center w-full text-body-2 font-regular  hover:bg-neutral-3-50 focus:outline-none px-3 dark:hover:bg-d-neutral-3-300',
                    '[class.px-3]': "true",
                    "[class.py-2]": "size == 'md'",
                    "[class.py-1.5]": "size == 'sm'",
                    '[class.py-3]': "size == 'lg'",
                }, changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, template: "<ng-content></ng-content>\r\n\r\n" }]
    }], function () { return [{ type: i0.ChangeDetectorRef }, { type: i0.ElementRef }, { type: undefined, decorators: [{
                type: Inject,
                args: [DOCUMENT]
            }] }, { type: i1.FocusMonitor }, { type: undefined, decorators: [{
                type: Inject,
                args: [TDSBUTTON_MENU_PANEL]
            }, {
                type: Optional
            }] }]; }, { size: [{
            type: Input
        }], role: [{
            type: Input
        }], _checkDisabled: [{
            type: HostListener,
            args: ['click', ['$event']]
        }], _handleMouseEnter: [{
            type: HostListener,
            args: ['mouseenter']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS1pdGVtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvdGRzLXVpL2J1dHRvbi1tZW51L21lbnUtaXRlbS50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL3Rkcy11aS9idXR0b24tbWVudS9tZW51LWl0ZW0uaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFVQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFHVCxpQkFBaUIsRUFDakIsTUFBTSxFQUNOLFFBQVEsRUFDUixLQUFLLEVBQ0wsWUFBWSxHQUtiLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDN0IsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBQyxvQkFBb0IsRUFBcUIsTUFBTSxjQUFjLENBQUM7QUFDdEUsT0FBTyxFQUE4QixhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7Ozs7QUFHakYsd0RBQXdEO0FBQ3hELG9CQUFvQjtBQUNwQixNQUFNLHFCQUFxQjtDQUFHO0FBQzlCLE1BQU0sMkJBQTJCLEdBQzlCLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBRXhDOztHQUVHO0FBd0JILE1BQU0sT0FBTyxpQkFBa0IsU0FBUSwyQkFBMkI7SUFtQmhFLFlBQ1UsSUFBdUIsRUFDdkIsV0FBb0MsRUFFMUIsU0FBZSxFQUN6QixhQUE0QixFQUVhLFdBQW1EO1FBR3BHLDhFQUE4RTtRQUM5RSxLQUFLLEVBQUUsQ0FBQztRQVZBLFNBQUksR0FBSixJQUFJLENBQW1CO1FBQ3ZCLGdCQUFXLEdBQVgsV0FBVyxDQUF5QjtRQUdwQyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUVhLGdCQUFXLEdBQVgsV0FBVyxDQUF3QztRQXhCN0YsU0FBSSxHQUFjLElBQUksQ0FBQztRQUNoQyxtQ0FBbUM7UUFDMUIsU0FBSSxHQUFzRCxVQUFVLENBQUM7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O2lCQUMvQixtQkFDZ0IsdUJBQXVCLENBQUMsTUFBTSxpQkFDaEMsaUJBQWlCLENBQUMsSUFBSTs7c0JBMEJsQyxNQUFNO3VCQUFDLFFBQVE7O3NCQUdmLE1BQU07dUJBQUMsb0JBQW9COztzQkFBRyxRQUFRO3dCQXhCaEMsSUFBSTtrQkFBWixLQUFLO1lBRUcsSUFBSTtrQkFBWixLQUFLO1lBMEZOLGNBQWM7a0JBRGIsWUFBWTttQkFBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUM7WUFlakMsaUJBQWlCO2tCQURoQixZQUFZO21CQUFDLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IEdvb2dsZSBMTEMgQWxsIFJpZ2h0cyBSZXNlcnZlZC5cclxuICpcclxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcclxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxyXG4gKi9cclxuXHJcbmltcG9ydCB7Rm9jdXNhYmxlT3B0aW9uLCBGb2N1c01vbml0b3IsIEZvY3VzT3JpZ2lufSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XHJcbmltcG9ydCB7Qm9vbGVhbklucHV0fSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xyXG5pbXBvcnQge1xyXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gIENvbXBvbmVudCxcclxuICBFbGVtZW50UmVmLFxyXG4gIE9uRGVzdHJveSxcclxuICBWaWV3RW5jYXBzdWxhdGlvbixcclxuICBJbmplY3QsXHJcbiAgT3B0aW9uYWwsXHJcbiAgSW5wdXQsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIEFmdGVyVmlld0luaXQsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQge1N1YmplY3R9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge0RPQ1VNRU5UfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQge1REU0JVVFRPTl9NRU5VX1BBTkVMLCBURFNCdXR0b25NZW51UGFuZWx9IGZyb20gJy4vbWVudS1wYW5lbCc7XHJcbmltcG9ydCB7IENhbkRpc2FibGUsIENhbkRpc2FibGVDdG9yLCBtaXhpbkRpc2FibGVkIH0gZnJvbSAndGRzLXVpL3NoYXJlZC9jb21tb24nO1xyXG5pbXBvcnQgeyBCdXR0b25TaXplLCBOZ0NsYXNzSW50ZXJmYWNlIH0gZnJvbSAndGRzLXVpL2NvcmUvY29uZmlnJztcclxuXHJcbi8vIEJvaWxlcnBsYXRlIGZvciBhcHBseWluZyBtaXhpbnMgdG8gVERTQnV0dG9uTWVudUl0ZW0uXHJcbi8qKiBAZG9jcy1wcml2YXRlICovXHJcbmNsYXNzIFREU0J1dHRvbk1lbnVJdGVtQmFzZSB7fVxyXG5jb25zdCBfVERTQnV0dG9uTWVudUl0ZW1NaXhpbkJhc2U6ICBDYW5EaXNhYmxlQ3RvciAmIHR5cGVvZiBURFNCdXR0b25NZW51SXRlbUJhc2UgPVxyXG4gICBtaXhpbkRpc2FibGVkKFREU0J1dHRvbk1lbnVJdGVtQmFzZSk7XHJcblxyXG4vKipcclxuICogU2luZ2xlIGl0ZW0gaW5zaWRlIG9mIGEgYHRidXR0b24tbWVudWAuIFByb3ZpZGVzIHRoZSBtZW51IGl0ZW0gc3R5bGluZyBhbmQgYWNjZXNzaWJpbGl0eSB0cmVhdG1lbnQuXHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ1t0ZHMtYnV0dG9uLW1lbnUtaXRlbV0nLFxyXG4gIGV4cG9ydEFzOiAnVERTQnV0dG9uTWVudUl0ZW0nLFxyXG4gIGlucHV0czogWydkaXNhYmxlZCcsICdkaXNhYmxlUmlwcGxlJ10sXHJcbiAgaG9zdDoge1xyXG4gICAgJ1thdHRyLnJvbGVdJzogJ3JvbGUnLFxyXG4gICAgJ1tjbGFzcy50ZHMtYnV0dG9uLW1lbnUtaXRlbV0nOiAndHJ1ZScsICAgXHJcbiAgICAnW2NsYXNzLnRkcy1idXR0b24tbWVudS1pdGVtLWhpZ2hsaWdodGVkXSc6ICdfaGlnaGxpZ2h0ZWQnLFxyXG4gICAgJ1tjbGFzcy50ZHMtYnV0dG9uLW1lbnUtaXRlbS1zdWJtZW51LXRyaWdnZXJdJzogJ190cmlnZ2Vyc1N1Ym1lbnUnLFxyXG4gICBcclxuICAgICdbYXR0ci50YWJpbmRleF0nOiAnX2dldFRhYkluZGV4KCknLCAgICBcclxuICAgICdbYXR0ci5hcmlhLWRpc2FibGVkXSc6ICdkaXNhYmxlZC50b1N0cmluZygpJyxcclxuICAgICdbYXR0ci5kaXNhYmxlZF0nOiAnZGlzYWJsZWQgfHwgbnVsbCcsXHJcbiAgICAnY2xhc3MnOiAnZmxleCAgZmxleC1jb2wganVzdGlmeS1jZW50ZXIgdy1mdWxsIHRleHQtYm9keS0yIGZvbnQtcmVndWxhciAgaG92ZXI6YmctbmV1dHJhbC0zLTUwIGZvY3VzOm91dGxpbmUtbm9uZSBweC0zIGRhcms6aG92ZXI6YmctZC1uZXV0cmFsLTMtMzAwJyxcclxuICAgICdbY2xhc3MucHgtM10nIDpcInRydWVcIixcclxuICAgIFwiW2NsYXNzLnB5LTJdXCI6IFwic2l6ZSA9PSAnbWQnXCIsXHJcbiAgICBcIltjbGFzcy5weS0xLjVdXCI6IFwic2l6ZSA9PSAnc20nXCIsICAgICBcclxuICAgICdbY2xhc3MucHktM10nOiBcInNpemUgPT0gJ2xnJ1wiLFxyXG4gIH0sXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXHJcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcclxuICB0ZW1wbGF0ZVVybDogJ21lbnUtaXRlbS5odG1sJyxcclxufSlcclxuZXhwb3J0IGNsYXNzIFREU0J1dHRvbk1lbnVJdGVtIGV4dGVuZHMgX1REU0J1dHRvbk1lbnVJdGVtTWl4aW5CYXNlXHJcbiAgICBpbXBsZW1lbnRzIEZvY3VzYWJsZU9wdGlvbiwgQ2FuRGlzYWJsZSwgIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSxPbkNoYW5nZXMge1xyXG4gIEBJbnB1dCgpIHNpemU6QnV0dG9uU2l6ZSA9ICdtZCc7XHJcbiAgLyoqIEFSSUEgcm9sZSBmb3IgdGhlIG1lbnUgaXRlbS4gKi9cclxuICBASW5wdXQoKSByb2xlOiAnbWVudWl0ZW0nIHwgJ21lbnVpdGVtcmFkaW8nIHwgJ21lbnVpdGVtY2hlY2tib3gnID0gJ21lbnVpdGVtJztcclxuXHJcbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gdGhlIG1lbnUgaXRlbSBpcyBob3ZlcmVkLiAqL1xyXG4gIHJlYWRvbmx5IF9ob3ZlcmVkOiBTdWJqZWN0PFREU0J1dHRvbk1lbnVJdGVtPiA9IG5ldyBTdWJqZWN0PFREU0J1dHRvbk1lbnVJdGVtPigpO1xyXG5cclxuICAvKiogU3RyZWFtIHRoYXQgZW1pdHMgd2hlbiB0aGUgbWVudSBpdGVtIGlzIGZvY3VzZWQuICovXHJcbiAgcmVhZG9ubHkgX2ZvY3VzZWQgPSBuZXcgU3ViamVjdDxURFNCdXR0b25NZW51SXRlbT4oKTtcclxuXHJcbiAgLyoqIFdoZXRoZXIgdGhlIG1lbnUgaXRlbSBpcyBoaWdobGlnaHRlZC4gKi9cclxuICBfaGlnaGxpZ2h0ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgLyoqIFdoZXRoZXIgdGhlIG1lbnUgaXRlbSBhY3RzIGFzIGEgdHJpZ2dlciBmb3IgYSBzdWItbWVudS4gKi9cclxuICBfdHJpZ2dlcnNTdWJtZW51OiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIG5nY2xzISA6TmdDbGFzc0ludGVyZmFjZTtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgX2NkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBwcml2YXRlIF9lbGVtZW50UmVmOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PiwgICBcclxuICBcclxuICAgIEBJbmplY3QoRE9DVU1FTlQpIF9kb2N1bWVudD86IGFueSxcclxuICAgIHByaXZhdGUgX2ZvY3VzTW9uaXRvcj86IEZvY3VzTW9uaXRvcixcclxuICAgXHJcbiAgICBASW5qZWN0KFREU0JVVFRPTl9NRU5VX1BBTkVMKSBAT3B0aW9uYWwoKSBwdWJsaWMgX3BhcmVudE1lbnU/OiBURFNCdXR0b25NZW51UGFuZWw8VERTQnV0dG9uTWVudUl0ZW0+LFxyXG4gICApIHtcclxuXHJcbiAgICAvLyBAYnJlYWtpbmctY2hhbmdlIDguMC4wIG1ha2UgYF9mb2N1c01vbml0b3JgIGFuZCBgZG9jdW1lbnRgIHJlcXVpcmVkIHBhcmFtcy5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgaWYgKF9wYXJlbnRNZW51ICYmIF9wYXJlbnRNZW51LmFkZEl0ZW0pIHtcclxuICAgICAgX3BhcmVudE1lbnUuYWRkSXRlbSh0aGlzKTtcclxuICAgIH1cclxuICB9XHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgY29uc3QgIHtzaXplfT1jaGFuZ2VzXHJcbiAgICBpZihzaXplKVxyXG4gICAge1xyXG4gICAgIHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBGb2N1c2VzIHRoZSBtZW51IGl0ZW0uICovXHJcbiAgZm9jdXMob3JpZ2luPzogRm9jdXNPcmlnaW4sIG9wdGlvbnM/OiBGb2N1c09wdGlvbnMpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLl9mb2N1c01vbml0b3IgJiYgb3JpZ2luKSB7XHJcbiAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5mb2N1c1ZpYSh0aGlzLl9nZXRIb3N0RWxlbWVudCgpLCBvcmlnaW4sIG9wdGlvbnMpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fZ2V0SG9zdEVsZW1lbnQoKS5mb2N1cyhvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9mb2N1c2VkLm5leHQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICBpZiAodGhpcy5fZm9jdXNNb25pdG9yKSB7XHJcbiAgICAgIC8vIFN0YXJ0IG1vbml0b3JpbmcgdGhlIGVsZW1lbnQgc28gaXQgZ2V0cyB0aGUgYXBwcm9wcmlhdGUgZm9jdXNlZCBjbGFzc2VzLiBXZSB3YW50XHJcbiAgICAgIC8vIHRvIHNob3cgdGhlIGZvY3VzIHN0eWxlIGZvciBtZW51IGl0ZW1zIG9ubHkgd2hlbiB0aGUgZm9jdXMgd2FzIG5vdCBjYXVzZWQgYnkgYVxyXG4gICAgICAvLyBtb3VzZSBvciB0b3VjaCBpbnRlcmFjdGlvbi5cclxuICAgICAgdGhpcy5fZm9jdXNNb25pdG9yLm1vbml0b3IodGhpcy5fZWxlbWVudFJlZiwgZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICBpZiAodGhpcy5fZm9jdXNNb25pdG9yKSB7XHJcbiAgICAgIHRoaXMuX2ZvY3VzTW9uaXRvci5zdG9wTW9uaXRvcmluZyh0aGlzLl9lbGVtZW50UmVmKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5fcGFyZW50TWVudSAmJiB0aGlzLl9wYXJlbnRNZW51LnJlbW92ZUl0ZW0pIHtcclxuICAgICAgdGhpcy5fcGFyZW50TWVudS5yZW1vdmVJdGVtKHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2hvdmVyZWQuY29tcGxldGUoKTtcclxuICAgIHRoaXMuX2ZvY3VzZWQuY29tcGxldGUoKTtcclxuICB9XHJcblxyXG4gIC8qKiBVc2VkIHRvIHNldCB0aGUgYHRhYmluZGV4YC4gKi9cclxuICBfZ2V0VGFiSW5kZXgoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmRpc2FibGVkID8gJy0xJyA6ICcwJztcclxuICB9XHJcblxyXG4gIC8qKiBSZXR1cm5zIHRoZSBob3N0IERPTSBlbGVtZW50LiAqL1xyXG4gIF9nZXRIb3N0RWxlbWVudCgpOiBIVE1MRWxlbWVudCB7XHJcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgLyoqIFByZXZlbnRzIHRoZSBkZWZhdWx0IGVsZW1lbnQgYWN0aW9ucyBpZiBpdCBpcyBkaXNhYmxlZC4gKi9cclxuICAvLyBXZSBoYXZlIHRvIHVzZSBhIGBIb3N0TGlzdGVuZXJgIGhlcmUgaW4gb3JkZXIgdG8gc3VwcG9ydCBib3RoIEl2eSBhbmQgVmlld0VuZ2luZS5cclxuICAvLyBJbiBJdnkgdGhlIGBob3N0YCBiaW5kaW5ncyB3aWxsIGJlIG1lcmdlZCB3aGVuIHRoaXMgY2xhc3MgaXMgZXh0ZW5kZWQsIHdoZXJlYXMgaW5cclxuICAvLyBWaWV3RW5naW5lIHRoZXkncmUgb3ZlcndyaXR0ZW4uXHJcbiAgLy8gVE9ETyhjcmlzYmV0byk6IHdlIG1vdmUgdGhpcyBiYWNrIGludG8gYGhvc3RgIG9uY2UgSXZ5IGlzIHR1cm5lZCBvbiBieSBkZWZhdWx0LlxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ob3N0LWRlY29yYXRvci1pbi1jb25jcmV0ZVxyXG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSlcclxuICBfY2hlY2tEaXNhYmxlZChldmVudDogRXZlbnQpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIEVtaXRzIHRvIHRoZSBob3ZlciBzdHJlYW0uICovXHJcbiAgLy8gV2UgaGF2ZSB0byB1c2UgYSBgSG9zdExpc3RlbmVyYCBoZXJlIGluIG9yZGVyIHRvIHN1cHBvcnQgYm90aCBJdnkgYW5kIFZpZXdFbmdpbmUuXHJcbiAgLy8gSW4gSXZ5IHRoZSBgaG9zdGAgYmluZGluZ3Mgd2lsbCBiZSBtZXJnZWQgd2hlbiB0aGlzIGNsYXNzIGlzIGV4dGVuZGVkLCB3aGVyZWFzIGluXHJcbiAgLy8gVmlld0VuZ2luZSB0aGV5J3JlIG92ZXJ3cml0dGVuLlxyXG4gIC8vIFRPRE8oY3Jpc2JldG8pOiB3ZSBtb3ZlIHRoaXMgYmFjayBpbnRvIGBob3N0YCBvbmNlIEl2eSBpcyB0dXJuZWQgb24gYnkgZGVmYXVsdC5cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taG9zdC1kZWNvcmF0b3ItaW4tY29uY3JldGVcclxuICBASG9zdExpc3RlbmVyKCdtb3VzZWVudGVyJylcclxuICBfaGFuZGxlTW91c2VFbnRlcigpIHtcclxuICAgIHRoaXMuX2hvdmVyZWQubmV4dCh0aGlzKTtcclxuICB9XHJcblxyXG4gIC8qKiBHZXRzIHRoZSBsYWJlbCB0byBiZSB1c2VkIHdoZW4gZGV0ZXJtaW5pbmcgd2hldGhlciB0aGUgb3B0aW9uIHNob3VsZCBiZSBmb2N1c2VkLiAqL1xyXG4gIGdldExhYmVsKCk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBjbG9uZSA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbG9uZU5vZGUodHJ1ZSkgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICBjb25zdCBpY29ucyA9IGNsb25lLnF1ZXJ5U2VsZWN0b3JBbGwoJ3Rkcy1pY29uLCAudGRzLWljb25zJyk7XHJcblxyXG4gICAgLy8gU3RyaXAgYXdheSBpY29ucyBzbyB0aGV5IGRvbid0IHNob3cgdXAgaW4gdGhlIHRleHQuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGljb25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGljb24gPSBpY29uc1tpXTtcclxuICAgICAgaWNvbi5wYXJlbnROb2RlPy5yZW1vdmVDaGlsZChpY29uKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY2xvbmUudGV4dENvbnRlbnQ/LnRyaW0oKSB8fCAnJztcclxuICB9XHJcbiAgcHJpdmF0ZSBwX3VwZGF0ZUNsc1NpemUoKVxyXG4gIHtcclxuICAgIHRoaXMubmdjbHMgPSB7XHJcbiAgICAgIFxyXG4gICAgIFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX2Rpc2FibGVkOiBCb29sZWFuSW5wdXQ7XHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX2Rpc2FibGVSaXBwbGU6IEJvb2xlYW5JbnB1dDtcclxufVxyXG4iLCI8bmctY29udGVudD48L25nLWNvbnRlbnQ+XHJcblxyXG4iXX0=