import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { eachDayOfInterval, endOfMonth, endOfWeek, startOfMonth, startOfWeek } from 'date-fns';
import { CandyDate } from 'tds-ui/core/time';
import * as i0 from "@angular/core";
import * as i1 from "tds-ui/i18n";
import * as i2 from "tds-ui/dropdown";
import * as i3 from "tds-ui/date-picker";
import * as i4 from "@angular/forms";
export class TDSCalendarDatepickerComponent {
    constructor(cdr, i18n, dateHelper) {
        this.cdr = cdr;
        this.i18n = i18n;
        this.dateHelper = dateHelper;
        this.tdsMode = "date";
        this.tdsViewDate = new Date();
        this.tdsViewDateChange = new EventEmitter();
        this.tdsValueChange = new EventEmitter();
        this.activeDate = new CandyDate();
        this.formatDate = 'MMMM yyyy';
        this.viewDate = '';
        this.dropdownVisible = false;
    }
    ngOnChanges(changes) {
        if (changes.tdsViewDate || changes.tdsMode) {
            this.activeDate = new CandyDate(this.tdsViewDate);
            this.updateFormatDate();
        }
    }
    ngOnInit() {
        // this.weekStartsOn = this.i18n.getDateLocale().
        this.updateFormatDate();
    }
    onChangeDatePicker(result) {
        if (!this.activeDate.isSame(result)) {
            this.activeDate = new CandyDate(result);
        }
        this.dropdownVisible = false;
        this.updateFormatDate();
        this.valueChange();
    }
    onNextPrevious(e, step) {
        e.stopPropagation();
        e.preventDefault();
        switch (this.tdsMode) {
            case 'date':
                this.activeDate = new CandyDate(this.activeDate.addDays(step).nativeDate);
                break;
            case 'week':
                this.activeDate = new CandyDate(this.activeDate.addMonths(step).nativeDate);
                break;
            case 'month':
                this.activeDate = new CandyDate(this.activeDate.addMonths(step).nativeDate);
                break;
            case 'year':
                this.activeDate = new CandyDate(this.activeDate.addYears(step).nativeDate);
                break;
            default:
                this.activeDate = new CandyDate(this.activeDate.addMonths(step).nativeDate);
                break;
        }
        this.valueChange();
        this.updateFormatDate();
    }
    updateFormatDate() {
        switch (this.tdsMode) {
            case 'date':
                this.formatDate = 'EEEE - dd/MM/yyyy';
                break;
            case 'week':
                this.formatDate = 'MMMM yyyy';
                break;
            case 'month':
                this.formatDate = 'MMMM - yyyy';
                break;
            case 'year':
                this.formatDate = 'yyyy';
                break;
            default:
                this.formatDate = 'yyyy';
                break;
        }
        this.viewDate = this.dateHelper.format(this.activeDate.nativeDate, this.formatDate);
        this.cdr.markForCheck();
    }
    valueChange() {
        let viewDate = this.activeDate.clone().nativeDate;
        this.tdsViewDateChange.emit(viewDate);
        let rangeDate = [];
        switch (this.tdsMode) {
            case 'week':
                rangeDate = this.getDayOfWeek(viewDate);
                break;
            case 'month':
                rangeDate = this.getDayOfMonth(viewDate);
                break;
            default:
                rangeDate = [viewDate];
                break;
        }
        this.tdsValueChange.emit(rangeDate);
    }
    onDropdownOutsideClick() {
        if (this.dropdownVisible) {
            this.dropdownVisible = false;
        }
    }
    getDayOfWeek(viewDate) {
        let startWeek = startOfWeek(viewDate, { weekStartsOn: this.tdsWeekStartsOn || this.dateHelper.getFirstDayOfWeek() });
        let endWeek = endOfWeek(viewDate, { weekStartsOn: this.tdsWeekStartsOn || this.dateHelper.getFirstDayOfWeek() });
        return eachDayOfInterval({
            start: startWeek,
            end: endWeek
        });
    }
    getDayOfMonth(viewDate) {
        let startMonth = startOfMonth(viewDate);
        let endMonth = endOfMonth(viewDate);
        return eachDayOfInterval({
            start: startMonth,
            end: endMonth
        });
    }
}
TDSCalendarDatepickerComponent.ɵfac = function TDSCalendarDatepickerComponent_Factory(t) { return new (t || TDSCalendarDatepickerComponent)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.TDSI18nService), i0.ɵɵdirectiveInject(i1.DateHelperService)); };
TDSCalendarDatepickerComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSCalendarDatepickerComponent, selectors: [["tds-calendar-datepicker"]], inputs: { tdsMode: "tdsMode", tdsViewDate: "tdsViewDate", locale: "locale", tdsWeekStartsOn: "tdsWeekStartsOn" }, outputs: { tdsViewDateChange: "tdsViewDateChange", tdsValueChange: "tdsValueChange" }, exportAs: ["tdsCalendarDatepicker"], features: [i0.ɵɵNgOnChangesFeature], decls: 11, vars: 9, consts: [[1, "inline-flex", "justify-center", "items-center", "gap-x-4"], [1, "text-neutral-1-500", "hover:bg-neutral-3-50", "active:bg-neutral-3-100", "border", "border-transparent", "p-1.5", "rounded-full", "inline-flex", "justify-center", "items-center", 3, "click"], [1, "tdsi-arrow-left-line", "text-2xl", "leading-6"], ["tds-dropdown", "", 1, "inline-flex", "justify-center", "items-center", "text-heading-4", "font-semibold", "text-neutral-1-900", "py-2", 3, "autoClose", "placement", "visible", "trigger", "tdsDropdownMenu", "visibleChange", "tdsDropdownOutsideClick"], [1, "tdsi-arrow-right-line", "text-2xl", "leading-6"], ["drpDatepicker", "tdsDropdownMenu"], [1, "w-full"], [3, "inline", "ngModel", "mode", "ngModelChange"]], template: function TDSCalendarDatepickerComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵelementStart(0, "div", 0)(1, "button", 1);
        i0.ɵɵlistener("click", function TDSCalendarDatepickerComponent_Template_button_click_1_listener($event) { return ctx.onNextPrevious($event, -1); });
        i0.ɵɵelement(2, "span", 2);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(3, "button", 3);
        i0.ɵɵlistener("visibleChange", function TDSCalendarDatepickerComponent_Template_button_visibleChange_3_listener($event) { return ctx.dropdownVisible = $event; })("tdsDropdownOutsideClick", function TDSCalendarDatepickerComponent_Template_button_tdsDropdownOutsideClick_3_listener() { return ctx.onDropdownOutsideClick(); });
        i0.ɵɵtext(4);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(5, "button", 1);
        i0.ɵɵlistener("click", function TDSCalendarDatepickerComponent_Template_button_click_5_listener($event) { return ctx.onNextPrevious($event, 1); });
        i0.ɵɵelement(6, "span", 4);
        i0.ɵɵelementEnd()();
        i0.ɵɵelementStart(7, "tds-dropdown-menu", null, 5)(9, "div", 6)(10, "tds-date-picker", 7);
        i0.ɵɵlistener("ngModelChange", function TDSCalendarDatepickerComponent_Template_tds_date_picker_ngModelChange_10_listener($event) { return ctx.onChangeDatePicker($event); });
        i0.ɵɵelementEnd()()();
    } if (rf & 2) {
        const _r0 = i0.ɵɵreference(8);
        i0.ɵɵadvance(3);
        i0.ɵɵproperty("autoClose", false)("placement", "bottomCenter")("visible", ctx.dropdownVisible)("trigger", "click")("tdsDropdownMenu", _r0);
        i0.ɵɵadvance(1);
        i0.ɵɵtextInterpolate1(" ", ctx.viewDate, " ");
        i0.ɵɵadvance(6);
        i0.ɵɵproperty("inline", true)("ngModel", ctx.activeDate.nativeDate)("mode", ctx.tdsMode);
    } }, directives: [i2.TDSDropDownDirective, i2.TDSDropdownMenuComponent, i3.TDSDatePickerComponent, i4.NgControlStatus, i4.NgModel], encapsulation: 2, changeDetection: 0 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSCalendarDatepickerComponent, [{
        type: Component,
        args: [{ selector: 'tds-calendar-datepicker', exportAs: 'tdsCalendarDatepicker', encapsulation: ViewEncapsulation.None, changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"inline-flex justify-center items-center gap-x-4 \">\r\n    <button (click)=\"onNextPrevious($event,-1)\" class=\"text-neutral-1-500 hover:bg-neutral-3-50 active:bg-neutral-3-100 border border-transparent p-1.5 rounded-full inline-flex justify-center items-center\">\r\n        <span class=\"tdsi-arrow-left-line text-2xl leading-6\"></span>\r\n    </button>\r\n    <button class=\"inline-flex justify-center items-center text-heading-4 font-semibold text-neutral-1-900 py-2\" [autoClose]=\"false\" [placement]=\"'bottomCenter'\" [(visible)]=\"dropdownVisible\" [trigger]=\"'click'\"  tds-dropdown [tdsDropdownMenu]=\"drpDatepicker\" (tdsDropdownOutsideClick)=\"onDropdownOutsideClick()\">\r\n        {{viewDate}}\r\n    </button>\r\n    <button (click)=\"onNextPrevious($event,1)\"  class=\"text-neutral-1-500 hover:bg-neutral-3-50 active:bg-neutral-3-100 border border-transparent p-1.5 rounded-full inline-flex justify-center items-center\">\r\n        <span class=\"tdsi-arrow-right-line text-2xl leading-6\"></span>\r\n    </button>\r\n</div>\r\n<tds-dropdown-menu #drpDatepicker=\"tdsDropdownMenu\">\r\n    <div class=\"w-full\" >\r\n        <tds-date-picker [inline]=\"true\" [ngModel]=\"activeDate.nativeDate\" (ngModelChange)=\"onChangeDatePicker($event)\" [mode]=\"tdsMode\">\r\n        </tds-date-picker>\r\n    </div>\r\n</tds-dropdown-menu>" }]
    }], function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.TDSI18nService }, { type: i1.DateHelperService }]; }, { tdsMode: [{
            type: Input
        }], tdsViewDate: [{
            type: Input
        }], locale: [{
            type: Input
        }], tdsWeekStartsOn: [{
            type: Input
        }], tdsViewDateChange: [{
            type: Output
        }], tdsValueChange: [{
            type: Output
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGRzLWNhbGVuZGFyLWRhdGVwaWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvdGRzLXVpL2NhbGVuZGFyL3Rkcy1jYWxlbmRhci1kYXRlcGlja2VyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL3Rkcy11aS9jYWxlbmRhci90ZHMtY2FsZW5kYXItZGF0ZXBpY2tlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQXFCLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQWlCLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hLLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFrQixZQUFZLEVBQUUsV0FBVyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQy9HLE9BQU8sRUFBRSxTQUFTLEVBQWdCLE1BQU0sa0JBQWtCLENBQUM7Ozs7OztBQVczRCxNQUFNLE9BQU8sOEJBQThCO0lBV3pDLFlBQW9CLEdBQXNCLEVBQVUsSUFBb0IsRUFBVSxVQUE2QjtRQUEzRixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUFVLFNBQUksR0FBSixJQUFJLENBQWdCO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFWdEcsWUFBTyxHQUFvQixNQUFNLENBQUM7UUFDbEMsZ0JBQVcsR0FBUyxJQUFJLElBQUksRUFBRSxDQUFDO1FBR3JCLHNCQUFpQixHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFDN0MsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBZSxDQUFDO1FBQ3BFLGVBQVUsR0FBYyxJQUFJLFNBQVMsRUFBRSxDQUFDO1FBQ3hDLGVBQVUsR0FBRyxXQUFXLENBQUM7UUFDekIsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNkLG9CQUFlLEdBQUcsS0FBSyxDQUFDO0lBR3hCLENBQUM7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aUJBQWlCO2tCQUFuQyxNQUFNO1lBQ1ksY0FBYztrQkFBaEMsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBlYWNoRGF5T2ZJbnRlcnZhbCwgZW5kT2ZNb250aCwgZW5kT2ZXZWVrLCBsYXN0RGF5T2ZNb250aCwgc3RhcnRPZk1vbnRoLCBzdGFydE9mV2VlayB9IGZyb20gJ2RhdGUtZm5zJztcclxuaW1wb3J0IHsgQ2FuZHlEYXRlLCBXZWVrRGF5SW5kZXggfSBmcm9tICd0ZHMtdWkvY29yZS90aW1lJztcclxuaW1wb3J0IHsgVERTQ2FsZW5kYXJNb2RlIH0gZnJvbSAndGRzLXVpL2RhdGUtcGlja2VyJztcclxuaW1wb3J0IHsgRGF0ZUhlbHBlclNlcnZpY2UsIFREU0NhbGVuZGFySTE4bkludGVyZmFjZSwgVERTSTE4blNlcnZpY2UgfSBmcm9tICd0ZHMtdWkvaTE4bic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3Rkcy1jYWxlbmRhci1kYXRlcGlja2VyJyxcclxuICBleHBvcnRBczogJ3Rkc0NhbGVuZGFyRGF0ZXBpY2tlcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3Rkcy1jYWxlbmRhci1kYXRlcGlja2VyLmNvbXBvbmVudC5odG1sJyxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVERTQ2FsZW5kYXJEYXRlcGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gIEBJbnB1dCgpIHRkc01vZGU6IFREU0NhbGVuZGFyTW9kZSA9IFwiZGF0ZVwiO1xyXG4gIEBJbnB1dCgpIHRkc1ZpZXdEYXRlOiBEYXRlID0gbmV3IERhdGUoKTtcclxuICBASW5wdXQoKSBsb2NhbGUhOiBURFNDYWxlbmRhckkxOG5JbnRlcmZhY2U7XHJcbiAgQElucHV0KCkgIHRkc1dlZWtTdGFydHNPbjogV2Vla0RheUluZGV4IHwgdW5kZWZpbmVkO1xyXG4gIEBPdXRwdXQoKSByZWFkb25seSB0ZHNWaWV3RGF0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8RGF0ZT4oKTtcclxuICBAT3V0cHV0KCkgcmVhZG9ubHkgdGRzVmFsdWVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPEFycmF5PERhdGU+PigpO1xyXG4gIGFjdGl2ZURhdGU6IENhbmR5RGF0ZSA9IG5ldyBDYW5keURhdGUoKTtcclxuICBmb3JtYXREYXRlID0gJ01NTU0geXl5eSc7XHJcbiAgdmlld0RhdGUgPSAnJztcclxuICBkcm9wZG93blZpc2libGUgPSBmYWxzZTtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgaTE4bjogVERTSTE4blNlcnZpY2UsIHByaXZhdGUgZGF0ZUhlbHBlcjogRGF0ZUhlbHBlclNlcnZpY2UpIHtcclxuXHJcbiAgfVxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChjaGFuZ2VzLnRkc1ZpZXdEYXRlIHx8IGNoYW5nZXMudGRzTW9kZSkge1xyXG4gICAgICB0aGlzLmFjdGl2ZURhdGUgPSBuZXcgQ2FuZHlEYXRlKHRoaXMudGRzVmlld0RhdGUpO1xyXG4gICAgICB0aGlzLnVwZGF0ZUZvcm1hdERhdGUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgLy8gdGhpcy53ZWVrU3RhcnRzT24gPSB0aGlzLmkxOG4uZ2V0RGF0ZUxvY2FsZSgpLlxyXG4gICAgdGhpcy51cGRhdGVGb3JtYXREYXRlKCk7XHJcbiAgfVxyXG4gIG9uQ2hhbmdlRGF0ZVBpY2tlcihyZXN1bHQ6IERhdGUpIHtcclxuICAgIGlmICghdGhpcy5hY3RpdmVEYXRlLmlzU2FtZShyZXN1bHQpKSB7XHJcbiAgICAgIHRoaXMuYWN0aXZlRGF0ZSA9IG5ldyBDYW5keURhdGUocmVzdWx0KTtcclxuICAgIH1cclxuICAgIHRoaXMuZHJvcGRvd25WaXNpYmxlID0gZmFsc2U7XHJcbiAgICB0aGlzLnVwZGF0ZUZvcm1hdERhdGUoKTtcclxuXHJcbiAgICB0aGlzLnZhbHVlQ2hhbmdlKCk7XHJcbiAgfVxyXG4gIG9uTmV4dFByZXZpb3VzKGU6IE1vdXNlRXZlbnQsIHN0ZXA6IG51bWJlcikge1xyXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBzd2l0Y2ggKHRoaXMudGRzTW9kZSkge1xyXG4gICAgICBjYXNlICdkYXRlJzpcclxuICAgICAgICB0aGlzLmFjdGl2ZURhdGUgPSBuZXcgQ2FuZHlEYXRlKHRoaXMuYWN0aXZlRGF0ZS5hZGREYXlzKHN0ZXApLm5hdGl2ZURhdGUpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICd3ZWVrJzpcclxuICAgICAgICB0aGlzLmFjdGl2ZURhdGUgPSBuZXcgQ2FuZHlEYXRlKHRoaXMuYWN0aXZlRGF0ZS5hZGRNb250aHMoc3RlcCkubmF0aXZlRGF0ZSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ21vbnRoJzpcclxuICAgICAgICB0aGlzLmFjdGl2ZURhdGUgPSBuZXcgQ2FuZHlEYXRlKHRoaXMuYWN0aXZlRGF0ZS5hZGRNb250aHMoc3RlcCkubmF0aXZlRGF0ZSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3llYXInOlxyXG4gICAgICAgIHRoaXMuYWN0aXZlRGF0ZSA9IG5ldyBDYW5keURhdGUodGhpcy5hY3RpdmVEYXRlLmFkZFllYXJzKHN0ZXApLm5hdGl2ZURhdGUpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRoaXMuYWN0aXZlRGF0ZSA9IG5ldyBDYW5keURhdGUodGhpcy5hY3RpdmVEYXRlLmFkZE1vbnRocyhzdGVwKS5uYXRpdmVEYXRlKTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHRoaXMudmFsdWVDaGFuZ2UoKTtcclxuICAgIHRoaXMudXBkYXRlRm9ybWF0RGF0ZSgpO1xyXG4gIH1cclxuXHJcblxyXG4gIHByaXZhdGUgdXBkYXRlRm9ybWF0RGF0ZSgpIHtcclxuICAgIHN3aXRjaCAodGhpcy50ZHNNb2RlKSB7XHJcbiAgICAgIGNhc2UgJ2RhdGUnOlxyXG4gICAgICAgIHRoaXMuZm9ybWF0RGF0ZSA9ICdFRUVFIC0gZGQvTU0veXl5eSc7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3dlZWsnOlxyXG4gICAgICAgIHRoaXMuZm9ybWF0RGF0ZSA9ICdNTU1NIHl5eXknO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdtb250aCc6XHJcbiAgICAgICAgdGhpcy5mb3JtYXREYXRlID0gJ01NTU0gLSB5eXl5JztcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAneWVhcic6XHJcbiAgICAgICAgdGhpcy5mb3JtYXREYXRlID0gJ3l5eXknO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRoaXMuZm9ybWF0RGF0ZSA9ICd5eXl5JztcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHRoaXMudmlld0RhdGUgPSB0aGlzLmRhdGVIZWxwZXIuZm9ybWF0KHRoaXMuYWN0aXZlRGF0ZS5uYXRpdmVEYXRlLCB0aGlzLmZvcm1hdERhdGUpO1xyXG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XHJcblxyXG4gIH1cclxuICB2YWx1ZUNoYW5nZSgpIHtcclxuICAgIGxldCB2aWV3RGF0ZSA9IHRoaXMuYWN0aXZlRGF0ZS5jbG9uZSgpLm5hdGl2ZURhdGU7XHJcbiAgICB0aGlzLnRkc1ZpZXdEYXRlQ2hhbmdlLmVtaXQodmlld0RhdGUpO1xyXG4gICAgbGV0IHJhbmdlRGF0ZTogQXJyYXk8RGF0ZT4gPSBbXTtcclxuICAgIHN3aXRjaCAodGhpcy50ZHNNb2RlKSB7XHJcbiAgICAgIGNhc2UgJ3dlZWsnOlxyXG4gICAgICAgIHJhbmdlRGF0ZSA9IHRoaXMuZ2V0RGF5T2ZXZWVrKHZpZXdEYXRlKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbW9udGgnOlxyXG4gICAgICAgIHJhbmdlRGF0ZSA9IHRoaXMuZ2V0RGF5T2ZNb250aCh2aWV3RGF0ZSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmFuZ2VEYXRlID0gW3ZpZXdEYXRlXTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHRoaXMudGRzVmFsdWVDaGFuZ2UuZW1pdChyYW5nZURhdGUpO1xyXG4gIH1cclxuICBvbkRyb3Bkb3duT3V0c2lkZUNsaWNrKCl7XHJcbiAgICBpZih0aGlzLmRyb3Bkb3duVmlzaWJsZSlcclxuICAgIHtcclxuICAgICAgdGhpcy5kcm9wZG93blZpc2libGUgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBnZXREYXlPZldlZWsodmlld0RhdGU6IERhdGUpIHtcclxuICAgIGxldCBzdGFydFdlZWsgPSBzdGFydE9mV2Vlayh2aWV3RGF0ZSwgeyB3ZWVrU3RhcnRzT246IHRoaXMudGRzV2Vla1N0YXJ0c09uIHx8IHRoaXMuZGF0ZUhlbHBlci5nZXRGaXJzdERheU9mV2VlaygpIH0pO1xyXG4gICAgbGV0IGVuZFdlZWsgPSBlbmRPZldlZWsodmlld0RhdGUsIHsgd2Vla1N0YXJ0c09uOiB0aGlzLnRkc1dlZWtTdGFydHNPbiB8fCB0aGlzLmRhdGVIZWxwZXIuZ2V0Rmlyc3REYXlPZldlZWsoKSB9KTtcclxuICAgIHJldHVybiBlYWNoRGF5T2ZJbnRlcnZhbCh7XHJcbiAgICAgIHN0YXJ0OiBzdGFydFdlZWssXHJcbiAgICAgIGVuZDogZW5kV2Vla1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0RGF5T2ZNb250aCh2aWV3RGF0ZTogRGF0ZSkge1xyXG4gICAgbGV0IHN0YXJ0TW9udGggPSBzdGFydE9mTW9udGgodmlld0RhdGUpO1xyXG4gICAgbGV0IGVuZE1vbnRoID0gZW5kT2ZNb250aCh2aWV3RGF0ZSk7XHJcbiAgICByZXR1cm4gZWFjaERheU9mSW50ZXJ2YWwoe1xyXG4gICAgICBzdGFydDogc3RhcnRNb250aCxcclxuICAgICAgZW5kOiBlbmRNb250aFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG4iLCI8ZGl2IGNsYXNzPVwiaW5saW5lLWZsZXgganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIGdhcC14LTQgXCI+XHJcbiAgICA8YnV0dG9uIChjbGljayk9XCJvbk5leHRQcmV2aW91cygkZXZlbnQsLTEpXCIgY2xhc3M9XCJ0ZXh0LW5ldXRyYWwtMS01MDAgaG92ZXI6YmctbmV1dHJhbC0zLTUwIGFjdGl2ZTpiZy1uZXV0cmFsLTMtMTAwIGJvcmRlciBib3JkZXItdHJhbnNwYXJlbnQgcC0xLjUgcm91bmRlZC1mdWxsIGlubGluZS1mbGV4IGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlclwiPlxyXG4gICAgICAgIDxzcGFuIGNsYXNzPVwidGRzaS1hcnJvdy1sZWZ0LWxpbmUgdGV4dC0yeGwgbGVhZGluZy02XCI+PC9zcGFuPlxyXG4gICAgPC9idXR0b24+XHJcbiAgICA8YnV0dG9uIGNsYXNzPVwiaW5saW5lLWZsZXgganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIHRleHQtaGVhZGluZy00IGZvbnQtc2VtaWJvbGQgdGV4dC1uZXV0cmFsLTEtOTAwIHB5LTJcIiBbYXV0b0Nsb3NlXT1cImZhbHNlXCIgW3BsYWNlbWVudF09XCInYm90dG9tQ2VudGVyJ1wiIFsodmlzaWJsZSldPVwiZHJvcGRvd25WaXNpYmxlXCIgW3RyaWdnZXJdPVwiJ2NsaWNrJ1wiICB0ZHMtZHJvcGRvd24gW3Rkc0Ryb3Bkb3duTWVudV09XCJkcnBEYXRlcGlja2VyXCIgKHRkc0Ryb3Bkb3duT3V0c2lkZUNsaWNrKT1cIm9uRHJvcGRvd25PdXRzaWRlQ2xpY2soKVwiPlxyXG4gICAgICAgIHt7dmlld0RhdGV9fVxyXG4gICAgPC9idXR0b24+XHJcbiAgICA8YnV0dG9uIChjbGljayk9XCJvbk5leHRQcmV2aW91cygkZXZlbnQsMSlcIiAgY2xhc3M9XCJ0ZXh0LW5ldXRyYWwtMS01MDAgaG92ZXI6YmctbmV1dHJhbC0zLTUwIGFjdGl2ZTpiZy1uZXV0cmFsLTMtMTAwIGJvcmRlciBib3JkZXItdHJhbnNwYXJlbnQgcC0xLjUgcm91bmRlZC1mdWxsIGlubGluZS1mbGV4IGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlclwiPlxyXG4gICAgICAgIDxzcGFuIGNsYXNzPVwidGRzaS1hcnJvdy1yaWdodC1saW5lIHRleHQtMnhsIGxlYWRpbmctNlwiPjwvc3Bhbj5cclxuICAgIDwvYnV0dG9uPlxyXG48L2Rpdj5cclxuPHRkcy1kcm9wZG93bi1tZW51ICNkcnBEYXRlcGlja2VyPVwidGRzRHJvcGRvd25NZW51XCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwidy1mdWxsXCIgPlxyXG4gICAgICAgIDx0ZHMtZGF0ZS1waWNrZXIgW2lubGluZV09XCJ0cnVlXCIgW25nTW9kZWxdPVwiYWN0aXZlRGF0ZS5uYXRpdmVEYXRlXCIgKG5nTW9kZWxDaGFuZ2UpPVwib25DaGFuZ2VEYXRlUGlja2VyKCRldmVudClcIiBbbW9kZV09XCJ0ZHNNb2RlXCI+XHJcbiAgICAgICAgPC90ZHMtZGF0ZS1waWNrZXI+XHJcbiAgICA8L2Rpdj5cclxuPC90ZHMtZHJvcGRvd24tbWVudT4iXX0=