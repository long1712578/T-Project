import { __decorate } from "tslib";
import { ChangeDetectionStrategy, Component, ContentChild, EventEmitter, forwardRef, Input, Optional, Output, TemplateRef, ViewEncapsulation } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { CandyDate } from 'tds-ui/core/time';
import { InputBoolean } from 'tds-ui/shared/utility';
import { TDSDateCellDirective as DateCell, TDSDateFullCellDirective as DateFullCell, TDSMonthCellDirective as MonthCell, TDSMonthFullCellDirective as MonthFullCell } from './calendar-cells';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/bidi";
import * as i2 from "./calendar-header.component";
import * as i3 from "@angular/common";
import * as i4 from "./tds-calendar-mode-day.component";
function TDSCalendarComponent_ng_container_3_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵelementStart(1, "tds-calendar-mode-day", 4);
    i0.ɵɵprojection(2);
    i0.ɵɵelementEnd();
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("viewDate", ctx_r0.activeDate.nativeDate);
} }
function TDSCalendarComponent_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵtext(1, " tu\u1EA7n ");
    i0.ɵɵelementContainerEnd();
} }
function TDSCalendarComponent_ng_container_5_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵtext(1, " th\u00E1ng ");
    i0.ɵɵelementContainerEnd();
} }
function TDSCalendarComponent_ng_container_6_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵtext(1, " n\u0103m ");
    i0.ɵɵelementContainerEnd();
} }
const _c0 = ["*"];
export class TDSCalendarComponent {
    constructor(cdr, directionality) {
        this.cdr = cdr;
        this.directionality = directionality;
        this.activeDate = new CandyDate();
        this.prefixCls = 'tds-picker-calendar';
        this.destroy$ = new Subject();
        this.dir = 'ltr';
        this.onChangeFn = () => { };
        this.onTouchFn = () => { };
        this.tdsMode = 'month';
        this.tdsModeChange = new EventEmitter();
        this.tdsPanelChange = new EventEmitter();
        this.tdsSelectChange = new EventEmitter();
        this.tdsValueChange = new EventEmitter();
        this.tdsFullscreen = true;
    }
    get dateCell() {
        return (this.tdsDateCell || this.tdsDateCellChild);
    }
    get dateFullCell() {
        return (this.tdsDateFullCell || this.tdsDateFullCellChild);
    }
    get monthCell() {
        return (this.tdsMonthCell || this.tdsMonthCellChild);
    }
    get monthFullCell() {
        return (this.tdsMonthFullCell || this.tdsMonthFullCellChild);
    }
    ngOnInit() {
        this.dir = this.directionality.value;
        this.directionality.change?.pipe(takeUntil(this.destroy$)).subscribe(() => {
            this.dir = this.directionality.value;
        });
    }
    onModeChange(mode) {
        this.tdsModeChange.emit(mode);
        this.tdsPanelChange.emit({ date: this.activeDate.nativeDate, mode });
    }
    onYearSelect(year) {
        const date = this.activeDate.setYear(year);
        this.updateDate(date);
    }
    onMonthSelect(month) {
        const date = this.activeDate.setMonth(month);
        this.updateDate(date);
    }
    onDateSelect(date) {
        // Only activeDate is enough in calendar
        // this.value = date;
        this.updateDate(date);
    }
    writeValue(value) {
        this.updateDate(new CandyDate(value), false);
        this.cdr.markForCheck();
    }
    registerOnChange(fn) {
        this.onChangeFn = fn;
    }
    registerOnTouched(fn) {
        this.onTouchFn = fn;
    }
    updateDate(date, touched = true) {
        this.activeDate = date;
        if (touched) {
            this.onChangeFn(date.nativeDate);
            this.onTouchFn();
            this.tdsSelectChange.emit(date.nativeDate);
            this.tdsValueChange.emit(date.nativeDate);
        }
    }
    ngOnChanges(changes) {
        if (changes.tdsValue) {
            this.updateDate(new CandyDate(this.tdsValue), false);
        }
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
}
TDSCalendarComponent.ɵfac = function TDSCalendarComponent_Factory(t) { return new (t || TDSCalendarComponent)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.Directionality, 8)); };
TDSCalendarComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSCalendarComponent, selectors: [["tds-calendar"]], contentQueries: function TDSCalendarComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        i0.ɵɵcontentQuery(dirIndex, DateCell, 5, TemplateRef);
        i0.ɵɵcontentQuery(dirIndex, DateFullCell, 5, TemplateRef);
        i0.ɵɵcontentQuery(dirIndex, MonthCell, 5, TemplateRef);
        i0.ɵɵcontentQuery(dirIndex, MonthFullCell, 5, TemplateRef);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tdsDateCellChild = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tdsDateFullCellChild = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tdsMonthCellChild = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tdsMonthFullCellChild = _t.first);
    } }, hostAttrs: [1, "tds-picker-calendar", "border", "border-primary-1", "block"], hostVars: 6, hostBindings: function TDSCalendarComponent_HostBindings(rf, ctx) { if (rf & 2) {
        i0.ɵɵclassProp("tds-picker-calendar-full", ctx.tdsFullscreen)("tds-picker-calendar-mini", !ctx.tdsFullscreen)("tds-picker-calendar-rtl", ctx.dir === "rtl");
    } }, inputs: { tdsMode: "tdsMode", tdsValue: "tdsValue", tdsDisabledDate: "tdsDisabledDate", tdsDateCell: "tdsDateCell", tdsDateFullCell: "tdsDateFullCell", tdsMonthCell: "tdsMonthCell", tdsMonthFullCell: "tdsMonthFullCell", tdsFullscreen: "tdsFullscreen" }, outputs: { tdsModeChange: "tdsModeChange", tdsPanelChange: "tdsPanelChange", tdsSelectChange: "tdsSelectChange", tdsValueChange: "tdsValueChange" }, exportAs: ["tdsCalendar"], features: [i0.ɵɵProvidersFeature([{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => TDSCalendarComponent), multi: true }]), i0.ɵɵNgOnChangesFeature], ngContentSelectors: _c0, decls: 7, vars: 8, consts: [[3, "tdsFullscreen", "tdsViewDate", "tdsMode", "tdsViewDateChange", "tdsModeChange"], [1, "tds-picker-calendar-body"], [3, "ngSwitch"], [4, "ngSwitchCase"], [3, "viewDate"]], template: function TDSCalendarComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵprojectionDef();
        i0.ɵɵelementStart(0, "tds-calendar-header", 0);
        i0.ɵɵlistener("tdsViewDateChange", function TDSCalendarComponent_Template_tds_calendar_header_tdsViewDateChange_0_listener($event) { return ctx.activeDate.nativeDate = $event; })("tdsModeChange", function TDSCalendarComponent_Template_tds_calendar_header_tdsModeChange_0_listener($event) { return ctx.onModeChange($event); });
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(1, "div", 1);
        i0.ɵɵelementContainerStart(2, 2);
        i0.ɵɵtemplate(3, TDSCalendarComponent_ng_container_3_Template, 3, 1, "ng-container", 3);
        i0.ɵɵtemplate(4, TDSCalendarComponent_ng_container_4_Template, 2, 0, "ng-container", 3);
        i0.ɵɵtemplate(5, TDSCalendarComponent_ng_container_5_Template, 2, 0, "ng-container", 3);
        i0.ɵɵtemplate(6, TDSCalendarComponent_ng_container_6_Template, 2, 0, "ng-container", 3);
        i0.ɵɵelementContainerEnd();
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵproperty("tdsFullscreen", ctx.tdsFullscreen)("tdsViewDate", ctx.activeDate.nativeDate)("tdsMode", ctx.tdsMode);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("ngSwitch", ctx.tdsMode);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngSwitchCase", "date");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngSwitchCase", "week");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngSwitchCase", "month");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngSwitchCase", "year");
    } }, directives: [i2.TDSCalendarHeaderComponent, i3.NgSwitch, i3.NgSwitchCase, i4.TDSCalendarModeDayComponent], encapsulation: 2, changeDetection: 0 });
__decorate([
    InputBoolean()
], TDSCalendarComponent.prototype, "tdsFullscreen", void 0);
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSCalendarComponent, [{
        type: Component,
        args: [{
                encapsulation: ViewEncapsulation.None,
                changeDetection: ChangeDetectionStrategy.OnPush,
                selector: 'tds-calendar',
                exportAs: 'tdsCalendar',
                template: `
    <tds-calendar-header
      [tdsFullscreen]="tdsFullscreen"
      [(tdsViewDate)]="activeDate.nativeDate"
      [tdsMode]="tdsMode"
      (tdsModeChange)="onModeChange($event)"
      
    ></tds-calendar-header>
    <div class="tds-picker-calendar-body">
      <ng-container [ngSwitch]="tdsMode">
        <ng-container *ngSwitchCase="'date'">
          <tds-calendar-mode-day [viewDate]="activeDate.nativeDate">
            <ng-content></ng-content>
          </tds-calendar-mode-day>
        </ng-container>
        <ng-container *ngSwitchCase="'week'">
          tuần
        </ng-container>
        <ng-container *ngSwitchCase="'month'">
          tháng
        </ng-container>
        <ng-container *ngSwitchCase="'year'">
          năm
        </ng-container>
      </ng-container>
    </div>
    <!-- <div class="tds-picker-panel">
      <div class="tds-picker-{{ tdsMode === 'month' ? 'day' : 'month' }}-panel">
        <div class="">
          <ng-container *ngIf="tdsMode === 'month'; then monthModeTable; else yearModeTable"></ng-container>
        </div>
      </div>
    </div> -->
    <!-- <ng-template #monthModeTable> -->
      <!--  TODO [cellRender] [fullCellRender] -->
      <!-- <date-table
        [prefixCls]="prefixCls"
        [value]="activeDate"
        [activeDate]="activeDate"
        [cellRender]="$any(dateCell)"
        [fullCellRender]="$any(dateFullCell)"
        [disabledDate]="tdsDisabledDate"
        (valueChange)="onDateSelect($event)"
      ></date-table>
    </ng-template> -->

    <!--  TODO [cellRender] [fullCellRender] -->
    <!-- <ng-template #yearModeTable>
      <month-table
        [prefixCls]="prefixCls"
        [value]="activeDate"
        [activeDate]="activeDate"
        [cellRender]="$any(monthCell)"
        [fullCellRender]="$any(monthFullCell)"
        (valueChange)="onDateSelect($event)"
      ></month-table>
    </ng-template> -->
  `,
                host: {
                    class: 'tds-picker-calendar border border-primary-1 block',
                    '[class.tds-picker-calendar-full]': 'tdsFullscreen',
                    '[class.tds-picker-calendar-mini]': '!tdsFullscreen',
                    '[class.tds-picker-calendar-rtl]': `dir === 'rtl'`
                },
                providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => TDSCalendarComponent), multi: true }]
            }]
    }], function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.Directionality, decorators: [{
                type: Optional
            }] }]; }, { tdsMode: [{
            type: Input
        }], tdsValue: [{
            type: Input
        }], tdsDisabledDate: [{
            type: Input
        }], tdsModeChange: [{
            type: Output
        }], tdsPanelChange: [{
            type: Output
        }], tdsSelectChange: [{
            type: Output
        }], tdsValueChange: [{
            type: Output
        }], tdsDateCell: [{
            type: Input
        }], tdsDateCellChild: [{
            type: ContentChild,
            args: [DateCell, { static: false, read: TemplateRef }]
        }], tdsDateFullCell: [{
            type: Input
        }], tdsDateFullCellChild: [{
            type: ContentChild,
            args: [DateFullCell, { static: false, read: TemplateRef }]
        }], tdsMonthCell: [{
            type: Input
        }], tdsMonthCellChild: [{
            type: ContentChild,
            args: [MonthCell, { static: false, read: TemplateRef }]
        }], tdsMonthFullCell: [{
            type: Input
        }], tdsMonthFullCellChild: [{
            type: ContentChild,
            args: [MonthFullCell, { static: false, read: TemplateRef }]
        }], tdsFullscreen: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvdGRzLXVpL2NhbGVuZGFyL2NhbGVuZGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBSUEsT0FBTyxFQUNMLHVCQUF1QixFQUV2QixTQUFTLEVBQ1QsWUFBWSxFQUNaLFlBQVksRUFDWixVQUFVLEVBQ1YsS0FBSyxFQUlMLFFBQVEsRUFDUixNQUFNLEVBRU4sV0FBVyxFQUNYLGlCQUFpQixFQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTdDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVyRCxPQUFPLEVBQ0wsb0JBQW9CLElBQUksUUFBUSxFQUNoQyx3QkFBd0IsSUFBSSxZQUFZLEVBQ3hDLHFCQUFxQixJQUFJLFNBQVMsRUFDbEMseUJBQXlCLElBQUksYUFBYSxFQUMzQyxNQUFNLGtCQUFrQixDQUFDOzs7Ozs7O0lBbUJsQiw2QkFBcUM7SUFDbkMsZ0RBQTBEO0lBQ3hELGtCQUF5QjtJQUMzQixpQkFBd0I7SUFDMUIsMEJBQWU7OztJQUhVLGVBQWtDO0lBQWxDLHVEQUFrQzs7O0lBSTNELDZCQUFxQztJQUNuQywyQkFDRjtJQUFBLDBCQUFlOzs7SUFDZiw2QkFBc0M7SUFDcEMsNEJBQ0Y7SUFBQSwwQkFBZTs7O0lBQ2YsNkJBQXFDO0lBQ25DLDBCQUNGO0lBQUEsMEJBQWU7OztBQTJDdkIsTUFBTSxPQUFPLG9CQUFvQjtJQWtEL0IsWUFBb0IsR0FBc0IsRUFBc0IsY0FBOEI7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QWhCLEtBQUs7WUFDRyxlQUFlO2tCQUF2QixLQUFLO1lBRWEsYUFBYTtrQkFBL0IsTUFBTTtZQUNZLGNBQWM7a0JBQWhDLE1BQU07WUFDWSxlQUFlO2tCQUFqQyxNQUFNO1lBQ1ksY0FBYztrQkFBaEMsTUFBTTtZQU1FLFdBQVc7a0JBQW5CLEtBQUs7WUFDd0QsZ0JBQWdCO2tCQUE3RSxZQUFZO21CQUFDLFFBQVEsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRTtZQUtuRCxlQUFlO2tCQUF2QixLQUFLO1lBQzRELG9CQUFvQjtrQkFBckYsWUFBWTttQkFBQyxZQUFZLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUU7WUFLdkQsWUFBWTtrQkFBcEIsS0FBSztZQUN5RCxpQkFBaUI7a0JBQS9FLFlBQVk7bUJBQUMsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFO1lBS3BELGdCQUFnQjtrQkFBeEIsS0FBSztZQUM2RCxxQkFBcUI7a0JBQXZGLFlBQVk7bUJBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFO1lBS3hDLGFBQWE7a0JBQXJDLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJcblxuaW1wb3J0IHsgRGlyZWN0aW9uLCBEaXJlY3Rpb25hbGl0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9iaWRpJztcbmltcG9ydCB7IEJvb2xlYW5JbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBFdmVudEVtaXR0ZXIsXG4gIGZvcndhcmRSZWYsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPcHRpb25hbCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0VuY2Fwc3VsYXRpb25cbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBDYW5keURhdGUgfSBmcm9tICd0ZHMtdWkvY29yZS90aW1lJztcbmltcG9ydCB7IFREU0NhbGVuZGFyTW9kZSB9IGZyb20gJ3Rkcy11aS9kYXRlLXBpY2tlcic7XG5pbXBvcnQgeyBJbnB1dEJvb2xlYW4gfSBmcm9tICd0ZHMtdWkvc2hhcmVkL3V0aWxpdHknO1xuXG5pbXBvcnQge1xuICBURFNEYXRlQ2VsbERpcmVjdGl2ZSBhcyBEYXRlQ2VsbCxcbiAgVERTRGF0ZUZ1bGxDZWxsRGlyZWN0aXZlIGFzIERhdGVGdWxsQ2VsbCxcbiAgVERTTW9udGhDZWxsRGlyZWN0aXZlIGFzIE1vbnRoQ2VsbCxcbiAgVERTTW9udGhGdWxsQ2VsbERpcmVjdGl2ZSBhcyBNb250aEZ1bGxDZWxsXG59IGZyb20gJy4vY2FsZW5kYXItY2VsbHMnO1xuXG50eXBlIFREU0NhbGVuZGFyRGF0ZVRlbXBsYXRlID0gVGVtcGxhdGVSZWY8eyAkaW1wbGljaXQ6IERhdGUgfT47XG5cbkBDb21wb25lbnQoe1xuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgc2VsZWN0b3I6ICd0ZHMtY2FsZW5kYXInLFxuICBleHBvcnRBczogJ3Rkc0NhbGVuZGFyJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8dGRzLWNhbGVuZGFyLWhlYWRlclxuICAgICAgW3Rkc0Z1bGxzY3JlZW5dPVwidGRzRnVsbHNjcmVlblwiXG4gICAgICBbKHRkc1ZpZXdEYXRlKV09XCJhY3RpdmVEYXRlLm5hdGl2ZURhdGVcIlxuICAgICAgW3Rkc01vZGVdPVwidGRzTW9kZVwiXG4gICAgICAodGRzTW9kZUNoYW5nZSk9XCJvbk1vZGVDaGFuZ2UoJGV2ZW50KVwiXG4gICAgICBcbiAgICA+PC90ZHMtY2FsZW5kYXItaGVhZGVyPlxuICAgIDxkaXYgY2xhc3M9XCJ0ZHMtcGlja2VyLWNhbGVuZGFyLWJvZHlcIj5cbiAgICAgIDxuZy1jb250YWluZXIgW25nU3dpdGNoXT1cInRkc01vZGVcIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hDYXNlPVwiJ2RhdGUnXCI+XG4gICAgICAgICAgPHRkcy1jYWxlbmRhci1tb2RlLWRheSBbdmlld0RhdGVdPVwiYWN0aXZlRGF0ZS5uYXRpdmVEYXRlXCI+XG4gICAgICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgPC90ZHMtY2FsZW5kYXItbW9kZS1kYXk+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCInd2VlaydcIj5cbiAgICAgICAgICB0deG6p25cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nU3dpdGNoQ2FzZT1cIidtb250aCdcIj5cbiAgICAgICAgICB0aMOhbmdcbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nU3dpdGNoQ2FzZT1cIid5ZWFyJ1wiPlxuICAgICAgICAgIG7Eg21cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8L2Rpdj5cbiAgICA8IS0tIDxkaXYgY2xhc3M9XCJ0ZHMtcGlja2VyLXBhbmVsXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwidGRzLXBpY2tlci17eyB0ZHNNb2RlID09PSAnbW9udGgnID8gJ2RheScgOiAnbW9udGgnIH19LXBhbmVsXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJcIj5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwidGRzTW9kZSA9PT0gJ21vbnRoJzsgdGhlbiBtb250aE1vZGVUYWJsZTsgZWxzZSB5ZWFyTW9kZVRhYmxlXCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+IC0tPlxuICAgIDwhLS0gPG5nLXRlbXBsYXRlICNtb250aE1vZGVUYWJsZT4gLS0+XG4gICAgICA8IS0tICBUT0RPIFtjZWxsUmVuZGVyXSBbZnVsbENlbGxSZW5kZXJdIC0tPlxuICAgICAgPCEtLSA8ZGF0ZS10YWJsZVxuICAgICAgICBbcHJlZml4Q2xzXT1cInByZWZpeENsc1wiXG4gICAgICAgIFt2YWx1ZV09XCJhY3RpdmVEYXRlXCJcbiAgICAgICAgW2FjdGl2ZURhdGVdPVwiYWN0aXZlRGF0ZVwiXG4gICAgICAgIFtjZWxsUmVuZGVyXT1cIiRhbnkoZGF0ZUNlbGwpXCJcbiAgICAgICAgW2Z1bGxDZWxsUmVuZGVyXT1cIiRhbnkoZGF0ZUZ1bGxDZWxsKVwiXG4gICAgICAgIFtkaXNhYmxlZERhdGVdPVwidGRzRGlzYWJsZWREYXRlXCJcbiAgICAgICAgKHZhbHVlQ2hhbmdlKT1cIm9uRGF0ZVNlbGVjdCgkZXZlbnQpXCJcbiAgICAgID48L2RhdGUtdGFibGU+XG4gICAgPC9uZy10ZW1wbGF0ZT4gLS0+XG5cbiAgICA8IS0tICBUT0RPIFtjZWxsUmVuZGVyXSBbZnVsbENlbGxSZW5kZXJdIC0tPlxuICAgIDwhLS0gPG5nLXRlbXBsYXRlICN5ZWFyTW9kZVRhYmxlPlxuICAgICAgPG1vbnRoLXRhYmxlXG4gICAgICAgIFtwcmVmaXhDbHNdPVwicHJlZml4Q2xzXCJcbiAgICAgICAgW3ZhbHVlXT1cImFjdGl2ZURhdGVcIlxuICAgICAgICBbYWN0aXZlRGF0ZV09XCJhY3RpdmVEYXRlXCJcbiAgICAgICAgW2NlbGxSZW5kZXJdPVwiJGFueShtb250aENlbGwpXCJcbiAgICAgICAgW2Z1bGxDZWxsUmVuZGVyXT1cIiRhbnkobW9udGhGdWxsQ2VsbClcIlxuICAgICAgICAodmFsdWVDaGFuZ2UpPVwib25EYXRlU2VsZWN0KCRldmVudClcIlxuICAgICAgPjwvbW9udGgtdGFibGU+XG4gICAgPC9uZy10ZW1wbGF0ZT4gLS0+XG4gIGAsXG4gIGhvc3Q6IHtcbiAgICBjbGFzczogJ3Rkcy1waWNrZXItY2FsZW5kYXIgYm9yZGVyIGJvcmRlci1wcmltYXJ5LTEgYmxvY2snLFxuICAgICdbY2xhc3MudGRzLXBpY2tlci1jYWxlbmRhci1mdWxsXSc6ICd0ZHNGdWxsc2NyZWVuJyxcbiAgICAnW2NsYXNzLnRkcy1waWNrZXItY2FsZW5kYXItbWluaV0nOiAnIXRkc0Z1bGxzY3JlZW4nLFxuICAgICdbY2xhc3MudGRzLXBpY2tlci1jYWxlbmRhci1ydGxdJzogYGRpciA9PT0gJ3J0bCdgXG4gIH0sXG4gIHByb3ZpZGVyczogW3sgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFREU0NhbGVuZGFyQ29tcG9uZW50KSwgbXVsdGk6IHRydWUgfV1cbn0pXG5leHBvcnQgY2xhc3MgVERTQ2FsZW5kYXJDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25DaGFuZ2VzLCBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV90ZHNGdWxsc2NyZWVuOiBCb29sZWFuSW5wdXQ7XG5cbiAgYWN0aXZlRGF0ZTogQ2FuZHlEYXRlID0gbmV3IENhbmR5RGF0ZSgpO1xuICBwcmVmaXhDbHM6IHN0cmluZyA9ICd0ZHMtcGlja2VyLWNhbGVuZGFyJztcbiAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIGRpcjogRGlyZWN0aW9uID0gJ2x0cic7XG5cbiAgcHJpdmF0ZSBvbkNoYW5nZUZuOiAoZGF0ZTogRGF0ZSkgPT4gdm9pZCA9ICgpID0+IHsgfTtcbiAgcHJpdmF0ZSBvblRvdWNoRm46ICgpID0+IHZvaWQgPSAoKSA9PiB7IH07XG5cbiAgQElucHV0KCkgdGRzTW9kZTogVERTQ2FsZW5kYXJNb2RlID0gJ21vbnRoJztcbiAgQElucHV0KCkgdGRzVmFsdWU/OiBEYXRlO1xuICBASW5wdXQoKSB0ZHNEaXNhYmxlZERhdGU/OiAoZGF0ZTogRGF0ZSkgPT4gYm9vbGVhbjtcblxuICBAT3V0cHV0KCkgcmVhZG9ubHkgdGRzTW9kZUNoYW5nZTogRXZlbnRFbWl0dGVyPFREU0NhbGVuZGFyTW9kZT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSByZWFkb25seSB0ZHNQYW5lbENoYW5nZTogRXZlbnRFbWl0dGVyPHsgZGF0ZTogRGF0ZTsgbW9kZTogVERTQ2FsZW5kYXJNb2RlIH0+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgcmVhZG9ubHkgdGRzU2VsZWN0Q2hhbmdlOiBFdmVudEVtaXR0ZXI8RGF0ZT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSByZWFkb25seSB0ZHNWYWx1ZUNoYW5nZTogRXZlbnRFbWl0dGVyPERhdGU+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKlxuICAgKiBDYW5ub3QgdXNlIEBJbnB1dCBhbmQgQENvbnRlbnRDaGlsZCBvbiBvbmUgdmFyaWFibGVcbiAgICogYmVjYXVzZSB7IHN0YXRpYzogZmFsc2UgfSB3aWxsIG1ha2UgQElucHV0IHByb3BlcnR5IGdldCBkZWxheWVkXG4gICAqKi9cbiAgQElucHV0KCkgdGRzRGF0ZUNlbGw/OiBURFNDYWxlbmRhckRhdGVUZW1wbGF0ZTtcbiAgQENvbnRlbnRDaGlsZChEYXRlQ2VsbCwgeyBzdGF0aWM6IGZhbHNlLCByZWFkOiBUZW1wbGF0ZVJlZiB9KSB0ZHNEYXRlQ2VsbENoaWxkPzogVERTQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gIGdldCBkYXRlQ2VsbCgpOiBURFNDYWxlbmRhckRhdGVUZW1wbGF0ZSB7XG4gICAgcmV0dXJuICh0aGlzLnRkc0RhdGVDZWxsIHx8IHRoaXMudGRzRGF0ZUNlbGxDaGlsZCkhO1xuICB9XG5cbiAgQElucHV0KCkgdGRzRGF0ZUZ1bGxDZWxsPzogVERTQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gIEBDb250ZW50Q2hpbGQoRGF0ZUZ1bGxDZWxsLCB7IHN0YXRpYzogZmFsc2UsIHJlYWQ6IFRlbXBsYXRlUmVmIH0pIHRkc0RhdGVGdWxsQ2VsbENoaWxkPzogVERTQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gIGdldCBkYXRlRnVsbENlbGwoKTogVERTQ2FsZW5kYXJEYXRlVGVtcGxhdGUge1xuICAgIHJldHVybiAodGhpcy50ZHNEYXRlRnVsbENlbGwgfHwgdGhpcy50ZHNEYXRlRnVsbENlbGxDaGlsZCkhO1xuICB9XG5cbiAgQElucHV0KCkgdGRzTW9udGhDZWxsPzogVERTQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gIEBDb250ZW50Q2hpbGQoTW9udGhDZWxsLCB7IHN0YXRpYzogZmFsc2UsIHJlYWQ6IFRlbXBsYXRlUmVmIH0pIHRkc01vbnRoQ2VsbENoaWxkPzogVERTQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gIGdldCBtb250aENlbGwoKTogVERTQ2FsZW5kYXJEYXRlVGVtcGxhdGUge1xuICAgIHJldHVybiAodGhpcy50ZHNNb250aENlbGwgfHwgdGhpcy50ZHNNb250aENlbGxDaGlsZCkhO1xuICB9XG5cbiAgQElucHV0KCkgdGRzTW9udGhGdWxsQ2VsbD86IFREU0NhbGVuZGFyRGF0ZVRlbXBsYXRlO1xuICBAQ29udGVudENoaWxkKE1vbnRoRnVsbENlbGwsIHsgc3RhdGljOiBmYWxzZSwgcmVhZDogVGVtcGxhdGVSZWYgfSkgdGRzTW9udGhGdWxsQ2VsbENoaWxkPzogVERTQ2FsZW5kYXJEYXRlVGVtcGxhdGU7XG4gIGdldCBtb250aEZ1bGxDZWxsKCk6IFREU0NhbGVuZGFyRGF0ZVRlbXBsYXRlIHtcbiAgICByZXR1cm4gKHRoaXMudGRzTW9udGhGdWxsQ2VsbCB8fCB0aGlzLnRkc01vbnRoRnVsbENlbGxDaGlsZCkhO1xuICB9XG5cbiAgQElucHV0KCkgQElucHV0Qm9vbGVhbigpIHRkc0Z1bGxzY3JlZW46IGJvb2xlYW4gPSB0cnVlO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZiwgQE9wdGlvbmFsKCkgcHJpdmF0ZSBkaXJlY3Rpb25hbGl0eTogRGlyZWN0aW9uYWxpdHkpIHsgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZGlyID0gdGhpcy5kaXJlY3Rpb25hbGl0eS52YWx1ZTtcbiAgICB0aGlzLmRpcmVjdGlvbmFsaXR5LmNoYW5nZT8ucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmRpciA9IHRoaXMuZGlyZWN0aW9uYWxpdHkudmFsdWU7XG4gICAgfSk7XG4gIH1cblxuICBvbk1vZGVDaGFuZ2UobW9kZTogVERTQ2FsZW5kYXJNb2RlKTogdm9pZCB7XG4gICAgdGhpcy50ZHNNb2RlQ2hhbmdlLmVtaXQobW9kZSk7XG4gICAgdGhpcy50ZHNQYW5lbENoYW5nZS5lbWl0KHsgZGF0ZTogdGhpcy5hY3RpdmVEYXRlLm5hdGl2ZURhdGUsIG1vZGUgfSk7XG4gIH1cblxuICBvblllYXJTZWxlY3QoeWVhcjogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuYWN0aXZlRGF0ZS5zZXRZZWFyKHllYXIpO1xuICAgIHRoaXMudXBkYXRlRGF0ZShkYXRlKTtcbiAgfVxuXG4gIG9uTW9udGhTZWxlY3QobW9udGg6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmFjdGl2ZURhdGUuc2V0TW9udGgobW9udGgpO1xuICAgIHRoaXMudXBkYXRlRGF0ZShkYXRlKTtcbiAgfVxuXG4gIG9uRGF0ZVNlbGVjdChkYXRlOiBDYW5keURhdGUpOiB2b2lkIHtcbiAgICAvLyBPbmx5IGFjdGl2ZURhdGUgaXMgZW5vdWdoIGluIGNhbGVuZGFyXG4gICAgLy8gdGhpcy52YWx1ZSA9IGRhdGU7XG4gICAgdGhpcy51cGRhdGVEYXRlKGRhdGUpO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogRGF0ZSB8IG51bGwpOiB2b2lkIHtcbiAgICB0aGlzLnVwZGF0ZURhdGUobmV3IENhbmR5RGF0ZSh2YWx1ZSBhcyBEYXRlKSwgZmFsc2UpO1xuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKGRhdGU6IERhdGUpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLm9uQ2hhbmdlRm4gPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoRm4gPSBmbjtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRGF0ZShkYXRlOiBDYW5keURhdGUsIHRvdWNoZWQ6IGJvb2xlYW4gPSB0cnVlKTogdm9pZCB7XG4gICAgdGhpcy5hY3RpdmVEYXRlID0gZGF0ZTtcblxuICAgIGlmICh0b3VjaGVkKSB7XG4gICAgICB0aGlzLm9uQ2hhbmdlRm4oZGF0ZS5uYXRpdmVEYXRlKTtcbiAgICAgIHRoaXMub25Ub3VjaEZuKCk7XG4gICAgICB0aGlzLnRkc1NlbGVjdENoYW5nZS5lbWl0KGRhdGUubmF0aXZlRGF0ZSk7XG4gICAgICB0aGlzLnRkc1ZhbHVlQ2hhbmdlLmVtaXQoZGF0ZS5uYXRpdmVEYXRlKTtcbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMudGRzVmFsdWUpIHtcbiAgICAgIHRoaXMudXBkYXRlRGF0ZShuZXcgQ2FuZHlEYXRlKHRoaXMudGRzVmFsdWUpLCBmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XG4gICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG59XG4iXX0=