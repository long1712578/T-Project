import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output } from '@angular/core';
import { Subject } from 'rxjs';
import { isPromise } from 'tds-ui/core/util';
import * as i0 from "@angular/core";
import * as i1 from "./modal-types";
import * as i2 from "@angular/common";
import * as i3 from "tds-ui/core/outlet";
import * as i4 from "tds-ui/button";
const _c0 = ["tds-modal-footer", ""];
function TDSModalFooterComponent_ng_container_0_ng_container_1_div_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "div", 5);
} if (rf & 2) {
    const ctx_r4 = i0.ɵɵnextContext(3);
    i0.ɵɵproperty("innerHTML", ctx_r4.config.footer, i0.ɵɵsanitizeHtml);
} }
function TDSModalFooterComponent_ng_container_0_ng_container_1_ng_container_2_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r9 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "button", 8);
    i0.ɵɵlistener("click", function TDSModalFooterComponent_ng_container_0_ng_container_1_ng_container_2_button_2_Template_button_click_0_listener() { const restoredCtx = i0.ɵɵrestoreView(_r9); const button_r7 = restoredCtx.$implicit; const ctx_r8 = i0.ɵɵnextContext(4); return ctx_r8.onButtonClick(button_r7); });
    i0.ɵɵtext(1);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const button_r7 = ctx.$implicit;
    const ctx_r6 = i0.ɵɵnextContext(4);
    i0.ɵɵproperty("hidden", !ctx_r6.getButtonCallableProp(button_r7, "show"))("loading", ctx_r6.getButtonCallableProp(button_r7, "loading"))("disabled", ctx_r6.getButtonCallableProp(button_r7, "disabled"))("size", button_r7.size);
    i0.ɵɵadvance(1);
    i0.ɵɵtextInterpolate1(" ", button_r7.label, " ");
} }
function TDSModalFooterComponent_ng_container_0_ng_container_1_ng_container_2_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵelementStart(1, "div", 6);
    i0.ɵɵtemplate(2, TDSModalFooterComponent_ng_container_0_ng_container_1_ng_container_2_button_2_Template, 2, 5, "button", 7);
    i0.ɵɵelementEnd();
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r5 = i0.ɵɵnextContext(3);
    i0.ɵɵadvance(2);
    i0.ɵɵproperty("ngForOf", ctx_r5.buttons);
} }
function TDSModalFooterComponent_ng_container_0_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵtemplate(1, TDSModalFooterComponent_ng_container_0_ng_container_1_div_1_Template, 1, 1, "div", 3);
    i0.ɵɵtemplate(2, TDSModalFooterComponent_ng_container_0_ng_container_1_ng_container_2_Template, 3, 1, "ng-container", 4);
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r3 = i0.ɵɵnextContext(2);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngIf", !ctx_r3.buttonsFooter);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngIf", ctx_r3.buttonsFooter);
} }
const _c1 = function (a0, a1) { return { $implicit: a0, modalRef: a1 }; };
function TDSModalFooterComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵtemplate(1, TDSModalFooterComponent_ng_container_0_ng_container_1_Template, 3, 2, "ng-container", 2);
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("tdsStringTemplateOutlet", ctx_r0.config.footer)("tdsStringTemplateOutletContext", i0.ɵɵpureFunction2(2, _c1, ctx_r0.config.componentParams, ctx_r0.modalRef));
} }
function TDSModalFooterComponent_ng_template_1_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r13 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "button", 11);
    i0.ɵɵlistener("click", function TDSModalFooterComponent_ng_template_1_button_1_Template_button_click_0_listener() { i0.ɵɵrestoreView(_r13); const ctx_r12 = i0.ɵɵnextContext(2); return ctx_r12.onCancel(); });
    i0.ɵɵtext(1);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r10 = i0.ɵɵnextContext(2);
    i0.ɵɵproperty("disabled", ctx_r10.config.cancelDisabled);
    i0.ɵɵattribute("cdkFocusInitial", ctx_r10.config.autofocus === "cancel" || null);
    i0.ɵɵadvance(1);
    i0.ɵɵtextInterpolate1(" ", ctx_r10.config.cancelText || ctx_r10.locale.cancelText, " ");
} }
function TDSModalFooterComponent_ng_template_1_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r15 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "button", 12);
    i0.ɵɵlistener("click", function TDSModalFooterComponent_ng_template_1_button_2_Template_button_click_0_listener() { i0.ɵɵrestoreView(_r15); const ctx_r14 = i0.ɵɵnextContext(2); return ctx_r14.onOk(); });
    i0.ɵɵtext(1);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r11 = i0.ɵɵnextContext(2);
    i0.ɵɵproperty("disabled", ctx_r11.config.okDisabled);
    i0.ɵɵattribute("cdkFocusInitial", ctx_r11.config.autofocus === "ok" || null);
    i0.ɵɵadvance(1);
    i0.ɵɵtextInterpolate1(" ", ctx_r11.config.okText || ctx_r11.locale.okText, " ");
} }
function TDSModalFooterComponent_ng_template_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 6);
    i0.ɵɵtemplate(1, TDSModalFooterComponent_ng_template_1_button_1_Template, 2, 3, "button", 9);
    i0.ɵɵtemplate(2, TDSModalFooterComponent_ng_template_1_button_2_Template, 2, 3, "button", 10);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext();
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngIf", ctx_r2.config.cancelText !== null);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngIf", ctx_r2.config.okText !== null);
} }
export class TDSModalFooterComponent {
    constructor(config) {
        this.config = config;
        this.buttonsFooter = false;
        this.buttons = [];
        this.cancelTriggered = new EventEmitter();
        this.okTriggered = new EventEmitter();
        this.destroy$ = new Subject();
        this.locale = {
            okText: "Lưu",
            cancelText: "Hủy",
        };
        if (Array.isArray(config.footer)) {
            this.buttonsFooter = true;
            this.buttons = config.footer.map(mergeDefaultOption);
        }
    }
    onCancel() {
        this.cancelTriggered.emit();
    }
    onOk() {
        this.okTriggered.emit();
    }
    /**
     * Returns the value of the specified key.
     * If it is a function, run and return the return value of the function.
     */
    getButtonCallableProp(options, prop) {
        const value = options[prop];
        const componentInstance = this.modalRef.getContentComponent();
        return typeof value === 'function' ? value.apply(options, componentInstance && [componentInstance]) : value;
    }
    /**
     * Run function based on the type and set its `loading` prop if needed.
     */
    onButtonClick(options) {
        const loading = this.getButtonCallableProp(options, 'loading');
        if (!loading) {
            const result = this.getButtonCallableProp(options, 'onClick');
            if (options.autoLoading && isPromise(result)) {
                options.loading = true;
                result.then(() => (options.loading = false)).catch(() => (options.loading = false));
            }
        }
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
}
TDSModalFooterComponent.ɵfac = function TDSModalFooterComponent_Factory(t) { return new (t || TDSModalFooterComponent)(i0.ɵɵdirectiveInject(i1.ModalOptions)); };
TDSModalFooterComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSModalFooterComponent, selectors: [["div", "tds-modal-footer", ""]], hostAttrs: [1, "tds-modal-footer"], inputs: { modalRef: "modalRef" }, outputs: { cancelTriggered: "cancelTriggered", okTriggered: "okTriggered" }, exportAs: ["tdsModalFooterBuiltin"], attrs: _c0, decls: 3, vars: 2, consts: [[4, "ngIf", "ngIfElse"], ["defaultFooterButtons", ""], [4, "tdsStringTemplateOutlet", "tdsStringTemplateOutletContext"], [3, "innerHTML", 4, "ngIf"], [4, "ngIf"], [3, "innerHTML"], [1, "w-full", "flex", "justify-end", "p-4"], ["class", "ml-2 min-w-[100px]", "tds-button", "", 3, "hidden", "loading", "disabled", "size", "click", 4, "ngFor", "ngForOf"], ["tds-button", "", 1, "ml-2", "min-w-[100px]", 3, "hidden", "loading", "disabled", "size", "click"], ["class", "ml-2", "tds-button", "", "class", "min-w-[100px]", "color", "secondary", 3, "disabled", "click", 4, "ngIf"], ["tds-button", "", "class", "ml-2 min-w-[100px]", 3, "disabled", "click", 4, "ngIf"], ["tds-button", "", "color", "secondary", 1, "min-w-[100px]", 3, "disabled", "click"], ["tds-button", "", 1, "ml-2", "min-w-[100px]", 3, "disabled", "click"]], template: function TDSModalFooterComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵtemplate(0, TDSModalFooterComponent_ng_container_0_Template, 2, 5, "ng-container", 0);
        i0.ɵɵtemplate(1, TDSModalFooterComponent_ng_template_1_Template, 3, 2, "ng-template", null, 1, i0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        const _r1 = i0.ɵɵreference(2);
        i0.ɵɵproperty("ngIf", ctx.config.footer)("ngIfElse", _r1);
    } }, directives: [i2.NgIf, i3.TDSStringTemplateOutletDirective, i2.NgForOf, i4.TDSButtonComponent], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSModalFooterComponent, [{
        type: Component,
        args: [{
                selector: 'div[tds-modal-footer]',
                exportAs: 'tdsModalFooterBuiltin',
                template: `
    <ng-container *ngIf="config.footer; else defaultFooterButtons">
      <ng-container *tdsStringTemplateOutlet="config.footer; context: { $implicit: config.componentParams, modalRef: modalRef }">
        <div *ngIf="!buttonsFooter" [innerHTML]="config.footer"></div>
        <ng-container *ngIf="buttonsFooter">
        <div class="w-full flex justify-end p-4">
        <button
        class="ml-2 min-w-[100px]"
            *ngFor="let button of buttons"
            tds-button
            (click)="onButtonClick(button)"
            [hidden]="!getButtonCallableProp(button, 'show')"
            [loading]="getButtonCallableProp(button, 'loading')"
            [disabled]="getButtonCallableProp(button, 'disabled')"          
            [size]="button.size!"
          >
            {{ button.label }}
          </button>
        </div>
          
        </ng-container>
      </ng-container>
    </ng-container>
    <ng-template #defaultFooterButtons>
     <div class="w-full flex justify-end p-4">
     <button
     class="ml-2"
     *ngIf="config.cancelText !== null"
     [attr.cdkFocusInitial]="config.autofocus === 'cancel' || null"
     tds-button
     class="min-w-[100px]"
     color="secondary"
     (click)="onCancel()"      
     [disabled]="config.cancelDisabled!"
   >
     {{ config.cancelText || locale.cancelText }}
   </button>
   <button
     *ngIf="config.okText !== null"
     [attr.cdkFocusInitial]="config.autofocus === 'ok' || null"
     tds-button   
     (click)="onOk()"        
     [disabled]="config.okDisabled!"
     class="ml-2 min-w-[100px]"
   >
     {{ config.okText || locale.okText }} 
       </button>
     </div>
    </ng-template>
  `,
                host: {
                    class: 'tds-modal-footer'
                },
                changeDetection: ChangeDetectionStrategy.Default
            }]
    }], function () { return [{ type: i1.ModalOptions }]; }, { cancelTriggered: [{
            type: Output
        }], okTriggered: [{
            type: Output
        }], modalRef: [{
            type: Input
        }] }); })();
function mergeDefaultOption(options) {
    return {
        type: null,
        size: 'md',
        autoLoading: true,
        show: true,
        loading: false,
        disabled: false,
        color: 'secondary',
        ...options
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwtZm9vdGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL3Rkcy11aS9tb2RhbC9tb2RhbC1mb290ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0csT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7Ozs7Ozs7O0lBV3JDLHlCQUE4RDs7O0lBQWxDLG1FQUEyQjs7OztJQUd2RCxpQ0FTRztJQUxDLGtSQUFTLCtCQUFxQixJQUFDO0lBTS9CLFlBQ0Y7SUFBQSxpQkFBUzs7OztJQU5QLHlFQUFpRCwrREFBQSxpRUFBQSx3QkFBQTtJQUtqRCxlQUNGO0lBREUsZ0RBQ0Y7OztJQWJGLDZCQUFvQztJQUNwQyw4QkFBeUM7SUFDekMsMkhBV1c7SUFDWCxpQkFBTTtJQUVOLDBCQUFlOzs7SUFaUSxlQUFVO0lBQVYsd0NBQVU7OztJQU5uQyw2QkFBMkg7SUFDekgsc0dBQThEO0lBQzlELHdIQWdCZTtJQUNqQiwwQkFBZTs7O0lBbEJQLGVBQW9CO0lBQXBCLDRDQUFvQjtJQUNYLGVBQW1CO0lBQW5CLDJDQUFtQjs7OztJQUh0Qyw2QkFBK0Q7SUFDN0QseUdBbUJlO0lBQ2pCLDBCQUFlOzs7SUFwQkUsZUFBd0M7SUFBeEMsOERBQXdDLDhHQUFBOzs7O0lBdUJ4RCxrQ0FTRDtJQUZDLHdMQUFTLGtCQUFVLElBQUM7SUFHcEIsWUFDRjtJQUFBLGlCQUFTOzs7SUFIUCx3REFBbUM7SUFMbkMsZ0ZBQThEO0lBTzlELGVBQ0Y7SUFERSx1RkFDRjs7OztJQUNBLGtDQU9DO0lBSEMsd0xBQVMsY0FBTSxJQUFDO0lBSWhCLFlBQ0U7SUFBQSxp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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaURUO2dCQUNELElBQUksRUFBRTtvQkFDSixLQUFLLEVBQUUsa0JBQWtCO2lCQUMxQjtnQkFDRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsT0FBTzthQUNqRDsrREFJb0IsZUFBZTtrQkFBakMsTUFBTTtZQUNZLFdBQVc7a0JBQTdCLE1BQU07WUFDRSxRQUFRO2tCQUFoQixLQUFLOztBQXFEUixTQUFTLGtCQUFrQixDQUFDLE9BQTJCO0lBQ3JELE9BQU87UUFDTCxJQUFJLEVBQUUsSUFBSTtRQUNWLElBQUksRUFBRSxJQUFJO1FBQ1YsV0FBVyxFQUFFLElBQUk7UUFDakIsSUFBSSxFQUFFLElBQUk7UUFDVixPQUFPLEVBQUUsS0FBSztRQUNkLFFBQVEsRUFBRSxLQUFLO1FBQ2YsS0FBSyxFQUFDLFdBQVc7UUFDakIsR0FBRyxPQUFPO0tBQ1gsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuXHJcblxyXG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkRlc3Ryb3ksIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGlzUHJvbWlzZSB9IGZyb20gJ3Rkcy11aS9jb3JlL3V0aWwnO1xyXG5cclxuaW1wb3J0IHsgVERTTW9kYWxSZWYgfSBmcm9tICcuL21vZGFsLXJlZic7XHJcbmltcG9ydCB7IE1vZGFsQnV0dG9uT3B0aW9ucywgTW9kYWxPcHRpb25zIH0gZnJvbSAnLi9tb2RhbC10eXBlcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2Rpdlt0ZHMtbW9kYWwtZm9vdGVyXScsXHJcbiAgZXhwb3J0QXM6ICd0ZHNNb2RhbEZvb3RlckJ1aWx0aW4nLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiY29uZmlnLmZvb3RlcjsgZWxzZSBkZWZhdWx0Rm9vdGVyQnV0dG9uc1wiPlxyXG4gICAgICA8bmctY29udGFpbmVyICp0ZHNTdHJpbmdUZW1wbGF0ZU91dGxldD1cImNvbmZpZy5mb290ZXI7IGNvbnRleHQ6IHsgJGltcGxpY2l0OiBjb25maWcuY29tcG9uZW50UGFyYW1zLCBtb2RhbFJlZjogbW9kYWxSZWYgfVwiPlxyXG4gICAgICAgIDxkaXYgKm5nSWY9XCIhYnV0dG9uc0Zvb3RlclwiIFtpbm5lckhUTUxdPVwiY29uZmlnLmZvb3RlclwiPjwvZGl2PlxyXG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJidXR0b25zRm9vdGVyXCI+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInctZnVsbCBmbGV4IGp1c3RpZnktZW5kIHAtNFwiPlxyXG4gICAgICAgIDxidXR0b25cclxuICAgICAgICBjbGFzcz1cIm1sLTIgbWluLXctWzEwMHB4XVwiXHJcbiAgICAgICAgICAgICpuZ0Zvcj1cImxldCBidXR0b24gb2YgYnV0dG9uc1wiXHJcbiAgICAgICAgICAgIHRkcy1idXR0b25cclxuICAgICAgICAgICAgKGNsaWNrKT1cIm9uQnV0dG9uQ2xpY2soYnV0dG9uKVwiXHJcbiAgICAgICAgICAgIFtoaWRkZW5dPVwiIWdldEJ1dHRvbkNhbGxhYmxlUHJvcChidXR0b24sICdzaG93JylcIlxyXG4gICAgICAgICAgICBbbG9hZGluZ109XCJnZXRCdXR0b25DYWxsYWJsZVByb3AoYnV0dG9uLCAnbG9hZGluZycpXCJcclxuICAgICAgICAgICAgW2Rpc2FibGVkXT1cImdldEJ1dHRvbkNhbGxhYmxlUHJvcChidXR0b24sICdkaXNhYmxlZCcpXCIgICAgICAgICAgXHJcbiAgICAgICAgICAgIFtzaXplXT1cImJ1dHRvbi5zaXplIVwiXHJcbiAgICAgICAgICA+XHJcbiAgICAgICAgICAgIHt7IGJ1dHRvbi5sYWJlbCB9fVxyXG4gICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICBcclxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgICAgPC9uZy1jb250YWluZXI+XHJcbiAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgIDxuZy10ZW1wbGF0ZSAjZGVmYXVsdEZvb3RlckJ1dHRvbnM+XHJcbiAgICAgPGRpdiBjbGFzcz1cInctZnVsbCBmbGV4IGp1c3RpZnktZW5kIHAtNFwiPlxyXG4gICAgIDxidXR0b25cclxuICAgICBjbGFzcz1cIm1sLTJcIlxyXG4gICAgICpuZ0lmPVwiY29uZmlnLmNhbmNlbFRleHQgIT09IG51bGxcIlxyXG4gICAgIFthdHRyLmNka0ZvY3VzSW5pdGlhbF09XCJjb25maWcuYXV0b2ZvY3VzID09PSAnY2FuY2VsJyB8fCBudWxsXCJcclxuICAgICB0ZHMtYnV0dG9uXHJcbiAgICAgY2xhc3M9XCJtaW4tdy1bMTAwcHhdXCJcclxuICAgICBjb2xvcj1cInNlY29uZGFyeVwiXHJcbiAgICAgKGNsaWNrKT1cIm9uQ2FuY2VsKClcIiAgICAgIFxyXG4gICAgIFtkaXNhYmxlZF09XCJjb25maWcuY2FuY2VsRGlzYWJsZWQhXCJcclxuICAgPlxyXG4gICAgIHt7IGNvbmZpZy5jYW5jZWxUZXh0IHx8IGxvY2FsZS5jYW5jZWxUZXh0IH19XHJcbiAgIDwvYnV0dG9uPlxyXG4gICA8YnV0dG9uXHJcbiAgICAgKm5nSWY9XCJjb25maWcub2tUZXh0ICE9PSBudWxsXCJcclxuICAgICBbYXR0ci5jZGtGb2N1c0luaXRpYWxdPVwiY29uZmlnLmF1dG9mb2N1cyA9PT0gJ29rJyB8fCBudWxsXCJcclxuICAgICB0ZHMtYnV0dG9uICAgXHJcbiAgICAgKGNsaWNrKT1cIm9uT2soKVwiICAgICAgICBcclxuICAgICBbZGlzYWJsZWRdPVwiY29uZmlnLm9rRGlzYWJsZWQhXCJcclxuICAgICBjbGFzcz1cIm1sLTIgbWluLXctWzEwMHB4XVwiXHJcbiAgID5cclxuICAgICB7eyBjb25maWcub2tUZXh0IHx8IGxvY2FsZS5va1RleHQgfX0gXHJcbiAgICAgICA8L2J1dHRvbj5cclxuICAgICA8L2Rpdj5cclxuICAgIDwvbmctdGVtcGxhdGU+XHJcbiAgYCxcclxuICBob3N0OiB7XHJcbiAgICBjbGFzczogJ3Rkcy1tb2RhbC1mb290ZXInXHJcbiAgfSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LkRlZmF1bHRcclxufSlcclxuZXhwb3J0IGNsYXNzIFREU01vZGFsRm9vdGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcclxuICBidXR0b25zRm9vdGVyID0gZmFsc2U7XHJcbiAgYnV0dG9uczogTW9kYWxCdXR0b25PcHRpb25zW10gPSBbXTtcclxuICBAT3V0cHV0KCkgcmVhZG9ubHkgY2FuY2VsVHJpZ2dlcmVkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG4gIEBPdXRwdXQoKSByZWFkb25seSBva1RyaWdnZXJlZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuICBASW5wdXQoKSBtb2RhbFJlZiE6IFREU01vZGFsUmVmO1xyXG4gIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG4gIGxvY2FsZSA9IHtcclxuICAgIG9rVGV4dDogXCJMxrB1XCIsXHJcbiAgICBjYW5jZWxUZXh0OiBcIkjhu6d5XCIsXHJcbiAgfVxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBjb25maWc6IE1vZGFsT3B0aW9ucykge1xyXG5cclxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5mb290ZXIpKSB7XHJcbiAgICAgIHRoaXMuYnV0dG9uc0Zvb3RlciA9IHRydWU7XHJcbiAgICAgIHRoaXMuYnV0dG9ucyA9IChjb25maWcuZm9vdGVyIGFzIE1vZGFsQnV0dG9uT3B0aW9uc1tdKS5tYXAobWVyZ2VEZWZhdWx0T3B0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBvbkNhbmNlbCgpOiB2b2lkIHtcclxuICAgIHRoaXMuY2FuY2VsVHJpZ2dlcmVkLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIG9uT2soKTogdm9pZCB7XHJcbiAgICB0aGlzLm9rVHJpZ2dlcmVkLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBzcGVjaWZpZWQga2V5LlxyXG4gICAqIElmIGl0IGlzIGEgZnVuY3Rpb24sIHJ1biBhbmQgcmV0dXJuIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGZ1bmN0aW9uLlxyXG4gICAqL1xyXG4gIGdldEJ1dHRvbkNhbGxhYmxlUHJvcChvcHRpb25zOiBNb2RhbEJ1dHRvbk9wdGlvbnMsIHByb3A6IGtleW9mIE1vZGFsQnV0dG9uT3B0aW9ucyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgdmFsdWUgPSBvcHRpb25zW3Byb3BdO1xyXG4gICAgY29uc3QgY29tcG9uZW50SW5zdGFuY2UgPSB0aGlzLm1vZGFsUmVmLmdldENvbnRlbnRDb21wb25lbnQoKTtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicgPyB2YWx1ZS5hcHBseShvcHRpb25zLCBjb21wb25lbnRJbnN0YW5jZSAmJiBbY29tcG9uZW50SW5zdGFuY2VdKSA6IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUnVuIGZ1bmN0aW9uIGJhc2VkIG9uIHRoZSB0eXBlIGFuZCBzZXQgaXRzIGBsb2FkaW5nYCBwcm9wIGlmIG5lZWRlZC5cclxuICAgKi9cclxuICBvbkJ1dHRvbkNsaWNrKG9wdGlvbnM6IE1vZGFsQnV0dG9uT3B0aW9ucyk6IHZvaWQge1xyXG4gICAgY29uc3QgbG9hZGluZyA9IHRoaXMuZ2V0QnV0dG9uQ2FsbGFibGVQcm9wKG9wdGlvbnMsICdsb2FkaW5nJyk7XHJcbiAgICBpZiAoIWxvYWRpbmcpIHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5nZXRCdXR0b25DYWxsYWJsZVByb3Aob3B0aW9ucywgJ29uQ2xpY2snKTtcclxuICAgICAgaWYgKG9wdGlvbnMuYXV0b0xvYWRpbmcgJiYgaXNQcm9taXNlKHJlc3VsdCkpIHtcclxuICAgICAgICBvcHRpb25zLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgIHJlc3VsdC50aGVuKCgpID0+IChvcHRpb25zLmxvYWRpbmcgPSBmYWxzZSkpLmNhdGNoKCgpID0+IChvcHRpb25zLmxvYWRpbmcgPSBmYWxzZSkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gbWVyZ2VEZWZhdWx0T3B0aW9uKG9wdGlvbnM6IE1vZGFsQnV0dG9uT3B0aW9ucyk6IE1vZGFsQnV0dG9uT3B0aW9ucyB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHR5cGU6IG51bGwsXHJcbiAgICBzaXplOiAnbWQnLFxyXG4gICAgYXV0b0xvYWRpbmc6IHRydWUsXHJcbiAgICBzaG93OiB0cnVlLFxyXG4gICAgbG9hZGluZzogZmFsc2UsXHJcbiAgICBkaXNhYmxlZDogZmFsc2UsXHJcbiAgICBjb2xvcjonc2Vjb25kYXJ5JyxcclxuICAgIC4uLm9wdGlvbnNcclxuICB9O1xyXG59XHJcbiJdfQ==