import { __decorate } from "tslib";
import { Component, Input, Optional, ViewEncapsulation } from '@angular/core';
import { BehaviorSubject, ReplaySubject, Subject, timer } from 'rxjs';
import { debounce, distinctUntilChanged, startWith, switchMap, takeUntil } from 'rxjs/operators';
import { InputBoolean, InputNumber } from 'tds-ui/shared/utility';
import { WithConfig } from 'tds-ui/core/config';
import * as i0 from "@angular/core";
import * as i1 from "tds-ui/core/config";
import * as i2 from "@angular/cdk/bidi";
import * as i3 from "./progress-spinner.component";
import * as i4 from "@angular/common";
function TDSSpinComponent_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "tds-spinner", 3);
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵproperty("color", ctx_r1.color);
} }
function TDSSpinComponent_div_2_ng_template_2_Template(rf, ctx) { }
function TDSSpinComponent_div_2_div_3_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 7);
    i0.ɵɵtext(1);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = i0.ɵɵnextContext(2);
    i0.ɵɵadvance(1);
    i0.ɵɵtextInterpolate(ctx_r5.tip);
} }
function TDSSpinComponent_div_2_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div")(1, "div", 4);
    i0.ɵɵtemplate(2, TDSSpinComponent_div_2_ng_template_2_Template, 0, 0, "ng-template", 5);
    i0.ɵɵtemplate(3, TDSSpinComponent_div_2_div_3_Template, 2, 1, "div", 6);
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext();
    const _r0 = i0.ɵɵreference(1);
    i0.ɵɵadvance(1);
    i0.ɵɵclassProp("tds-spin-rtl", ctx_r2.dir === "rtl")("tds-spin-spinning", ctx_r2.isLoading)("opacity-100", ctx_r2.isLoading)("tds-spin-xl", ctx_r2.size === "xl")("tds-spin-sm", ctx_r2.size === "sm")("tds-spin-show-text", ctx_r2.tip);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngTemplateOutlet", ctx_r2.indicator || _r0);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngIf", ctx_r2.tip);
} }
const _c0 = function (a0) { return { "select-none opacity-50 overflow-hidden pointer-events-none clear-both": a0 }; };
function TDSSpinComponent_div_3_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 8);
    i0.ɵɵprojection(1);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = i0.ɵɵnextContext();
    i0.ɵɵclassProp("tds-spin-blur", ctx_r3.isLoading);
    i0.ɵɵproperty("ngClass", i0.ɵɵpureFunction1(3, _c0, ctx_r3.isLoading));
} }
const _c1 = ["*"];
const TDS_CONFIG_MODULE_NAME = 'spin';
export class TDSSpinComponent {
    constructor(tdsConfigService, cdr, directionality) {
        this.tdsConfigService = tdsConfigService;
        this.cdr = cdr;
        this.directionality = directionality;
        this._tdsModuleName = TDS_CONFIG_MODULE_NAME;
        this.indicator = null;
        this.size = 'md';
        this.tip = null;
        this.delay = 0;
        this.simple = false;
        this.spinning = true;
        this.color = 'primary';
        this.destroy$ = new Subject();
        this.spinning$ = new BehaviorSubject(this.spinning);
        this.delay$ = new ReplaySubject(1);
        this.isLoading = false;
        this.dir = 'ltr';
    }
    ngOnInit() {
        const loading$ = this.delay$.pipe(startWith(this.delay), distinctUntilChanged(), switchMap(delay => {
            if (delay === 0) {
                return this.spinning$;
            }
            return this.spinning$.pipe(debounce(spinning => timer(spinning ? delay : 0)));
        }), takeUntil(this.destroy$));
        loading$.subscribe(loading => {
            this.isLoading = loading;
            this.cdr.markForCheck();
        });
        this.tdsConfigService
            .getConfigChangeEventForComponent(TDS_CONFIG_MODULE_NAME)
            .pipe(takeUntil(this.destroy$))
            .subscribe(() => this.cdr.markForCheck());
        this.directionality.change?.pipe(takeUntil(this.destroy$)).subscribe((direction) => {
            this.dir = direction;
            this.cdr.detectChanges();
        });
        this.dir = this.directionality.value;
    }
    ngOnChanges(changes) {
        const { spinning, delay } = changes;
        if (spinning) {
            this.spinning$.next(this.spinning);
        }
        if (delay) {
            this.delay$.next(this.delay);
        }
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
}
TDSSpinComponent.ɵfac = function TDSSpinComponent_Factory(t) { return new (t || TDSSpinComponent)(i0.ɵɵdirectiveInject(i1.TDSConfigService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i2.Directionality, 8)); };
TDSSpinComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TDSSpinComponent, selectors: [["tds-spin"]], hostVars: 4, hostBindings: function TDSSpinComponent_HostBindings(rf, ctx) { if (rf & 2) {
        i0.ɵɵclassProp("relative", !ctx.simple)("block", ctx.isLoading);
    } }, inputs: { indicator: "indicator", size: "size", tip: "tip", delay: "delay", simple: "simple", spinning: "spinning", color: "color" }, exportAs: ["tdsSpin"], features: [i0.ɵɵNgOnChangesFeature], ngContentSelectors: _c1, decls: 4, vars: 2, consts: [["defaultTemplate", ""], [4, "ngIf"], ["class", "tds-spin-container flex flex-col h-full w-full", 3, "tds-spin-blur", "ngClass", 4, "ngIf"], [1, "w-8", "h-8", 3, "color"], [1, "tds-spin", "absolute", "top-0", "left-0", "z-10", "w-full", "h-full", "box-border", "m-0", "p-0", "text-center", "flex", "flex-col", "items-center", "justify-center"], [3, "ngTemplateOutlet"], ["class", "tds-spin-text mt-2 text-caption-2 font-regular text-neutral-1-700", 4, "ngIf"], [1, "tds-spin-text", "mt-2", "text-caption-2", "font-regular", "text-neutral-1-700"], [1, "tds-spin-container", "flex", "flex-col", "h-full", "w-full", 3, "ngClass"]], template: function TDSSpinComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵprojectionDef();
        i0.ɵɵtemplate(0, TDSSpinComponent_ng_template_0_Template, 1, 1, "ng-template", null, 0, i0.ɵɵtemplateRefExtractor);
        i0.ɵɵtemplate(2, TDSSpinComponent_div_2_Template, 4, 14, "div", 1);
        i0.ɵɵtemplate(3, TDSSpinComponent_div_3_Template, 2, 5, "div", 2);
    } if (rf & 2) {
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("ngIf", ctx.isLoading);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", !ctx.simple);
    } }, directives: [i3.TDSProgressSpinnerComponent, i4.NgIf, i4.NgTemplateOutlet, i4.NgClass], encapsulation: 2 });
__decorate([
    WithConfig()
], TDSSpinComponent.prototype, "indicator", void 0);
__decorate([
    InputNumber()
], TDSSpinComponent.prototype, "delay", void 0);
__decorate([
    InputBoolean()
], TDSSpinComponent.prototype, "simple", void 0);
__decorate([
    InputBoolean()
], TDSSpinComponent.prototype, "spinning", void 0);
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TDSSpinComponent, [{
        type: Component,
        args: [{
                selector: 'tds-spin',
                exportAs: 'tdsSpin',
                preserveWhitespaces: false,
                encapsulation: ViewEncapsulation.None,
                template: `
    <ng-template #defaultTemplate>
      <tds-spinner [color]="color" class="w-8 h-8"></tds-spinner>      
    </ng-template>
    <div *ngIf="isLoading">
      <div
        class="tds-spin absolute top-0 left-0 z-10  w-full h-full box-border m-0 p-0 text-center flex flex-col items-center justify-center"
        [class.tds-spin-rtl]="dir === 'rtl'"
        [class.tds-spin-spinning]="isLoading"
        [class.opacity-100]="isLoading"
        [class.tds-spin-xl]="size === 'xl'"
        [class.tds-spin-sm]="size === 'sm'"
        [class.tds-spin-show-text]="tip"
      >
        <ng-template [ngTemplateOutlet]="indicator || defaultTemplate"></ng-template>
        <div class="tds-spin-text mt-2 text-caption-2 font-regular text-neutral-1-700" *ngIf="tip">{{ tip }}</div>
      </div>
    </div>
    <div *ngIf="!simple" class="tds-spin-container flex flex-col h-full w-full"
     [class.tds-spin-blur]="isLoading"
     [ngClass]="{'select-none opacity-50 overflow-hidden pointer-events-none clear-both':isLoading}"
     >
      <ng-content></ng-content>
    </div>
  `,
                host: {
                    '[class.relative]': '!simple',
                    '[class.block]': "isLoading"
                }
            }]
    }], function () { return [{ type: i1.TDSConfigService }, { type: i0.ChangeDetectorRef }, { type: i2.Directionality, decorators: [{
                type: Optional
            }] }]; }, { indicator: [{
            type: Input
        }], size: [{
            type: Input
        }], tip: [{
            type: Input
        }], delay: [{
            type: Input
        }], simple: [{
            type: Input
        }], spinning: [{
            type: Input
        }], color: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Bpbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy90ZHMtdWkvcHJvZ3Jlc3Mtc3Bpbm5lci9zcGluLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBSUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxLQUFLLEVBSUwsUUFBUSxFQUdSLGlCQUFpQixFQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxRQUFRLEVBQUUsb0JBQW9CLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVqRyxPQUFPLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBYyxNQUFNLHVCQUF1QixDQUFDO0FBQzlFLE9BQU8sRUFBOEMsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7Ozs7Ozs7SUFVdEYsaUNBQTJEOzs7SUFBOUMsb0NBQWU7Ozs7SUFhMUIsOEJBQTJGO0lBQUEsWUFBUztJQUFBLGlCQUFNOzs7SUFBZixlQUFTO0lBQVQsZ0NBQVM7OztJQVh4RywyQkFBdUIsYUFBQTtJQVVuQix1RkFBNkU7SUFDN0UsdUVBQTBHO0lBQzVHLGlCQUFNLEVBQUE7Ozs7SUFUSixlQUFvQztJQUFwQyxvREFBb0MsdUNBQUEsaUNBQUEscUNBQUEscUNBQUEsa0NBQUE7SUFPdkIsZUFBaUQ7SUFBakQsMERBQWlEO0lBQ2tCLGVBQVM7SUFBVCxpQ0FBUzs7OztJQUc3Riw4QkFHRTtJQUNBLGtCQUF5QjtJQUMzQixpQkFBTTs7O0lBSkwsaURBQWlDO0lBQ2pDLHNFQUErRjs7O0FBM0JwRyxNQUFNLHNCQUFzQixHQUFpQixNQUFNLENBQUM7QUFxQ3BELE1BQU0sT0FBTyxnQkFBZ0I7SUFtQjNCLFlBQ1MsZ0JBQWtDLEVBQ2pDLEdBQXNC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UUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDM0IsQ0FBQzs7Z0ZBcEVVLGdCQUFnQjttRUFBaEIsZ0JBQWdCOzs7O1FBN0J6QixrSEFFYztRQUNkLGtFQWFNO1FBQ04saUVBS007O1FBbkJBLGVBQWU7UUFBZixvQ0FBZTtRQWNmLGVBQWE7UUFBYixrQ0FBYTs7QUFrQkU7SUFBYixVQUFVLEVBQUU7bURBQWtEO0FBR2hEO0lBQWQsV0FBVyxFQUFFOytDQUFXO0FBQ1Q7SUFBZixZQUFZLEVBQUU7Z0RBQWdCO0FBQ2Y7SUFBZixZQUFZLEVBQUU7a0RBQWlCO3VGQVg5QixnQkFBZ0I7Y0FuQzVCLFNBQVM7ZUFBQztnQkFDVCxRQUFRLEVBQUUsVUFBVTtnQkFDcEIsUUFBUSxFQUFFLFNBQVM7Z0JBQ25CLG1CQUFtQixFQUFFLEtBQUs7Z0JBQzFCLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2dCQUNyQyxRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXdCVDtnQkFDRCxJQUFJLEVBQUU7b0JBQ0osa0JBQWtCLEVBQUUsU0FBUztvQkFDN0IsZUFBZSxFQUFDLFdBQVc7aUJBQzVCO2FBQ0Y7O3NCQXVCSSxRQUFRO3dCQWhCWSxTQUFTO2tCQUEvQixLQUFLO1lBQ0csSUFBSTtrQkFBWixLQUFLO1lBQ0csR0FBRztrQkFBWCxLQUFLO1lBQ2tCLEtBQUs7a0JBQTVCLEtBQUs7WUFDbUIsTUFBTTtrQkFBOUIsS0FBSztZQUNtQixRQUFRO2tCQUFoQyxLQUFLO1lBQ0csS0FBSztrQkFBYixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiXHJcblxyXG5pbXBvcnQgeyBEaXJlY3Rpb24sIERpcmVjdGlvbmFsaXR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2JpZGknO1xyXG5pbXBvcnQgeyBCb29sZWFuSW5wdXQsIE51bWJlcklucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcclxuaW1wb3J0IHtcclxuICBDaGFuZ2VEZXRlY3RvclJlZixcclxuICBDb21wb25lbnQsXHJcbiAgSW5wdXQsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIE9uRGVzdHJveSxcclxuICBPbkluaXQsXHJcbiAgT3B0aW9uYWwsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxuICBUZW1wbGF0ZVJlZixcclxuICBWaWV3RW5jYXBzdWxhdGlvblxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIFJlcGxheVN1YmplY3QsIFN1YmplY3QsIHRpbWVyIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlYm91bmNlLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgVERTVGhlbWVQYWxldHRlIH0gZnJvbSAndGRzLXVpL3NoYXJlZC9jb21tb24nO1xyXG5pbXBvcnQgeyBJbnB1dEJvb2xlYW4sIElucHV0TnVtYmVyLCBURFNTYWZlQW55IH0gZnJvbSAndGRzLXVpL3NoYXJlZC91dGlsaXR5JztcclxuaW1wb3J0IHsgQnV0dG9uU2l6ZSwgVERTQ29uZmlnS2V5LCBURFNDb25maWdTZXJ2aWNlLCBXaXRoQ29uZmlnIH0gZnJvbSAndGRzLXVpL2NvcmUvY29uZmlnJztcclxuY29uc3QgVERTX0NPTkZJR19NT0RVTEVfTkFNRTogVERTQ29uZmlnS2V5ID0gJ3NwaW4nO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd0ZHMtc3BpbicsXHJcbiAgZXhwb3J0QXM6ICd0ZHNTcGluJyxcclxuICBwcmVzZXJ2ZVdoaXRlc3BhY2VzOiBmYWxzZSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICA8bmctdGVtcGxhdGUgI2RlZmF1bHRUZW1wbGF0ZT5cclxuICAgICAgPHRkcy1zcGlubmVyIFtjb2xvcl09XCJjb2xvclwiIGNsYXNzPVwidy04IGgtOFwiPjwvdGRzLXNwaW5uZXI+ICAgICAgXHJcbiAgICA8L25nLXRlbXBsYXRlPlxyXG4gICAgPGRpdiAqbmdJZj1cImlzTG9hZGluZ1wiPlxyXG4gICAgICA8ZGl2XHJcbiAgICAgICAgY2xhc3M9XCJ0ZHMtc3BpbiBhYnNvbHV0ZSB0b3AtMCBsZWZ0LTAgei0xMCAgdy1mdWxsIGgtZnVsbCBib3gtYm9yZGVyIG0tMCBwLTAgdGV4dC1jZW50ZXIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXJcIlxyXG4gICAgICAgIFtjbGFzcy50ZHMtc3Bpbi1ydGxdPVwiZGlyID09PSAncnRsJ1wiXHJcbiAgICAgICAgW2NsYXNzLnRkcy1zcGluLXNwaW5uaW5nXT1cImlzTG9hZGluZ1wiXHJcbiAgICAgICAgW2NsYXNzLm9wYWNpdHktMTAwXT1cImlzTG9hZGluZ1wiXHJcbiAgICAgICAgW2NsYXNzLnRkcy1zcGluLXhsXT1cInNpemUgPT09ICd4bCdcIlxyXG4gICAgICAgIFtjbGFzcy50ZHMtc3Bpbi1zbV09XCJzaXplID09PSAnc20nXCJcclxuICAgICAgICBbY2xhc3MudGRzLXNwaW4tc2hvdy10ZXh0XT1cInRpcFwiXHJcbiAgICAgID5cclxuICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwiaW5kaWNhdG9yIHx8IGRlZmF1bHRUZW1wbGF0ZVwiPjwvbmctdGVtcGxhdGU+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInRkcy1zcGluLXRleHQgbXQtMiB0ZXh0LWNhcHRpb24tMiBmb250LXJlZ3VsYXIgdGV4dC1uZXV0cmFsLTEtNzAwXCIgKm5nSWY9XCJ0aXBcIj57eyB0aXAgfX08L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICAgIDxkaXYgKm5nSWY9XCIhc2ltcGxlXCIgY2xhc3M9XCJ0ZHMtc3Bpbi1jb250YWluZXIgZmxleCBmbGV4LWNvbCBoLWZ1bGwgdy1mdWxsXCJcclxuICAgICBbY2xhc3MudGRzLXNwaW4tYmx1cl09XCJpc0xvYWRpbmdcIlxyXG4gICAgIFtuZ0NsYXNzXT1cInsnc2VsZWN0LW5vbmUgb3BhY2l0eS01MCBvdmVyZmxvdy1oaWRkZW4gcG9pbnRlci1ldmVudHMtbm9uZSBjbGVhci1ib3RoJzppc0xvYWRpbmd9XCJcclxuICAgICA+XHJcbiAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cclxuICAgIDwvZGl2PlxyXG4gIGAsXHJcbiAgaG9zdDoge1xyXG4gICAgJ1tjbGFzcy5yZWxhdGl2ZV0nOiAnIXNpbXBsZScsXHJcbiAgICAnW2NsYXNzLmJsb2NrXSc6XCJpc0xvYWRpbmdcIlxyXG4gIH1cclxufSlcclxuZXhwb3J0IGNsYXNzIFREU1NwaW5Db21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0IHtcclxuICByZWFkb25seSBfdGRzTW9kdWxlTmFtZTogVERTQ29uZmlnS2V5ID0gVERTX0NPTkZJR19NT0RVTEVfTkFNRTtcclxuXHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX2RlbGF5OiBOdW1iZXJJbnB1dDtcclxuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfc2ltcGxlOiBCb29sZWFuSW5wdXQ7XHJcbiAgc3RhdGljIG5nQWNjZXB0SW5wdXRUeXBlX3NwaW5uaW5nOiBCb29sZWFuSW5wdXQ7XHJcbiAgQElucHV0KCkgQFdpdGhDb25maWcoKSBpbmRpY2F0b3I6IFRlbXBsYXRlUmVmPFREU1NhZmVBbnk+IHwgbnVsbCA9IG51bGw7XHJcbiAgQElucHV0KCkgc2l6ZTogQnV0dG9uU2l6ZSA9ICdtZCc7XHJcbiAgQElucHV0KCkgdGlwOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBASW5wdXQoKSBASW5wdXROdW1iZXIoKSBkZWxheSA9IDA7XHJcbiAgQElucHV0KCkgQElucHV0Qm9vbGVhbigpIHNpbXBsZSA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSBzcGlubmluZyA9IHRydWU7XHJcbiAgQElucHV0KCkgY29sb3I6IFREU1RoZW1lUGFsZXR0ZSA9ICdwcmltYXJ5JztcclxuICBwcml2YXRlIGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuICBwcml2YXRlIHNwaW5uaW5nJCA9IG5ldyBCZWhhdmlvclN1YmplY3QodGhpcy5zcGlubmluZyk7XHJcbiAgcHJpdmF0ZSBkZWxheSQgPSBuZXcgUmVwbGF5U3ViamVjdDxudW1iZXI+KDEpO1xyXG4gIGlzTG9hZGluZyA9IGZhbHNlO1xyXG4gIGRpcjogRGlyZWN0aW9uID0gJ2x0cic7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIHRkc0NvbmZpZ1NlcnZpY2U6IFREU0NvbmZpZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGRpcmVjdGlvbmFsaXR5OiBEaXJlY3Rpb25hbGl0eVxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgY29uc3QgbG9hZGluZyQgPSB0aGlzLmRlbGF5JC5waXBlKFxyXG4gICAgICBzdGFydFdpdGgodGhpcy5kZWxheSksXHJcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXHJcbiAgICAgIHN3aXRjaE1hcChkZWxheSA9PiB7XHJcbiAgICAgICAgaWYgKGRlbGF5ID09PSAwKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5zcGlubmluZyQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5zcGlubmluZyQucGlwZShkZWJvdW5jZShzcGlubmluZyA9PiB0aW1lcihzcGlubmluZyA/IGRlbGF5IDogMCkpKTtcclxuICAgICAgfSksXHJcbiAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgKTtcclxuICAgIGxvYWRpbmckLnN1YnNjcmliZShsb2FkaW5nID0+IHtcclxuICAgICAgdGhpcy5pc0xvYWRpbmcgPSBsb2FkaW5nO1xyXG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy50ZHNDb25maWdTZXJ2aWNlXHJcbiAgICAgIC5nZXRDb25maWdDaGFuZ2VFdmVudEZvckNvbXBvbmVudChURFNfQ09ORklHX01PRFVMRV9OQU1FKVxyXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXHJcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5jZHIubWFya0ZvckNoZWNrKCkpO1xyXG5cclxuICAgIHRoaXMuZGlyZWN0aW9uYWxpdHkuY2hhbmdlPy5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChkaXJlY3Rpb246IERpcmVjdGlvbikgPT4ge1xyXG4gICAgICB0aGlzLmRpciA9IGRpcmVjdGlvbjtcclxuICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5kaXIgPSB0aGlzLmRpcmVjdGlvbmFsaXR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBzcGlubmluZywgZGVsYXkgfSA9IGNoYW5nZXM7XHJcbiAgICBpZiAoc3Bpbm5pbmcpIHtcclxuICAgICAgdGhpcy5zcGlubmluZyQubmV4dCh0aGlzLnNwaW5uaW5nKTtcclxuICAgIH1cclxuICAgIGlmIChkZWxheSkge1xyXG4gICAgICB0aGlzLmRlbGF5JC5uZXh0KHRoaXMuZGVsYXkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcclxuICB9XHJcbn1cclxuIl19